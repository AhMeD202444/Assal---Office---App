<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>توافقات - Assal Office</title>

    <!-- المكتبات المطلوبة -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/gsap.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Tajawal:wght@400;700&family=Montserrat:wght@400;600&display=swap" rel="stylesheet">

    <!-- Firebase SDK (Local files) -->
    <script src="firebase-app.js"></script>
    <script src="firebase-firestore.js"></script>
    <script src="firebase-analytics.js"></script>
    <!-- FingerprintJS (Local file) -->
    <script src="fingerprint.min.js"></script>

    <style>
        /* Reset and basics */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background: linear-gradient(135deg, #3A6073, #16222A);
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            min-height: 100vh;
            padding: 40px 0 50px 0;
            margin: 0;
            background-size: 400% 400%;
            animation: gradientAnimation 10s ease infinite;
            direction: rtl;
        }

        @keyframes gradientAnimation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Logo and Notification */
        .notification-container {
            position: relative;
            width: 160px;
            height: 160px;
            margin: 0 auto 2px;
        }

        .logo-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 160px;
    height: 160px;
    border-radius: 50%;
    overflow: hidden !important; /* قص التأثيرات */
    box-shadow: 0 4px 10px rgba(255, 255, 255, 0.2);
    cursor: pointer;
    z-index: 1;
    opacity: 1;
    transition: transform 0.3s ease;
    clip-path: circle(80px at center) !important; /* قص دائري يطابق نصف القطر */
}

.logo-container img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
    border-radius: 50%;
}

.logo-container:active {
    transform: scale(0.95) !important;
    box-shadow: inset 0 8px 16px rgba(0, 0, 0, 0.5) !important; /* ظل داخلي فقط */
    clip-path: circle(80px at center) !important; /* قص صارم */
}

.logo-container img:active {
    transform: scale(1) !important; /* منع الصورة من التأثر */
}

        .notification {
    position: absolute;
    top: 0;
    left: 0;
    width: 160px; /* مطابقة حجم الشعار */
    height: 160px; /* مطابقة حجم الشعار */
    background: linear-gradient(45deg, #4682B4, #20B2AA);
    border: 3px solid #4682B4;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    opacity: 0;
    transform: scale(0);
    z-index: 2;
    overflow: hidden !important; /* قص التأثيرات */
    clip-path: circle(80px at center) !important; /* قص دائري صارم */
}

        .notification.show {
            animation: screenPop 0.7s ease-out forwards, pulseGlow 1.5s infinite;
        }

        .notification-text {
            font-family: 'Tajawal', sans-serif;
            font-size: 18px;
            font-weight: 700;
            color: #ffffff;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.8);
            padding: 10px;
            text-align: center;
            max-width: 140px;
            opacity: 0;
            letter-spacing: 1px;
        }

        .notification.show .notification-text {
            animation: textFadeIn 0.5s ease-out forwards;
            animation-delay: 0.7s;
        }

        .notification::before {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            background: linear-gradient(45deg, #4682B4, #20B2AA);
            filter: blur(10px);
            opacity: 0.7;
            z-index: -1;
            border-radius: 50%;
        }

        @keyframes shake {
            0%, 100% { transform: translate(0, 0); }
            25% { transform: translate(-4px, 4px) rotate(-3deg); }
            50% { transform: translate(4px, -4px) rotate(3deg); }
            75% { transform: translate(-4px, 4px) rotate(-3deg); }
        }

        @keyframes explode {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.6); opacity: 0.7; filter: blur(3px); }
            100% { transform: scale(2); opacity: 0; filter: blur(6px); }
        }

        @keyframes screenPop {
            0% { transform: scale(0) rotate(0deg); opacity: 0; box-shadow: none; }
            50% { transform: scale(1.1) rotate(360deg); opacity: 1; box-shadow: 0 0 20px rgba(70, 130, 180, 0.8), 0 0 40px rgba(70, 130, 180, 0.4); }
            100% { transform: scale(1) rotate(720deg); opacity: 1; box-shadow: 0 0 15px rgba(70, 130, 180, 0.6); }
        }

        @keyframes pulseGlow {
            0% { box-shadow: 0 0 15px rgba(70, 130, 180, 0.6); }
            50% { box-shadow: 0 0 25px rgba(70, 130, 180, 1), 0 0 40px rgba(70, 130, 180, 0.5); }
            100% { box-shadow: 0 0 15px rgba(70, 130, 180, 0.6); }
        }

        @keyframes textFadeIn {
            0% { opacity: 0; transform: translateY(10px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 40px;
            background: rgba(0, 0, 0, 0.8);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 12px;
            z-index: 2000;
        }

        .header-title {
            font-family: 'Cairo', sans-serif;
            font-size: 16px; /* تقليل من 18px إلى 16px */
            font-weight: 700;
            color: #A3BFFA;
            text-shadow: 0 1px 2px rgba(163, 191, 250, 0.4);
            letter-spacing: 0.5px;
            order: 0; /* Moved to the right */
        }

        .header-buttons {
            display: flex;
            gap: 6px;
            order: 1; /* Moved to the left */
        }

        .header-btn {
            padding: 3px 8px; /* تقليل الحشوة قليلاً */
            border-radius: 8px;
            border: none;
            background: linear-gradient(135deg, #5A6388, #4A5275);
            color: #fff;
            font-family: 'Cairo', sans-serif;
            font-size: 11px; /* تقليل من 12px إلى 11px */
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .header-btn:hover {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.5);
        }

        .header-btn:active {
            transform: scale(0.95);
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .refresh-btn {
            background: linear-gradient(135deg, #6B7280, #4B5563);
        }

        .refresh-btn:hover {
            background: linear-gradient(135deg, #9CA3AF, #6B7280);
        }

        .back-btn {
            background: linear-gradient(135deg, #8B0000, #B22222);
        }

        .back-btn:hover {
            background: linear-gradient(135deg, #CD5C5C, #8B0000);
        }

        .notes-btn {
            background: linear-gradient(135deg, #4682B4, #20B2AA);
            position: relative;
            padding-right: 24px; /* تقليل الحشوة قليلاً */
            padding-left: 10px;
        }

        .notes-btn:hover {
            background: linear-gradient(135deg, #20B2AA, #4682B4);
        }

        .notes-count {
            position: absolute;
            top: 50%;
            right: 4px;
            transform: translateY(-50%);
            background: #DC143C;
            color: #fff;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            font-size: 9px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 3px rgba(0, 0, 0, 0.5);
            display: none;
        }

        .notes-count.visible {
            display: flex;
        }

        /* Main Container */
        .container {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(0, 0, 0, 0.1));
            background-size: 400% 400%;
            animation: gradientAnimation 10s ease infinite;
            border-radius: 20px;
            padding: 20px 10px;
            text-align: center;
            width: 90%;
            max-width: 800px;
            margin: 10px auto 20px auto;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        /* New Similarities Bar (replacing news-bar) */
        .news-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(0, 0, 0, 0.3);
            padding: 8px 16px;
            border-radius: 25px;
            width: 100%;
            height: 40px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            margin-bottom: 2px;
            box-sizing: border-box;
            direction: ltr; /* Ensure left-to-right direction */
        }

        .breaking-news {
            background: linear-gradient(135deg, #0082B5, #0070A0);
            color: white;
            font-weight: bold;
            padding: 6px 14px;
            border-radius: 20px;
            text-align: center;
            font-size: 14px;
            box-shadow: 0px 0px 10px rgba(0, 130, 181, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            height: 28px;
            order: 1; /* Moved to the far right */
            margin-left: auto;
        }

        .news-ticker-container {
            flex: 1;
            height: 28px;
            overflow: hidden;
            position: relative;
            display: flex;
            align-items: center;
            background: transparent;
            border-radius: 15px;
            padding: 4px 8px;
            order: 0; /* Ensure ticker is on the left */
        }

        .news-ticker {
            display: flex;
            align-items: center;
            white-space: nowrap;
            position: absolute;
            animation: scrollTextRightToLeft 30s linear infinite; /* تسريع الحركة من 60s إلى 30s */
            color: white;
            font-weight: bold;
            font-size: 14px;
            gap: 25px;
            direction: ltr;
            unicode-bidi: plaintext;
            background: transparent;
        }

        .news-ticker span {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: 20px;
            direction: ltr;
            unicode-bidi: embed;
        }

        @keyframes scrollTextRightToLeft {
            0% { transform: translateX(-100%); } /* Start from the left */
            100% { transform: translateX(100%); } /* Move to the right */
        }

        /* Categories */
        .categories {
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: center;
            width: 100%;
        }

        .category-btn, .new-category-btn {
            width: 85%;
            max-width: 250px;
            padding: 8px 16px;
            border-radius: 25px;
            background: rgba(0, 0, 0, 0.3);
            color: white;
            font-size: 16px;
            font-family: 'Cairo', sans-serif;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            overflow: hidden;
        }

        .category-btn:hover, .new-category-btn:hover {
            transform: scale(1.1);
            background: linear-gradient(45deg, #43cea2, #185a9d);
        }

        .category-btn:active, .new-category-btn:active {
            transform: scale(0.95);
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        /* Slider */
        .slider-container {
            position: relative;
            width: 100%;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.1);
            padding: 5px;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .slider {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            scroll-behavior: smooth;
            padding: 5px;
            flex-grow: 1;
            direction: ltr; /* Reversed to start from left */
        }

        .slider::-webkit-scrollbar {
            display: none;
        }

        .category {
            flex: 0 0 auto;
            width: 70px;
            height: 70px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px; /* Oval edges for square shape */
            border: 2px solid rgba(255, 255, 255, 0.3); /* White border for elegance */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            padding: 6px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
            font-weight: bold;
            color: white;
        }

        .category i {
            font-size: 20px;
            margin-bottom: 5px;
            transition: transform 0.3s ease;
        }

        .category:hover i {
            transform: rotate(10deg) scale(1.2);
        }

        .category span {
            font-size: 11px;
            white-space: nowrap;
            font-weight: bold;
        }

        /* تصغير حجم النص للأصناف التي تحتوي على كلمتين أو أكثر */
        .category span.multi-word {
            font-size: 9px; /* تصغير حجم النص */
        }

        /* تصغير إضافي للأصناف التي تحتوي على ثلاث كلمات */
        .category span.three-words {
            font-size: 8px; /* تصغير من 9px إلى 8px */
        }

        .category:hover {
            transform: scale(1.1);
            background: linear-gradient(45deg, #43cea2, #185a9d);
            box-shadow: 0 4px 15px rgba(67, 206, 162, 0.5);
        }

        .category:active {
            transform: scale(0.95);
            background: linear-gradient(45deg, #43cea2, #185a9d);
            box-shadow: inset 0 6px 12px rgba(0, 0, 0, 0.7);
        }

        .category.active {
            background: linear-gradient(135deg, #004D40, #00796B);
            color: white;
            transform: scale(1.15);
            box-shadow: 0 6px 18px rgba(67, 206, 162, 0.7);
        }

        @keyframes pulseEffect {
            0% { transform: scale(1.15); box-shadow: 0 0 10px rgba(67, 206, 162, 0.5); }
            50% { transform: scale(1.2); box-shadow: 0 0 20px rgba(67, 206, 162, 0.8); }
            100% { transform: scale(1.15); box-shadow: 0 0 10px rgba(67, 206, 162, 0.5); }
        }

        .slider-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(243, 156, 18, 0.4);
            border: none;
            color: white;
            padding: 8px;
            cursor: pointer;
            border-radius: 50%;
            font-size: 16px;
            width: 38px;
            height: 38px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s ease, background 0.2s ease, box-shadow 0.2s ease;
            z-index: 10;
            overflow: hidden;
            clip-path: circle(18px at center);
        }

        .slider-btn:hover {
            background: rgba(243, 156, 18, 0.8);
            transform: translateY(-50%) scale(1.2);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
        }

        .slider-btn:active {
            transform: translateY(-50%) scale(0.9);
            background: rgba(243, 156, 18, 1);
            box-shadow: inset 0 6px 12px rgba(0, 0, 0, 0.7);
            clip-path: circle(18px at center);
        }

        .prev-btn {
            left: 5px;
        }

        .next-btn {
            right: 5px;
        }

        /* Search Container */
        .search-container {
            position: relative;
            width: 100%;
            margin: 8px 0 20px 0;
        }

        .search-container input {
            width: 100%;
            height: 40px;
            padding: 8px 16px;
            font-size: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            background: rgba(0, 0, 0, 0.3);
            color: white;
            outline: none;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            font-family: 'Cairo', sans-serif;
            direction: ltr; /* Text from left */
            text-align: left; /* Align placeholder and text to the left */
        }

        .search-container button {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: linear-gradient(45deg, #43cea2, #185a9d);
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            clip-path: circle(15px at center);
        }

        .search-container button:hover {
            transform: translateY(-50%) scale(1.1);
        }

        .search-container button:active {
            transform: translateY(-50%) scale(0.95);
            box-shadow: inset 0 4px 8px rgba(0, 0, 0, 0.5);
            clip-path: circle(15px at center);
        }

        /* Results Container */
        .results-container {
            display: none;
            flex-direction: column;
            gap: 10px;
            border-radius: 10px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 800px;
            margin: 10px auto;
            transform: translateZ(0);
            overflow: visible; /* إزالة التمرير */
            max-height: none; /* إزالة الحد الأقصى للارتفاع */
        }

        .results-container.visible {
            display: flex;
        }

        .products-grid {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            gap: 20px;
        }

        .result-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.5), rgba(50, 50, 50, 0.3));
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            width: 90%;
            max-width: 450px;
            min-height: 200px;
            margin: 0 auto;
            overflow: hidden;
            clip-path: inset(0 0 0 0 round 15px);
        }

        .result-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
        }

        .result-card:active {
            transform: scale(0.97);
            box-shadow: inset 0 6px 12px rgba(0, 0, 0, 0.6);
            clip-path: inset(0 0 0 0 round 15px);
        }

        .result-card img {
            width: clamp(80px, 20vw, 140px);
            height: clamp(80px, 20vw, 140px);
            border-radius: 50%;
            margin-bottom: 20px;
            object-fit: cover;
            border: 2px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease;
        }

        .result-card:hover img {
            transform: rotate(10deg) scale(1.1);
        }

        .result-card h4 {
            font-size: clamp(18px, 5vw, 24px);
            font-weight: bold;
            color: white;
            margin: 0 0 20px 0;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
            text-align: center;
            white-space: normal;
            word-wrap: break-word;
            max-width: 90%;
        }

        .result-card button {
            padding: 6px 16px; /* تقليل الحشوة من 8px 18px إلى 6px 16px */
            background: linear-gradient(45deg, #4682B4, #20B2AA);
            border-radius: 8px;
            font-size: 14px; /* تقليل حجم الخط من 16px إلى 14px */
            color: #fff;
            border: none;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            font-family: 'Cairo', sans-serif;
        }

        .result-card button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 10px rgba(70, 130, 180, 0.6);
        }

        /* Notes Drawer */
        .notes-drawer {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            padding: 40px 20px;
            transition: right 0.4s ease;
            z-index: 2000;
            box-shadow: -5px 0 20px rgba(0, 0, 0, 0.5);
            overflow-y: auto;
            direction: rtl;
        }

        .notes-drawer.active {
            right: 0;
        }

        .notes-drawer h3 {
            font-size: 26px;
            margin-bottom: 30px;
            color: #43cea2;
            text-shadow: 0 0 10px rgba(67, 206, 162, 0.5);
            text-align: center;
            font-family: 'Cairo', sans-serif;
        }

        .notes-drawer .close-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 24px;
            cursor: pointer;
            color: #fff;
        }

        .notes-items-container {
            max-height: 60vh;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .notes-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .notes-item:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: #43cea2;
        }

        .notes-item span {
            font-size: 14px;
            color: #fff;
            text-align: center;
            flex: 1;
            padding: 0 10px;
            font-family: 'Cairo', sans-serif;
        }

        .notes-item button {
            padding: 8px 15px;
            border-radius: 10px;
            background: linear-gradient(45deg, #FF416C, #FF4B2B);
            color: #fff;
            border: none;
            cursor: pointer;
            font-size: 12px;
            font-weight: 700;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(255, 75, 75, 0.5);
            overflow: hidden;
            clip-path: inset(0 0 0 0 round 10px);
            font-family: 'Cairo', sans-serif;
        }

        .notes-item button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(255, 75, 75, 0.7);
        }

        /* Scroll to Top Button */
        .scroll-to-top {
            position: fixed;
            bottom: 60px;
            right: 20px;
            background: linear-gradient(45deg, #8B0000, #DC143C);
            color: #fff;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease, opacity 0.3s ease;
            opacity: 0;
            visibility: hidden;
            z-index: 1000;
            overflow: hidden;
            clip-path: circle(25px at center);
        }

        .scroll-to-top:hover {
            transform: translateY(-5px) scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }

        .scroll-to-top.visible {
            opacity: 1;
            visibility: visible;
        }

        /* Footer */
        footer {
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            text-align: center;
            padding: 10px 0;
            width: 100%;
            font-family: 'Montserrat', sans-serif;
            font-size: 14px;
            box-shadow: 0 -3px 10px rgba(0, 0, 0, 0.4);
            position: fixed;
            bottom: 0;
            left: 0;
            z-index: 1000;
        }

        footer p {
            margin: 0;
            padding: 3px 0;
            font-size: 14px;
            color: white;
        }

        /* SweetAlert2 Customization */
        .swal2-popup {
            background: linear-gradient(135deg, #1E2A44, #2D3E66);
            border-radius: 20px;
            padding: 15px;
            font-family: 'Cairo', sans-serif;
            text-align: center;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 350px;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            align-items: center;
            box-sizing: border-box;
            box-shadow: 0 0 20px rgba(163, 191, 250, 0.7), 0 0 40px rgba(212, 175, 55, 0.5);
            border: 1px solid rgba(212, 175, 55, 0.3);
            gap: 5px;
        }

        /* نافذة "توافقات جديدة" بحجم أصغر */
        .swal2-popup.new-similarities-popup {
            max-width: 300px; /* تقليل العرض من 350px إلى 300px */
            min-height: 200px; /* تقليل الارتفاع من 300px إلى 200px */
        }

        .swal2-popup.new-similarities-popup .swal2-title {
            font-size: clamp(14px, 3vw, 18px); /* تقليل من 20px إلى 18px */
        }

        .swal2-popup.new-similarities-popup .swal2-html-container {
            font-size: 12px; /* تقليل من 16px إلى 12px */
        }

        .swal2-backdrop {
            background: rgba(0, 0, 0, 0.7);
        }

        .swal2-show {
            animation: fadeIn 0.5s ease-in-out;
        }

        .swal2-hide {
            animation: fadeOut 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
            100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }

        @keyframes fadeOut {
            0% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
        }

        .swal2-icon {
            margin: 0 auto;
            margin-bottom: 5px;
            margin-top: 5px;
        }

        .swal2-success-ring {
            border: 0.25em solid #D4AF37 !important; /* Circle color from old code */
        }

        .swal2-success-fix {
            background: transparent !important;
        }

        .swal2-success-line-tip,
        .swal2-success-line-long {
            background-color: #D4AF37 !important; /* Checkmark color from old code */
        }

        .swal2-success-circular-line-left,
        .swal2-success-circular-line-right {
            background: transparent !important;
        }

        .swal2-title {
            color: #D4AF37;
            font-family: 'Tajawal', sans-serif;
            font-weight: 700;
            margin-bottom: 0;
            font-size: clamp(16px, 3.5vw, 20px);
        }

        .swal2-html-container {
            color: #E2E8F0 !important;
            font-family: 'Cairo', sans-serif;
            margin-bottom: 0;
            font-size: 16px;
            line-height: 1.6;
        }

        .swal2-html-container .welcome-message {
            font-family: 'Tajawal', sans-serif;
            font-size: clamp(18px, 3.5vw, 20px);
            color: #E2E8F0;
            line-height: 1.6;
            text-align: center;
            margin: 10px 0;
        }

        .welcome-message .highlight {
            color: #D4AF37;
            font-weight: 700;
        }

        .swal2-input {
            width: 80%;
            max-width: 250px;
            padding: 8px 12px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #D4AF37;
            color: #E2E8F0;
            font-size: 14px;
            font-family: 'Cairo', sans-serif;
            margin: 10px auto;
            display: block;
            text-align: center;
        }

        .swal2-actions {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            margin-top: 10px;
            gap: 8px;
        }

        .swal2-confirm, .swal2-cancel {
            padding: 10px 20px; /* زيادة الحشوة لتكبير الزر */
            border-radius: 25px; /* زوايا مستديرة أكثر أناقة */
            font-size: 14px; /* زيادة حجم الخط من 12px إلى 14px */
            font-weight: 700;
            font-family: 'Tajawal', sans-serif;
            border: none;
            cursor: pointer;
            width: auto;
            min-width: 110px; /* زيادة العرض الأدنى من 90px إلى 110px */
            white-space: nowrap;
            margin: 0;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        .swal2-confirm {
            background: linear-gradient(45deg, #D4AF37, #A3BFFA);
            color: #fff;
        }

        .swal2-cancel {
            background: linear-gradient(45deg, #E53E3E, #9B2C2C);
            color: #fff;
        }

        .swal2-confirm:hover, .swal2-cancel:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.5);
        }

        .swal2-confirm:active, .swal2-cancel:active {
            transform: scale(0.95);
            box-shadow: inset 0 4px 8px rgba(0, 0, 0, 0.5);
        }

        /* Loading Circle */
        .loading-circle {
            width: 80px;
            height: 80px;
            border: 8px solid rgba(255, 255, 255, 0.2);
            border-top: 8px solid #43cea2;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Media Queries */
        @media (max-width: 480px) {
            .container {
                width: 95%;
                padding: 12px 6px;
                margin: 6px auto;
            }

            .notification-container {
                width: 140px;
                height: 140px;
            }

            .logo-container, .notification {
                width: 140px;
                height: 140px;
            }

            .notification-text {
                font-size: 16px;
                max-width: 120px;
            }

            .search-container input {
                height: 36px;
                font-size: 14px;
            }

            .search-container button {
                width: 28px;
                height: 28px;
                font-size: 14px;
            }

            .results-container {
                width: 95%;
            }

            .result-card {
                padding: 15px;
                min-height: 180px;
            }

            .result-card img {
                width: clamp(70px, 18vw, 120px);
                height: clamp(70px, 18vw, 120px);
            }

            .notes-drawer {
                width: 100%;
                right: -100%;
            }

            .swal2-popup {
                width: 95%;
                max-width: 320px;
                min-height: 280px;
                padding: 12px;
                gap: 3px;
            }

            .swal2-popup.new-similarities-popup {
                max-width: 280px; /* تقليل أكثر للشاشات الصغيرة */
                min-height: 180px;
            }

            .swal2-input {
                width: 90%;
                max-width: 220px;
                padding: 7px 10px;
                font-size: 13px;
            }

            .swal2-actions {
                margin-top: 8px;
                gap: 6px;
            }

            .swal2-confirm, .swal2-cancel {
                padding: 8px 18px; /* تقليل الحشوة قليلاً للشاشات الصغيرة */
                font-size: 13px;
                min-width: 100px;
            }

            .swal2-title {
                font-size: clamp(14px, 3vw, 18px);
            }

            .swal2-html-container .welcome-message {
                font-size: clamp(16px, 3vw, 18px);
            }
        }

        @media (min-width: 481px) and (max-width: 768px) {
            .container {
                width: 95%;
                padding: 16px 8px;
                margin: 8px auto;
            }

            .result-card {
                width: 90%;
                min-height: 190px;
            }

            .swal2-popup {
                width: 90%;
                max-width: 400px;
                padding: 20px;
            }

            .swal2-popup.new-similarities-popup {
                max-width: 320px;
                min-height: 200px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-title">مكتب عسل</div>
        <div class="header-buttons">
            <button class="header-btn back-btn" onclick="goBack()" title="رجوع"><i class="fas fa-arrow-right"></i> رجوع</button>
            <button class="header-btn refresh-btn" onclick="refreshData()" title="تحديث البيانات"><i class="fas fa-sync"></i> تحديث</button>
            <button class="header-btn notes-btn" onclick="toggleNotes()" title="عرض الملاحظات"><i class="fas fa-sticky-note"></i> ملاحظات <span class="notes-count" id="headerNotesCount">0</span></button>
        </div>
    </header>

    <div class="container">
        <!-- Logo -->
        <div class="notification-container">
            <div class="logo-container" id="logo">
                <img src="images/logo.png" alt="Logo">
            </div>
            <div class="notification" id="notification">
                <div class="notification-text" id="notification-text"></div>
            </div>
        </div>

        <!-- New Similarities Bar -->
        <div class="news-bar">
            <div class="breaking-news">توافقات جديدة</div>
            <div class="news-ticker-container">
                <div class="news-ticker" id="newSimilaritiesTicker">جاري تحميل التوافقات...</div>
            </div>
        </div>

        <!-- Categories -->
        <div class="categories">
            <button class="new-category-btn" onclick="showSubscriptionDetails()"><i class="fas fa-info-circle"></i> تفاصيل الاشتراك</button>
            <button class="category-btn" onclick="showUsageStats()"><i class="fas fa-shopping-cart"></i> إحصائيات الاستخدام</button>
            <button class="category-btn" onclick="showNewSimilarities()"><i class="fas fa-sync"></i> جديد التوافقات</button>
        </div>

        <!-- Slider -->
        <div class="slider-container">
            <button class="slider-btn prev-btn"><i class="fas fa-chevron-left"></i></button>
            <div class="slider" id="slider">
                <div class="category" onclick="filterByCategory('all')"><i class="fas fa-th-large"></i><span>الكل</span></div>
                <div class="category" onclick="filterByCategory('1')"><i class="fas fa-tv"></i><span>شاشات</span></div>
                <div class="category" onclick="filterByCategory('2')"><i class="fas fa-battery-full"></i><span>بطاريات</span></div>
                <div class="category" onclick="filterByCategory('3')"><i class="fas fa-bell"></i><span>جرس النغمات</span></div>
                <div class="category" onclick="filterByCategory('4')"><i class="fas fa-headphones"></i><span>سماعة الاتصال</span></div>
                <div class="category" onclick="filterByCategory('5')"><i class="fas fa-camera"></i><span>كاميرات</span></div>
                <div class="category" onclick="filterByCategory('6')"><i class="fas fa-camera-retro"></i><span>عدسة الكاميرا</span></div>
                <div class="category" onclick="filterByCategory('7')"><i class="fas fa-plug"></i><span>بورد الشحن</span></div>
                <div class="category" onclick="filterByCategory('8')"><i class="fas fa-charging-station"></i><span>قواعد الشحن</span></div>
                <div class="category" onclick="filterByCategory('9')"><i class="fas fa-plug"></i><span>كونكتر الشاشة</span></div>
                <div class="category" onclick="filterByCategory('10')"><i class="fas fa-fingerprint"></i><span>بصمات</span></div>
                <div class="category" onclick="filterByCategory('11')"><i class="fas fa-headphones-alt"></i><span>شريط الهيتفون</span></div>
                <div class="category" onclick="filterByCategory('12')"><i class="fas fa-volume-up"></i><span>شريط البور والصوت</span></div>
                <div class="category" onclick="filterByCategory('13')"><i class="fas fa-shield-alt"></i><span>گلاسات</span></div>
                <div class="category" onclick="filterByCategory('14')"><i class="fas fa-home"></i><span>شريط الهوم</span></div>
                <div class="category" onclick="filterByCategory('15')"><i class="fas fa-microchip"></i><span>آيسيات</span></div>
                <div class="category" onclick="filterByCategory('16')"><i class="fas fa-film"></i><span>فلاتات الشاشة</span></div>
                <div class="category" onclick="filterByCategory('17')"><i class="fas fa-sim-card"></i><span>هولدر السيم كارت</span></div>
                <div class="category" onclick="filterByCategory('18')"><i class="fas fa-fingerprint"></i><span>بصمات تحت الشاشة</span></div>
                <div class="category" onclick="filterByCategory('19')"><i class="fas fa-wifi"></i><span>كيبلات الإشارة</span></div>
                <div class="category" onclick="filterByCategory('20')"><i class="fas fa-cogs"></i><span>منوعة</span></div>
            </div>
            <button class="slider-btn next-btn"><i class="fas fa-chevron-right"></i></button>
        </div>

        <!-- Search -->
        <div class="search-container">
            <input type="text" id="searchInput" placeholder="Search for similarities...">
            <button onclick="searchItems()"><i class="fas fa-search"></i></button>
        </div>

        <!-- Results -->
        <div class="results-container" id="resultsContainer">
            <div class="products-grid" id="results"></div>
        </div>
    </div>

    <!-- Notes Drawer -->
    <div class="notes-drawer" id="notesDrawer">
        <i class="fas fa-times close-btn" onclick="toggleNotes()"></i>
        <h3>سلة الملاحظات</h3>
        <div class="notes-items-container" id="notesItems"></div>
    </div>

    <!-- Scroll to Top -->
    <button class="scroll-to-top" onclick="scrollToTop()"><i class="fas fa-arrow-up"></i></button>

    <!-- Footer -->
    <footer>
        <p>جميع الحقوق محفوظة - مكتب عسل</p>
    </footer>

    <script>


             let isAnimating = false; // للتحكم في تكرار الإشعار
        const dropboxSimilaritesFile = "https://assap-app-project.ahmed-al-bayatii-90.workers.dev/file2" + "?t=" + new Date().getTime();
        let database = {};
        let notes = JSON.parse(localStorage.getItem('notes')) || [];
        let stats = JSON.parse(localStorage.getItem('stats')) || { searches: 0, notesAdded: 0 };
        let currentCategory = null;

        const notifications = [
            "توافقات دقيقة بضغطة زر!",
            "اشتراكك يوفر وقتك وجهدك!",
            "تحديثات يومية لأحدث القطع!",
            "مكتب عسل: جودة وثقة مضمونة!",
            "سلة ملاحظات ذكية لتتبع اختياراتك!",
            "واجهة فاخرة لتجربة مميزة!",
            "20 نوع توافق بين يديك!",
            "أفضل اختيار لأهل الشغل الصح!",
            "إحصائيات استخدام لتحسين أدائك!",
            "مكتب عسل: التميز في كل قطعة!",
            "اشترك الآن واستمتع بالمميزات!",
            "توافقات شاملة لكل الأجهزة!",
            "عروض حصرية للمشتركين فقط!",
            "تصميم عصري يناسب احتياجاتك!",
            "مكتب عسل: رائد قطع الغيار!"
        ];

        const newSimilarities = [
            "شاشة iPhone 13 متوافقة مع iPhone 14",
            "بطارية Samsung S21 تناسب S22",
            "كاميرا Huawei P40 تعمل مع P50",
            "جرس iPhone 11 متوافق مع iPhone 12",
            "بورد شحن Xiaomi Mi 11 يناسب Mi 12"
        ];

       function triggerAnimation() {
    const logo = document.getElementById("logo");
    const notification = document.getElementById("notification");
    const notificationText = document.getElementById("notification-text");
    const resultsContainer = document.getElementById("resultsContainer");

    if (!logo || !notification || !notificationText || resultsContainer.classList.contains('visible') || isAnimating) {
        setTimeout(triggerAnimation, 100);
        return;
    }

    isAnimating = true; // منع التكرار

    logo.style.animation = "shake 0.5s ease-in-out";
    setTimeout(() => {
        logo.style.animation = "none";
    }, 500);

    setTimeout(() => {
        logo.style.animation = "explode 0.5s ease-out";
        logo.style.opacity = "0";
    }, 800);

    setTimeout(() => {
        const randomNotification = notifications[Math.floor(Math.random() * notifications.length)];
        notificationText.textContent = randomNotification;
        notification.classList.add("show");
    }, 1300);

    setTimeout(() => {
        notification.classList.remove("show");
        gsap.to(notification, {
            scale: 0.8,
            opacity: 0,
            rotation: 180,
            duration: 0.8,
            ease: "power2.inOut",
            onComplete: () => {
                notification.style.transform = "scale(0)";
            }
        });
    }, 5000);

    setTimeout(() => {
        gsap.set(logo, { scale: 0, opacity: 0, rotation: 0 });
        gsap.to(logo, {
            scale: 1,
            opacity: 1,
            rotation: 360, // تقليل الدوران من 720 إلى 360 ليكون أكثر سلاسة
            duration: 1.5, // زيادة المدة لتكون أطول وأكثر طبيعية
            ease: "power2.out" // تغيير الـ ease ليكون أكثر سلاسة
        });
    }, 6000);

    setTimeout(() => {
        isAnimating = false; // إعادة السماح بعد انتهاء الدورة
        triggerAnimation();
    }, 8500); // زيادة التأخير من 8000 إلى 8500
}

        function displayNewSimilarities() {
            const ticker = document.getElementById("newSimilaritiesTicker");
            const items = newSimilarities.map(item => `<span><i class="fas fa-sync"></i> ${item}</span>`);
            ticker.innerHTML = items.join(" | ");
        }

        function showUsageStats() {
            Swal.fire({
                title: 'إحصائيات الاستخدام',
                html: `
                    <div style="text-align: center; color: #dcdcdc; line-height: 1.6;">
                        <p><i class="fas fa-search"></i> عدد عمليات البحث: ${stats.searches}</p>
                        <p><i class="fas fa-sticky-note"></i> عدد الملاحظات المحفوظة: ${stats.notesAdded}</p>
                    </div>
                `,
                icon: 'info',
                confirmButtonText: 'موافق',
                allowOutsideClick: true,
                allowEscapeKey: true,
                customClass: {
                    popup: 'swal2-popup activation-popup',
                    title: 'swal2-title',
                    htmlContainer: 'swal2-html-container',
                    confirmButton: 'swal2-confirm'
                }
            }).then(() => {
                triggerAnimation();
            });
        }

        function showSubscriptionDetails() {
            Swal.fire({
                title: 'تفاصيل الاشتراك',
                html: `
                    <div style="text-align: center; color: #dcdcdc; line-height: 1.6;">
                        <p><i class="fas fa-star"></i> نوع الاشتراك: مميز</p>
                        <p><i class="fas fa-calendar-alt"></i> تاريخ البدء: 2025-01-01</p>
                        <p><i class="fas fa-calendar-alt"></i> تاريخ الانتهاء: 2026-01-01</p>
                        <p>اشتراكك المميز يوفرلك توافقات دقيقة، تحديثات يومية، وتجربة فريدة!</p>
                    </div>
                `,
                icon: 'info',
                confirmButtonText: 'موافق',
                allowOutsideClick: true,
                allowEscapeKey: true,
                customClass: {
                    popup: 'swal2-popup activation-popup',
                    title: 'swal2-title',
                    htmlContainer: 'swal2-html-container',
                    confirmButton: 'swal2-confirm'
                }
            }).then(() => {
                triggerAnimation();
            });
        }

        function showNewSimilarities() {
            const items = newSimilarities.map(item => `
                <div style="background: linear-gradient(135deg, rgba(0, 0, 0, 0.5), rgba(50, 50, 50, 0.3)); border-radius: 15px; padding: 15px; text-align: center;">
                    ${item}
                </div>
            `).join('');
            Swal.fire({
                title: 'جديد التوافقات',
                html: `
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        ${items}
                    </div>
                `,
                icon: 'info',
                confirmButtonText: 'موافق',
                allowOutsideClick: true,
                allowEscapeKey: true,
                customClass: {
                    popup: 'swal2-popup activation-popup new-similarities-popup',
                    title: 'swal2-title',
                    htmlContainer: 'swal2-html-container',
                    confirmButton: 'swal2-confirm'
                }
            }).then(() => {
                triggerAnimation();
            });
        }

        $(document).ready(function() {
            triggerAnimation();
            displayNewSimilarities();

            const slider = document.getElementById('slider');
            const prevBtn = document.querySelector('.prev-btn');
            const nextBtn = document.querySelector('.next-btn');

            prevBtn.addEventListener('click', () => {
                slider.scrollBy({ left: -100, behavior: 'smooth' });
            });

            nextBtn.addEventListener('click', () => {
                slider.scrollBy({ left: 100, behavior: 'smooth' });
            });

            // تحديد الأصناف التي تحتوي على كلمتين أو أكثر وثلاث كلمات
            document.querySelectorAll('.category span').forEach(span => {
                const text = span.textContent.trim();
                const wordCount = text.split(/\s+/).length;
                if (wordCount >= 2) {
                    span.classList.add('multi-word');
                }
                if (wordCount >= 3) {
                    span.classList.add('three-words');
                }
            });
        });

        async function loadSimilaritesData() {
            const response = await fetch(dropboxSimilaritesFile);
            const buffer = await response.arrayBuffer();
            const workbook = XLSX.read(buffer, { type: "array" });
            database.SIMILARITES = XLSX.utils.sheet_to_json(workbook.Sheets["SIMILARITES"] || {}).map(item => ({
                Item: item.Item || "غير مسمى",
                Category: item.Category || 20
            }));
        }

        async function getDeviceId() {
            try {
                let deviceId = localStorage.getItem('deviceId');
                if (!deviceId) {
                    const fp = await FingerprintJS.load();
                    const result = await fp.get();
                    deviceId = result.visitorId;
                    localStorage.setItem('deviceId', deviceId);
                }
                return deviceId;
            } catch (error) {
                throw error;
            }
        }

        async function showPasswordPrompt() {
            const { value: password } = await Swal.fire({
                title: 'دخول محمي',
                html: `
                    <div class="welcome-message">
                        هلا بيك بخدمتنا <span class="highlight">المميزة</span> .. اذا انت مشترك ويانة ادخل كلمة المرور .. وراها رح تدخل على <span class="highlight">كنز التوافقات</span> .. يعني تعرف شنو يرهم على شنو .. وفر وقتك وخلي شغلك <span class="highlight">نظيف</span> .. هاي الخدمة وفرناها الك اذا انت من اهل <span class="highlight">الشغل الصح</span>
                    </div>
                `,
                icon: 'question',
                input: 'password',
                inputPlaceholder: 'كلمة المرور',
                showCancelButton: true,
                confirmButtonText: 'تأكيد',
                cancelButtonText: 'إغلاق',
                allowOutsideClick: true,
                allowEscapeKey: true
            });
            return password;
        }

        async function verifyPassword(password, db) {
            Swal.fire({
                title: 'جاري الدخول...',
                text: 'يرجى الانتظار',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });

            try {
                const codeRef = db.collection('passwords').doc(password);
                const doc = await codeRef.get();

                if (!doc.exists) {
                    await Swal.fire({
                        icon: 'error',
                        title: 'خطأ',
                        html: `
                            <div class="welcome-message">
                                كلمة المرور غير صحيحة! <br>
                                مبين بعدك ما مفعل <span class="highlight">الخدمة</span> !! .. بس صدكني ديضيع عليك هواية .. <span class="highlight">توافقات جاهزة</span> .. <span class="highlight">وقت اقل</span> .. <span class="highlight">شغل ادق</span> ... فعل دخولك وخليك دائما <span class="highlight">مميز</span>
                            </div>
                        `,
                        showConfirmButton: true,
                        confirmButtonText: 'حاول مرة أخرى',
                        timer: 5000,
                        timerProgressBar: true,
                        allowOutsideClick: true,
                        allowEscapeKey: true
                    });
                    triggerAnimation();
                    return false;
                }

                const data = doc.data();
                const deviceId = await getDeviceId();

                if (!data.used) {
                    await codeRef.update({
                        deviceId: deviceId,
                        used: true,
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    localStorage.setItem("password", password);
                    await loadSimilaritesData();
                    updateNotes();
                    await Swal.fire({
                        icon: 'success',
                        title: 'تم الدخول بنجاح',
                        text: 'تم تفعيل كلمة المرور بنجاح!',
                        confirmButtonText: 'موافق',
                        allowOutsideClick: true,
                        allowEscapeKey: true
                    });
                    triggerAnimation();
                    return true;
                } else {
                    if (data.deviceId === deviceId) {
                        localStorage.setItem("password", password);
                        await loadSimilaritesData();
                        updateNotes();
                        await Swal.fire({
                            icon: 'success',
                            title: 'تم الدخول بنجاح',
                            text: 'كلمة المرور صحيحة!',
                            confirmButtonText: 'موافق',
                            allowOutsideClick: true,
                            allowEscapeKey: true
                        });
                        triggerAnimation();
                        return true;
                    } else {
                        await Swal.fire({
                            icon: 'error',
                            title: 'خطأ',
                            text: 'كلمة المرور مستخدمة على جهاز آخر!',
                            showConfirmButton: true,
                            confirmButtonText: 'حاول مرة أخرى',
                            timer: 3000,
                            timerProgressBar: true,
                            allowOutsideClick: true,
                            allowEscapeKey: true
                        });
                        triggerAnimation();
                        return false;
                    }
                }
            } catch (error) {
                await Swal.fire({
                    icon: 'error',
                    title: 'خطأ',
                    text: error.message.includes('offline') ? 'أنت غير متصل بالإنترنت. يرجى التحقق من الاتصال.' : 'حدث خطأ: ' + error.message,
                    showConfirmButton: true,
                    confirmButtonText: 'حاول مرة أخرى',
                    timer: 3000,
                    timerProgressBar: true,
                    allowOutsideClick: true,
                    allowEscapeKey: true
                });
                triggerAnimation();
                return false;
            }
        }

        window.onload = async function() {
            let db;
            try {
                const firebaseConfig = {
                    apiKey: "AIzaSyD_Nqmd2X3UY0mkK31QXKd-6B9KLE3ipYA",
                    authDomain: "assal-office.firebaseapp.com",
                    projectId: "assal-office",
                    storageBucket: "assal-office.firebasestorage.app",
                    messagingSenderId: "939160864143",
                    appId: "1:939160864143:web:0900fffc74e4037898b7fa",
                    measurementId: "G-YXL3KPKLD3"
                };
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
            } catch (error) {
                await Swal.fire({
                    icon: 'error',
                    title: 'خطأ',
                    text: 'فشل في تهيئة قاعدة البيانات: ' + error.message,
                    confirmButtonText: 'موافق',
                    allowOutsideClick: true,
                    allowEscapeKey: true,
                    customClass: {
                        popup: 'swal2-popup activation-popup',
                        title: 'swal2-title',
                        htmlContainer: 'swal2-html-container',
                        confirmButton: 'swal2-confirm'
                    }
                });
                window.location.href = 'index.html';
                return;
            }

            const storedPassword = localStorage.getItem("password");
            if (storedPassword) {
                const success = await verifyPassword(storedPassword, db);
                if (!success) {
                    while (true) {
                        const password = await showPasswordPrompt();
                        if (!password) {
                            window.location.href = 'index.html';
                            break;
                        }
                        const success = await verifyPassword(password, db);
                        if (success) break;
                    }
                }
            } else {
                while (true) {
                    const password = await showPasswordPrompt();
                    if (!password) {
                        window.location.href = 'index.html';
                        break;
                    }
                    const success = await verifyPassword(password, db);
                    if (success) break;
                }
            }
        };

        document.getElementById("searchInput").addEventListener("keydown", function(event) {
            if (event.key === "Enter") {
                event.preventDefault();
                searchItems();
            }
        });

        function normalizeString(str) {
            return str.replace(/\s+/g, '').toLowerCase();
        }

        function filterByCategory(category) {
            currentCategory = category;
            document.querySelectorAll(".category").forEach(cat => cat.classList.remove("active"));
            const selectedCategory = document.querySelector(`.category[onclick="filterByCategory('${category}')"]`);
            if (selectedCategory) {
                selectedCategory.classList.add("active");
            }
            let results = database.SIMILARITES;
            if (category !== 'all') {
                results = results.filter(item => String(item.Category) === category);
            }
            displayResults(results);
            scrollToResults();
            stats.searches++;
            localStorage.setItem('stats', JSON.stringify(stats));
        }

        function searchItems() {
            const searchInput = document.getElementById("searchInput").value.trim();
            const resultsContainer = document.getElementById("resultsContainer");

            if (!searchInput && !currentCategory) {
                Swal.fire({
                    title: 'حقل فارغ',
                    text: 'يرجى اختيار صنف أو كتابة اسم العنصر قبل البحث',
                    icon: 'warning',
                    showConfirmButton: true,
                    confirmButtonText: 'موافق',
                    showCancelButton: true,
                    cancelButtonText: 'إغلاق',
                    allowOutsideClick: true,
                    allowEscapeKey: true,
                    customClass: {
                        popup: 'swal2-popup activation-popup',
                        title: 'swal2-title',
                        htmlContainer: 'swal2-html-container',
                        confirmButton: 'swal2-confirm',
                        cancelButton: 'swal2-cancel'
                    }
                }).then(() => {
                    triggerAnimation();
                });
                resultsContainer.classList.remove('visible');
                return;
            }

            let results = database.SIMILARITES;
            if (currentCategory && currentCategory !== 'all') {
                results = results.filter(item => String(item.Category) === currentCategory);
            }
            if (searchInput) {
                const query = normalizeString(searchInput);
                results = results.filter(item => normalizeString(item["Item"]).includes(query));
            }

            if (results.length === 0) {
                Swal.fire({
                    title: 'لا توجد نتائج',
                    text: 'ماكو توافقات بهذا الاسم أو الصنف',
                    icon: 'info',
                    showConfirmButton: true,
                    confirmButtonText: 'موافق',
                    showCancelButton: true,
                    cancelButtonText: 'إغلاق',
                    allowOutsideClick: true,
                    allowEscapeKey: true,
                    customClass: {
                        popup: 'swal2-popup activation-popup',
                        title: 'swal2-title',
                        htmlContainer: 'swal2-html-container',
                        confirmButton: 'swal2-confirm',
                        cancelButton: 'swal2-cancel'
                    }
                }).then(() => {
                    triggerAnimation();
                });
                resultsContainer.classList.remove('visible');
                return;
            }

           stats.searches++;
            localStorage.setItem('stats', JSON.stringify(stats));
            displayResults(results);
            scrollToResults();
        }

        function displayResults(results) {
            const resultsContainer = document.getElementById("resultsContainer");
            const productsGrid = document.getElementById("results");
            productsGrid.innerHTML = results.map(item => `
                <div class="result-card">
                    <img src="images/default.png" alt="Item Image" loading="lazy">
                    <h4>${item["Item"]}</h4>
                    <button onclick="addToNotes('${item["Item"]}')">أضف إلى الملاحظات</button>
                </div>
            `).join('');

            if (results.length > 0) {
                resultsContainer.classList.add('visible');
            } else {
                resultsContainer.classList.remove('visible');
            }

            const scrollButton = document.querySelector('.scroll-to-top');
            if (results.length > 0) { // تغيير الشرط لإظهار زر الصعود حتى لو كان عدد النتائج أقل من 5
                scrollButton.classList.add('visible');
            } else {
                scrollButton.classList.remove('visible');
            }
        }

        function scrollToResults() {
            const resultsContainer = document.getElementById("resultsContainer");
            if (resultsContainer.classList.contains('visible')) {
                setTimeout(() => {
                    const rect = resultsContainer.getBoundingClientRect();
                    const offset = window.scrollY + rect.top - 60;
                    window.scrollTo({
                        top: offset,
                        behavior: 'smooth'
                    });
                }, 100);
            }
        }

        function toggleNotes() {
            const notesDrawer = document.getElementById('notesDrawer');
            notesDrawer.classList.toggle('active');
        }

        function addToNotes(itemName) {
            notes.push({ name: itemName });
            stats.notesAdded++;
            localStorage.setItem('notes', JSON.stringify(notes));
            localStorage.setItem('stats', JSON.stringify(stats));
            updateNotes();
        }

        function updateNotes() {
            const notesItems = document.getElementById('notesItems');
            const headerNotesCount = document.getElementById('headerNotesCount');
            notesItems.innerHTML = '';

            notes.forEach((item, index) => {
                const notesItem = document.createElement('div');
                notesItem.classList.add('notes-item');
                notesItem.innerHTML = `
                    <span>${item.name}</span>
                    <button onclick="removeFromNotes(${index})">إزالة</button>
                `;
                notesItems.appendChild(notesItem);
            });

            headerNotesCount.textContent = notes.length;
            if (notes.length > 0) {
                headerNotesCount.classList.add('visible');
            } else {
                headerNotesCount.classList.remove('visible');
            }
        }

        function removeFromNotes(index) {
            notes.splice(index, 1);
            stats.notesAdded--;
            localStorage.setItem('notes', JSON.stringify(notes));
            localStorage.setItem('stats', JSON.stringify(stats));
            updateNotes();
        }

        function goBack() {
            window.location.href = "index.html";
        }

        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        async function refreshData() {
            Swal.fire({
                html: `
                    <div style="display: flex; flex-direction: column; align-items: center;">
                        <div class="loading-circle"></div>
                        <p style="margin-top: 20px; font-size: 18px; color: #dcdcdc;">جاري التحديث...</p>
                    </div>
                `,
                showConfirmButton: false,
                allowOutsideClick: true,
                allowEscapeKey: true,
                customClass: {
                    popup: 'swal2-popup activation-popup'
                }
            });

            try {
                await loadSimilaritesData();
                await new Promise(resolve => setTimeout(resolve, 1000));
                await Swal.fire({
                    title: 'تم التحديث',
                    text: 'تم تحديث البيانات بنجاح',
                    icon: 'success',
                    confirmButtonText: 'موافق',
                    allowOutsideClick: true,
                    allowEscapeKey: true,
                    customClass: {
                        popup: 'swal2-popup activation-popup',
                        title: 'swal2-title',
                        htmlContainer: 'swal2-html-container',
                        confirmButton: 'swal2-confirm'
                    }
                });
                triggerAnimation();
            } catch (error) {
                await Swal.fire({
                    title: 'خطأ',
                    text: 'حدث خطأ أثناء التحديث',
                    icon: 'error',
                    confirmButtonText: 'موافق',
                    allowOutsideClick: true,
                    allowEscapeKey: true,
                    customClass: {
                        popup: 'swal2-popup activation-popup',
                        title: 'swal2-title',
                        htmlContainer: 'swal2-html-container',
                        confirmButton: 'swal2-confirm'
                    }
                });
                triggerAnimation();
            }
        }
    </script>
</body>
</html>
