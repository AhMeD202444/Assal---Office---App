<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Phone Parts Pro</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/gsap.min.js"></script>
    
    <!-- PDF libs -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.2/dist/jspdf.plugin.autotable.min.js"></script>



    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" referrerpolicy="no-referrer" />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">


    <style>



/* تنسيق الدائرة العائمة */
.floating-new-btn {
    position: fixed;
    bottom: 50px; /* تقليل الارتفاع ليكون أقرب إلى الفوتر */
    left: 20px; /* الجهة اليمنى كما هي */
    width: 50px;
    height: 50px;
    background: linear-gradient(45deg, #43cea2, #185a9d);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
    font-family: 'Cairo', sans-serif;
    font-size: 16px;
    font-weight: bold;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    cursor: pointer;
    z-index: 1000;
    user-select: none;
}

/* شارة عدد العناصر الجديدة */
.new-items-count {
    position: absolute;
    top: -5px;
    right: -5px;
    background: #FF416C;
    color: #fff;
    font-size: 12px;
    font-weight: bold;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
}

/* تنسيق النافذة المنبثقة للعناصر الجديدة */
/* تنسيق النافذة المنبثقة للعناصر الجديدة */
#newItemsModal {
    position: fixed;
    top: 50px; /* أسفل الهيدر (40px + 10px مسافة) */
    bottom: 60px; /* أعلى الفوتر (~50px + 10px مسافة) */
    left: 50%;
    transform: translateX(-50%);
    width: calc(100% - 20px); /* عرض الواجهة مع 10px مسافة من اليمين واليسار */
    max-width: 800px; /* الحد الأقصى للعرض للشاشات الكبيرة */
    background: linear-gradient(135deg, rgba(0, 0, 0, 0.95), rgba(30, 30, 30, 0.8));
    backdrop-filter: blur(15px);
    border-radius: 5px;
    padding: 25px;
    z-index: 10000;
    display: none;
    flex-direction: column;
    align-items: center;
}

#newItemsModal h2 {
    font-size: 28px;
    font-family: 'Cairo', sans-serif;
    color: #fff;
    background: linear-gradient(45deg, #43cea2, #185a9d);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 25px;
    text-align: center;
    text-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
}

#newItemsModal .modal-content {
    width: 100%;
    height: 100%; /* شغل كل الارتفاع المتاح */
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

/* إخفاء مسطرة السكرول مع السماح بالتمرير */
#newItemsModal .modal-content::-webkit-scrollbar {
    display: none; /* إخفاء المسطرة على متصفحات Webkit (مثل Chrome وSafari) */
}

/* إخفاء المسطرة على متصفحات أخرى (مثل Firefox) */
#newItemsModal .modal-content {
    -ms-overflow-style: none; /* لـ Internet Explorer و Edge */
    scrollbar-width: none; /* لـ Firefox */
}

#newItemsModal .modal-content .new-item-card {
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(0, 0, 0, 0.5));
    border-radius: 12px;
    padding: 12px;
    display: flex;
    align-items: center;
    gap: 12px;
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
    position: relative;
    border: 1px solid rgba(67, 206, 162, 0.3);
}

/* تنسيق الدائرة التي تحل محل الصورة */
#newItemsModal .modal-content .new-item-card .category-circle {
    width: 60px;
    height: 60px;
    background: linear-gradient(45deg, #8B0000, #B22222); /* أحمر غامق متدرج */
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    border: none; /* إزالة الحدود الملونة */
    font-family: 'Cairo', sans-serif;
    font-size: 12px;
    font-weight: bold;
    color: #fff;
    text-align: center;
    line-height: 1.2;
    padding: 5px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
}

#newItemsModal .modal-content .new-item-card .item-details {
    flex: 1;
    text-align: left;
    color: #fff;
    font-family: 'Cairo', sans-serif;
    position: relative;
    padding-top: 22px; /* زيادة الحشوة لخفض النص أكثر وتجنب التداخل */
    overflow-wrap: break-word; /* السماح بالتفاف النصوص الطويلة */
}

#newItemsModal .modal-content .new-item-card .item-details .new-badge {
    position: absolute;
    top: -5px;
    right: -5px;
    background: linear-gradient(45deg, #8B0000, #B22222); /* أحمر غامق */
    color: #fff;
    font-size: 12px; /* حجم نص أكبر للوضوح */
    font-weight: bold;
    padding: 5px 10px; /* حشوة أكبر لمظهر أوضح */
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
}

#newItemsModal .modal-content .new-item-card .item-details h4 {
    font-size: 16px;
    margin: 0 0 6px 0;
    color: #fff;
    display: flex;
    align-items: center;
    gap: 8px;
    white-space: normal; /* السماح بالانتقال إلى سطر جديد */
    overflow-wrap: break-word; /* التفاف النصوص الطويلة */
    max-width: 100%; /* ضمان عدم التجاوز */
}

#newItemsModal .modal-content .new-item-card .item-details h4 i {
    font-size: 14px;
    color: #43cea2;
}

#newItemsModal .modal-content .new-item-card .item-details p {
    font-size: 14px;
    margin: 0;
    color: #dcdcdc;
    background: linear-gradient(45deg, #4682B4, #20B2AA);
    padding: 4px 8px;
    border-radius: 6px;
    display: inline-block;
}


#newItemsModal .close-modal-btn {
    position: absolute;
    top: 15px;
    right: 15px;
    background: linear-gradient(45deg, #FF416C, #FF4B2B);
    border: none;
    border-radius: 50%;
    width: 35px;
    height: 35px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
    font-size: 18px;
    cursor: pointer;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
}

/* تأثيرات الدخول والخروج */
@keyframes slideDownModal {
    0% {
        transform: translate(-50%, -100%);
        opacity: 0;
    }
    100% {
        transform: translate(-50%, 0);
        opacity: 1;
    }
}

@keyframes slideUpModal {
    0% {
        transform: translate(-50%, 0);
        opacity: 1;
    }
    100% {
        transform: translate(-50%, -100%);
        opacity: 0;
    }
}



/* Media Queries للتوافق مع الشاشات الصغيرة */
@media (max-width: 480px) {
    #newItemsModal {
        top: 45px;
        bottom: 55px;
        width: calc(100% - 10px);
        padding: 15px;
        border-radius: 5; /* أو القيمة المطلوبة مثل 5px */
    }
    #newItemsModal h2 {
        font-size: 24px;
        margin-bottom: 15px;
    }
    #newItemsModal .modal-content .new-item-card {
        padding: 10px;
        gap: 10px;
    }
    #newItemsModal .modal-content .new-item-card .category-circle {
        width: 50px;
        height: 50px;
        font-size: 10px;
    }
    #newItemsModal .modal-content .new-item-card .item-details {
        padding-top: 18px; /* زيادة الحشوة لخفض النص وتجنب التداخل */
    }
    #newItemsModal .modal-content .new-item-card .item-details .new-badge {
        font-size: 10px; /* حجم نص أكبر للشاشات الصغيرة */
        padding: 4px 8px; /* حشوة أكبر للوضوح */
    }
    #newItemsModal .modal-content .new-item-card .item-details h4 {
        font-size: 14px;
        line-height: 1.4;
    }
    #newItemsModal .modal-content .new-item-card .item-details p {
        font-size: 12px;
        padding: 3px 6px;
    }
    #newItemsModal .close-modal-btn {
        width: 30px;
        height: 30px;
        font-size: 16px;
    }
}

/* Media Queries للشاشات المتوسطة (تابلت) */
@media (min-width: 481px) and (max-width: 768px) {
    #newItemsModal {
        top: 48px;
        bottom: 58px;
        width: calc(100% - 15px);
        padding: 20px;
        border-radius: 5; /* أو القيمة المطلوبة مثل 5px */
    }
    #newItemsModal h2 {
        font-size: 26px;
        margin-bottom: 20px;
    }
    #newItemsModal .modal-content .new-item-card {
        padding: 11px;
        gap: 11px;
    }
    #newItemsModal .modal-content .new-item-card .category-circle {
        width: 55px;
        height: 55px;
        font-size: 11px;
    }
    #newItemsModal .modal-content .new-item-card .item-details {
        padding-top: 19px; /* زيادة الحشوة لتجنب التداخل */
    }
    #newItemsModal .modal-content .new-item-card .item-details .new-badge {
        font-size: 11px; /* حجم وسطي */
        padding: 4px 9px;
    }
    #newItemsModal .modal-content .new-item-card .item-details h4 {
        font-size: 15px;
        line-height: 1.3;
    }
}


    /* تخصيص نافذة التفعيل */
/* تخصيص نافذة التفعيل */
.swal2-popup.activation-popup {
    background: rgba(0, 0, 0, 0.9);
    backdrop-filter: blur(20px);
    border-radius: clamp(15px, 3vw, 25px);
    width: clamp(80%, 90vw, 90%);
    max-width: 600px;
    padding: clamp(20px, 5vw, 40px);
    box-shadow: 0 0 60px rgba(70, 130, 180, 0.8), 0 0 20px rgba(255, 255, 255, 0.3);
    font-family: 'Cairo', sans-serif !important;
    color: #fff;
    text-align: center;
    z-index: 10000 !important;
    position: relative;
    animation: glow 2s infinite alternate;
}

@keyframes glow {
    0% { box-shadow: 0 0 20px rgba(70, 130, 180, 0.6), 0 0 40px rgba(255, 255, 255, 0.2); }
    100% { box-shadow: 0 0 30px rgba(70, 130, 180, 1), 0 0 60px rgba(255, 255, 255, 0.4); }
}

.swal2-popup.activation-popup .swal2-title {
    font-size: clamp(24px, 6vw, 32px);
    font-weight: bold;
    color: #fff;
    text-shadow: 0 2px 6px rgba(0, 0, 0, 0.8);
    margin-bottom: clamp(10px, 3vw, 20px);
    background: linear-gradient(135deg, #43cea2, #185a9d);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.swal2-popup.activation-popup .swal2-html-container {
    font-size: clamp(16px, 4vw, 20px);
    color: #dcdcdc;
    line-height: 1.6;
    margin: clamp(10px, 3vw, 20px) 0;
}

.swal2-popup.activation-popup .swal2-input {
    width: clamp(75%, 85vw, 85%);
    padding: clamp(10px, 3vw, 15px) clamp(15px, 4vw, 20px);
    font-size: clamp(14px, 4vw, 18px);
    color: #fff;
    background: rgba(255, 255, 255, 0.15);
    border: 2px solid rgba(255, 255, 255, 0.4);
    border-radius: clamp(8px, 2vw, 12px);
    box-shadow: inset 0 2px 6px rgba(0, 0, 0, 0.5);
    margin: clamp(10px, 3vw, 20px) auto;
    font-family: 'Cairo', sans-serif !important;
    transition: all 0.3s ease;
}

.swal2-popup.activation-popup .swal2-input:focus {
    border: 2px solid #43cea2;
    box-shadow: 0 0 12px #43cea2;
    background: rgba(255, 255, 255, 0.2);
}

.swal2-popup.activation-popup .swal2-confirm {
    background: linear-gradient(135deg, #43cea2, #185a9d);
    padding: clamp(8px, 2vw, 12px) clamp(20px, 5vw, 30px);
    font-size: clamp(14px, 4vw, 18px);
    border-radius: clamp(15px, 3vw, 25px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
    transition: all 0.3s ease;
}

.swal2-popup.activation-popup .swal2-cancel {
    background: linear-gradient(135deg, #FF416C, #FF4B2B);
    padding: clamp(8px, 2vw, 12px) clamp(20px, 5vw, 30px);
    font-size: clamp(14px, 4vw, 18px);
    border-radius: clamp(15px, 3vw, 25px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
    transition: all 0.3s ease;
}

.swal2-popup.activation-popup .swal2-confirm:hover,
.swal2-popup.activation-popup .swal2-cancel:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 16px rgba(255, 255, 255, 0.4);
}

.swal2-popup.activation-popup .swal2-confirm:active,
.swal2-popup.activation-popup .swal2-cancel:active {
    transform: scale(0.95);
    box-shadow: inset 0 4px 8px rgba(0, 0, 0, 0.6);
}

/* Media Queries للتوافق مع الأجهزة الصغيرة */
@media (max-width: 480px) {
    .swal2-popup.activation-popup {
        width: 95%;
        padding: 15px;
    }
    .swal2-popup.activation-popup .swal2-title {
        font-size: 20px;
    }
    .swal2-popup.activation-popup .swal2-html-container {
        font-size: 14px;
    }
    .swal2-popup.activation-popup .swal2-input {
        padding: 8px 12px;
        font-size: 14px;
    }
    .swal2-popup.activation-popup .swal2-confirm,
    .swal2-popup.activation-popup .swal2-cancel {
        padding: 8px 20px;
        font-size: 14px;
    }
}

/* Media Queries للأجهزة المتوسطة (تابلت) */
@media (min-width: 481px) and (max-width: 768px) {
    .swal2-popup.activation-popup {
        width: 90%;
        padding: 25px;
    }
    .swal2-popup.activation-popup .swal2-title {
        font-size: 26px;
    }
    .swal2-popup.activation-popup .swal2-html-container {
        font-size: 16px;
    }
    .swal2-popup.activation-popup .swal2-input {
        padding: 10px 15px;
        font-size: 16px;
    }
    .swal2-popup.activation-popup .swal2-confirm,
    .swal2-popup.activation-popup .swal2-cancel {
        padding: 10px 25px;
        font-size: 16px;
    }
}
    
     @keyframes shake {
    0%, 100% { transform: translate(0, 0); }
    25% { transform: translate(-4px, 4px) rotate(-3deg); }
    50% { transform: translate(4px, -4px) rotate(3deg); }
    75% { transform: translate(-4px, 4px) rotate(-3deg); }
}

@keyframes explode {
    0% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.6); opacity: 0.7; filter: blur(3px); }
    100% { transform: scale(2); opacity: 0; filter: blur(6px); }
}

@keyframes screenPop {
    0% { transform: scale(0) rotate(0deg); opacity: 0; box-shadow: none; }
    50% { transform: scale(1.1) rotate(360deg); opacity: 1; box-shadow: 0 0 20px rgba(70, 130, 180, 0.8), 0 0 40px rgba(70, 130, 180, 0.4); }
    100% { transform: scale(1) rotate(720deg); opacity: 1; box-shadow: 0 0 15px rgba(70, 130, 180, 0.6); }
}

@keyframes pulseGlow {
    0% { box-shadow: 0 0 15px rgba(70, 130, 180, 0.6); }
    50% { box-shadow: 0 0 25px rgba(70, 130, 180, 1), 0 0 40px rgba(70, 130, 180, 0.5); }
    100% { box-shadow: 0 0 15px rgba(70, 130, 180, 0.6); }
}

@keyframes textFadeIn {
    0% { opacity: 0; transform: translateY(10px); }
    100% { opacity: 1; transform: translateY(0); }
}

/* تعديل المسافات بين الشعار والهيدر وشريط الأخبار */
.notification-container {
    position: relative;
    width: 160px;
    height: 160px;
    margin: 0 auto 2px;
}



.notification {
    position: absolute;
    top: 0;
    left: 0;
    width: 160px; /* مطابقة حجم الشعار */
    height: 160px; /* مطابقة حجم الشعار */
    background: linear-gradient(45deg, #4682B4, #20B2AA);
    border: 3px solid #4682B4;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    opacity: 0;
    transform: scale(0);
    z-index: 2;
}

.notification.show {
    animation: screenPop 0.7s ease-out forwards, pulseGlow 1.5s infinite;
}

.notification-text {
    font-family: 'Tajawal', sans-serif;
    font-size: 18px; /* يمكنك زيادته إلى 20px إذا كان النص صغيرًا جدًا */
    font-weight: 700;
    color: #ffffff;
    text-shadow: 0 0 5px rgba(255, 255, 255, 0.8);
    padding: 10px;
    text-align: center;
    max-width: 140px; /* زيادة لتناسب الحجم الجديد */
    opacity: 0;
    letter-spacing: 1px;
}

.notification.show .notification-text {
    animation: textFadeIn 0.5s ease-out forwards;
    animation-delay: 0.7s;
}

.notification::before {
    content: '';
    position: absolute;
    top: -5px;
    left: -5px;
    right: -5px;
    bottom: -5px;
    background: linear-gradient(45deg, #4682B4, #20B2AA);
    filter: blur(10px);
    opacity: 0.7;
    z-index: -1;
    border-radius: 50%;
}

  

 @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-circle {
            width: 80px;
            height: 80px;
            border: 8px solid rgba(255, 255, 255, 0.2);
            border-top: 8px solid #43cea2;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
  

/* ✅ طبقة الـ Overlay مع تأثير شفافية */
#overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(10px);
    z-index: 9998;
    display: none;
    transition: opacity 0.3s ease-in-out;
}



@keyframes slideDown {
    0% {
        transform: translate(-50%, -100%);
        opacity: 0;
    }
    100% {
        transform: translate(-50%, -50%);
        opacity: 1;
    }
}

@keyframes slideUp {
    0% {
        transform: translate(-50%, -50%);
        opacity: 1;
    }
    100% {
        transform: translate(-50%, -120%);
        opacity: 0;
    }
}

/* ✅ نافذة إعلان مودرن */
#promoPopup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -100%); /* مهم حتى يشتغل slideDown/slideUp */
    width: min(420px, 92vw);
    background:
        radial-gradient(circle at top left, rgba(67, 206, 162, 0.15), transparent),
        rgba(15, 23, 42, 0.97); /* dark glassy */
    backdrop-filter: blur(18px);
    padding: 20px 18px 16px;
    border-radius: 18px;
    text-align: center;
    color: #e5e7eb;
    box-shadow: 0 18px 40px rgba(0, 0, 0, 0.85);
    display: none;
    flex-direction: column;
    gap: 12px;
    z-index: 9999;
}


#promoImage {
    width: 100%;
    max-width: 250px;
    border-radius: 15px;
    transition: transform 0.3s ease;
    cursor: pointer;
    overflow: hidden !important;
    clip-path: inset(0 0 0 0 round 15px) !important;
    object-fit: cover;
}

#promoImage:hover {
    transform: scale(1.05);
}

/* ✅ تحسين عنوان النافذة */
.popup-title {
    font-size: 26px;
    font-weight: bold;
    text-shadow: 0 0 30px rgba(255, 255, 255, 0.8);
    background: linear-gradient(135deg, #ffcc00, #ff0066);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

/* ✅ تحسين زر الإغلاق */
#closeBtn {
    padding: 12px 30px;
    font-size: 18px;
    font-weight: bold;
    color: white;
    background: linear-gradient(135deg, #ff0066, #ffcc00);
    border: none;
    border-radius: 25px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 0 30px rgba(255, 0, 255, 0.7);
    animation: pulseEffect 2s infinite alternate;
    margin-top: 15px;
    overflow: hidden !important; /* قص أي محتوى أو تأثير خارج الحدود */
    clip-path: inset(0 0 0 0 round 25px) !important; /* قص صارم يطابق border-radius */
    font-family: 'Cairo', sans-serif !important; /* تغيير الخط إلى كايرو */
}

#closeBtn:hover {
    transform: scale(1.1);
    background: linear-gradient(45deg, #43cea2, #185a9d);
}

#closeBtn:active {
    transform: scale(0.95);
    background: linear-gradient(45deg, #43cea2, #185a9d);
    box-shadow: inset 0 4px 8px rgba(0, 0, 0, 0.5) !important; /* ظل داخلي فقط */
    clip-path: inset(0 0 0 0 round 25px) !important; /* تأكيد القص الدائري عند الضغط */
}



        /* Reset and basics */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

     body {
    font-family: 'Tajawal', sans-serif;
    background: linear-gradient(135deg, #3A6073, #16222A);
    color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    min-height: 100vh;
    padding: 40px 0 50px 0; /* علوية 40px للهيدر، سفلية 50px للفوتر */
    margin: 0;
    background-size: 400% 400%;
    animation: gradientAnimation 10s ease infinite;
}
        @keyframes gradientAnimation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        

     /* تعديل المسافات داخل container */
.container {
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(0, 0, 0, 0.1));
    background-size: 400% 400%;
    animation: gradientAnimation 10s ease infinite;
    border-radius: 20px;
    padding: 20px 10px;
    text-align: center;
    width: 90%;
    max-width: 800px;
    margin: 10px auto 20px auto; /* زيادة المسافة السفلية إلى 30px */
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
    backdrop-filter: blur(10px);
    display: flex;
    flex-direction: column;
    gap: 8px;
}


@media (max-width: 768px) {
   .container {
        width: 95%;
        padding: 16px 8px; /* تقليل padding-top إلى 16px للشاشات المتوسطة */
        margin: 8px auto;
    }
    .search-container {
        margin: 8px 0 16px 0; /* تقليل margin-bottom إلى 16px للشاشات المتوسطة */
    }
    
}
    .results-container {
        max-width: 95%; /* ضبط العرض */
        padding: 8px; /* تقليل الحشوة */
        gap: 10px; /* تقليل المسافة بين العناصر */
    }

    .result-card {
        padding: 10px; /* تقليل الحشوة الداخلية */
    }
}

/* شاشات صغيرة (أقل من 480px) */
@media (max-width: 480px) {
  
      .container {
        width: 100%;
        padding: 12px 6px; /* تقليل padding-top إلى 12px للشاشات الصغيرة */
        margin: 6px auto;
    }
    .notification-container {
        width: 140px;
        height: 140px;
    }
    .search-container {
        margin: 8px 0 12px 0; /* تقليل margin-bottom إلى 12px للشاشات الصغيرة */
    }
    
}
    .categories {
        grid-template-columns: 1fr; /* تحويل الأعمدة إلى صف واحد */
        gap: 5px; /* تقليل المسافة بين الأزرار */
    }

    .result-card img {
        width: 50px; /* تقليل حجم الصور */
        height: 50px;
    }

    .search-container input {
        padding: 10px 40px 10px 55px; /* تعديل الحشوة لتناسب الشاشات الصغيرة + زر التوافقات */
    }

    .search-container button {
        width: 35px; /* تقليل حجم زر البحث */
        height: 35px;
        font-size: 14px;
    }
}



/* الشعار (Logo) */


.logo-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 160px;
    height: 160px;
    border-radius: 50%;
    overflow: hidden !important; /* قص التأثيرات */
    box-shadow: 0 4px 10px rgba(255, 255, 255, 0.2);
    cursor: pointer;
    z-index: 1;
    opacity: 1;
    transition: transform 0.3s ease;
    clip-path: circle(80px at center) !important; /* قص دائري يطابق نصف القطر */
}

.logo-container img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
    border-radius: 50%;
}

.logo-container:active {
    transform: scale(0.95) !important;
    box-shadow: inset 0 8px 16px rgba(0, 0, 0, 0.5) !important; /* ظل داخلي فقط */
    clip-path: circle(80px at center) !important; /* قص صارم */
}

.logo-container img:active {
    transform: scale(1) !important; /* منع الصورة من التأثر */
}
        
h1 {
    font-size: 36px;
    margin-bottom: 5px;
    color: white;
    text-shadow: 0 4px 10px rgba(255, 255, 255, 0.4);
    margin-top: 5px; /* أضف هذه الخاصية لتحديد المسافة من الشعار */
}


/* تقليل المسافة بين أزرار الفئات (أسعار بنمط الكروب، عدد الصيانة، التوافقات) */
.categories {
    display: flex;
    flex-direction: column;
    gap: 8px; /* تقليل المسافة من 15px إلى 10px لتقريب الأزرار */
    align-items: center;
    width: 100%;
}
    .category-btn {
        position: relative;
        overflow: hidden;
        height: 40px; /* تقليل ارتفاع الزر 
        padding-top: 4px; /* رفع النص قليلاً للأعلى */*/
        padding: 8px 16px;
        border-radius: 25px;
        background: rgba(0, 0, 0, 0.3);
        color: white;
        line-height: 40px; /* نفس ارتفاع الزر لتوسيط النص عموديًا */
        font-size: 16px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
         gap: 10px; /* مسافة بين الأيقونة والنص */
         font-family: 'Cairo', sans-serif !important;
     
    }

    .category-btn:hover {
        transform: scale(1.1);
        background: linear-gradient(45deg, #43cea2, #185a9d);
    }

   .category-btn:active {
    transform: scale(0.95); /* تصغير خفيف بدون تمدد */
    background: linear-gradient(45deg, #43cea2, #185a9d);
    box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.3); /* ظل داخلي بدلًا من خارجي */
}

   .new-category-btn, 
.category-btn, 
.tools-btn {
    width: 85%; /* جعل العرض موحد */
    max-width: 250px; /* نفس عرض زر أسعار بنمط الكروب */

    
}


    
    .new-category-btn {
            grid-column: span 2; /* يجعل الزر يمتد على عمودين */
            position: relative;
            overflow: hidden;
            height: 40px; /* تقليل ارتفاع الزر 
            padding-top: 20px; /* رفع النص قليلاً للأعلى */*/
            padding: 8px 16px;
            border-radius: 25px;
            background: rgba(0, 0, 0, 0.3);
            color: white;
            line-height: 40px; /* نفس ارتفاع الزر لتوسيط النص عموديًا */
            font-size: 16px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            text-align: center;
             gap: 10px; /* مسافة بين الأيقونة والنص */
             font-family: 'Cairo', sans-serif !important;
        }

        .new-category-btn:hover {
            transform: scale(1.1);
            background: linear-gradient(45deg, #43cea2, #185a9d);
        }

      .new-category-btn:active {
    transform: scale(0.95);
    background: linear-gradient(45deg, #43cea2, #185a9d);
    box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.3);
}
    
       .category-btn,
       .new-category-btn {
       display: flex;
       align-items: center;
       justify-content: center;
       margin-top: -2px; /* رفع النص قليلاً */
}



.slider-container {
    position: sticky;
    top: 62px;              /* إذا يغطي الهيدر زيدها 70-80 */
    z-index: 999;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);

    /* خلي باقي خصائصك مثل ما هي */
    width: 100%;
    max-width: none;
    overflow: hidden;
    background: rgba(255, 255, 255, 0.1);
    padding: 5px;
    border-radius: 15px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    display: flex;
    align-items: center;
    gap: 8px;
}


.slider {
    display: flex;
    gap: 8px;
    overflow-x: auto;
    scroll-behavior: smooth;
    padding: 5px;
    flex-grow: 1;
}

.slider::-webkit-scrollbar {
    display: none;
}



.category {
    flex: 0 0 auto;
    width: 70px; /* جعل العرض يساوي الارتفاع لتصبح دائرية */
    height: 70px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 50%; /* دائري بدلًا من بيضوي */
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
    padding: 6px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    position: relative;
    overflow: hidden !important; /* قص التأثيرات */
    clip-path: circle(35px at center) !important; /* قص دائري يطابق نصف القطر */
    font-weight: bold;
    color: white;
}

/* تأثير الأيقونة */
.category i {
    font-size: 24px;
    margin-bottom: 5px;
    transition: transform 0.3s ease;
}

/* تأثير الأيقونة عند التمرير */
.category:hover i {
    transform: rotate(10deg) scale(1.2);
}

/* النص داخل الزر */
.category span {
    font-size: 12px; /* تقليل حجم النص ليناسب الدائرة */
    white-space: nowrap;
    font-weight: bold;
}

/* تأثير عند التمرير */
.category:hover {
    transform: scale(1.1);
    background: linear-gradient(45deg, #43cea2, #185a9d);
    box-shadow: 0 4px 15px rgba(67, 206, 162, 0.5);
}

/* تأثير عند الضغط */
.category:active {
    transform: scale(0.95) !important;
    background: linear-gradient(45deg, #43cea2, #185a9d) !important;
    box-shadow: inset 0 6px 12px rgba(0, 0, 0, 0.7) !important; /* ظل داخلي فقط */
    clip-path: circle(35px at center) !important; /* قص دائري */
}

/* تأثير عند التحديد */
.category.active {
    background: linear-gradient(135deg, #004D40, #00796B);
    color: white;
    transform: scale(1.15);
    box-shadow: 0 6px 18px rgba(67, 206, 162, 0.7);
}



/* ✅ تأثير نبض عند التحديد */
@keyframes pulseEffect {
    0% { transform: scale(1.15); box-shadow: 0 0 10px rgba(67, 206, 162, 0.5); }
    50% { transform: scale(1.2); box-shadow: 0 0 20px rgba(67, 206, 162, 0.8); }
    100% { transform: scale(1.15); box-shadow: 0 0 10px rgba(67, 206, 162, 0.5); }
}







.slider-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(243, 156, 18, 0.4);
    border: none;
    color: white;
    padding: 8px;
    cursor: pointer;
    border-radius: 50%;
    font-size: 16px;
    width: 38px;
    height: 38px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    transition: transform 0.2s ease, background 0.2s ease, box-shadow 0.2s ease;
    z-index: 10;
    overflow: hidden !important; /* قص صارم */
    clip-path: circle(18px at center); /* دائرة أصغر قليلاً من نصف القطر (19px -> 18px) */
}

.slider-btn:hover {
    background: rgba(243, 156, 18, 0.8);
    transform: translateY(-50%) scale(1.2);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
}

.slider-btn:active {
    transform: translateY(-50%) scale(0.9) !important; /* تصغير قوي */
    background: rgba(243, 156, 18, 1) !important;
    box-shadow: none !important; /* إلغاء الظل الخارجي تمامًا */
    box-shadow: inset 0 6px 12px rgba(0, 0, 0, 0.7) !important; /* ظل داخلي قوي */
    clip-path: circle(18px at center) !important; /* قص دائري صارم */
}

.prev-btn {
    left: 5px;
}

.next-btn {
    right: 5px;
}


.search-container {
    position: relative;
    width: 100%;
    margin: 8px 0 20px 0; /* زيادة margin-bottom إلى 20px لتتساوى مع padding-top للـ container */
}

.search-container input {
    width: 100%;
    height: 40px; /* ارتفاع الشريط */
    padding: 8px 16px;
    font-size: 16px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 25px;
    background: rgba(0, 0, 0, 0.3);
    color: white;
    outline: none;
    transition: all 0.3s ease;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
}

.search-container button {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    background: linear-gradient(45deg, #43cea2, #185a9d);
    border: none;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    color: white;
    font-size: 16px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden !important; /* قص التأثيرات */
    clip-path: circle(15px at center) !important; /* قص دائري يطابق نصف القطر */
}

.search-container button:hover {
    transform: translateY(-50%) scale(1.1);
}

.search-container button:active {
    transform: translateY(-50%) scale(0.95) !important;
    box-shadow: inset 0 4px 8px rgba(0, 0, 0, 0.5) !important; /* ظل داخلي فقط */
    clip-path: circle(15px at center) !important; /* قص صارم */
}




/* تنسيق زر المسح */
.search-container .clear-btn {
    position: absolute;
    right: 50px; /* وضعه بجانب زر البحث (10px لزر البحث + 30px عرضه + 10px مسافة) */
    top: 50%;
    transform: translateY(-50%);
    background: linear-gradient(45deg, #FF416C, #FF4B2B); /* لون مغاير لتمييزه، يمكنك استخدام نفس لون زر البحث */
    border: none;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    color: white;
    font-size: 16px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden !important;
    clip-path: circle(15px at center) !important; /* قص دائري مطابق لزر البحث */
}

.search-container .clear-btn:hover {
    transform: translateY(-50%) scale(1.1);
}

.search-container .clear-btn:active {
    transform: translateY(-50%) scale(0.95) !important;
    box-shadow: inset 0 4px 8px rgba(0, 0, 0, 0.5) !important;
    clip-path: circle(15px at center) !important;
}


/* زر التوافقات (كادر عسل فقط) داخل شريط البحث */
.search-container .admin-compat-btn{
    position: absolute;
    left: 10px;
    right: auto;
    top: 50%;
    transform: translateY(-50%);
    background: linear-gradient(45deg, #f6d365, #fda085);
}
.search-container .admin-compat-btn:disabled,
.search-container .admin-compat-btn.is-disabled{
    opacity: 0.45;
    cursor: not-allowed;
    filter: grayscale(0.6);
    transform: translateY(-50%) scale(1) !important;
    box-shadow: none !important;
}
/* تعديل padding حقل الإدخال لتجنب التداخل مع الأزرار */
.search-container input {
    padding-right: 90px; /* زيادة المسافة لاستيعاب زر المسح + زر البحث */
    padding-left: 60px; /* مساحة لزر التوافقات */
}

/* Media Queries للشاشات الصغيرة */
@media (max-width: 480px) {
    .search-container .clear-btn {
        right: 45px; /* تعديل الموقع */
        width: 35px; /* نفس حجم زر البحث */
        height: 35px;
        font-size: 14px;
    }
    .search-container input {
        padding-right: 85px; /* تعديل المسافة */
    padding-left: 60px; /* مساحة لزر التوافقات */
    }
}

/* Media Queries للشاشات المتوسطة */
@media (min-width: 481px) and (max-width: 768px) {
    .search-container .clear-btn {
        right: 48px;
        width: 32px;
        height: 32px;
        font-size: 15px;
    }
    .search-container input {
        padding-right: 88px;
    padding-left: 60px; /* مساحة لزر التوافقات */
    }
}







        /* تصميم الهيدر المستقيم */
/* تصميم الهيدر المستقيم */
.header {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 40px; /* تغيير من 35px إلى 40px ليطابق الفوتر */
    background: rgba(0, 0, 0, 0.8);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 12px;
    z-index: 2000;
}

/* نص مكتب عسل - في اليمين */
.header-title {
    font-family: 'Cairo', sans-serif;
    font-size: 18px;
    font-weight: 700;
    color: #A3BFFA; /* اللون الأصلي محتفظ به */
    text-shadow: 0 1px 2px rgba(163, 191, 250, 0.4);
    letter-spacing: 0.5px;
    order: 1; /* جعله في اليمين */
}

/* حاوية الأزرار - في اليسار */
.header-buttons {
    display: flex;
    gap: 6px;
    order: 0; /* جعل الأزرار في اليسار */
}

/* تصميم الأزرار */
.header-btn {
    padding: 3px 10px;
    border-radius: 8px;
    border: none;
    background: linear-gradient(135deg, #5A6388, #4A5275); /* لون افتراضي للأزرار */
    color: #fff;
    font-family: 'Cairo', sans-serif;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    overflow: hidden; /* قص التأثيرات الخارجة عن الحدود */
}

/* تأثيرات الضغط */
.header-btn:hover {
    transform: scale(1.1) rotate(5deg);
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.5);
}

.header-btn:active {
    transform: scale(0.95);
    box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.3);
}

/* زر تحديث */
.header-btn.refresh-btn {
    background: linear-gradient(135deg, #6B7280, #4B5563);
}

.header-btn.refresh-btn:hover {
    background: linear-gradient(135deg, #9CA3AF, #6B7280);
}

/* زر خروج - أحمر غامق */
.header-btn.exit-btn {
    background: linear-gradient(135deg, #8B0000, #B22222); /* أحمر غامق */
}

.header-btn.exit-btn:hover {
    background: linear-gradient(135deg, #CD5C5C, #8B0000); /* تفتيح عند التمرير */
}
        
        
.results {
    display: none;
    flex-direction: column;
    gap: 20px;
    margin-top: 10px;
    padding: 15px;
    background: rgba(0, 0, 0, 0.1);
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    width: 100%;
    transform: translateZ(0); /* تسريع عتادي */
    will-change: display; /* تحسين تغيير الـ display */
}


.no-results {
    color: #ffffff;
    background: rgba(255, 255, 255, 0.1);
    padding: 10px 15px;
    border-radius: 10px;
    text-align: center;
    font-size: 16px;
    font-weight: 500;
    margin-top: 10px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
    width: 80%;
    margin-left: auto;
    margin-right: auto;
    animation: fadeIn 0.3s ease-in-out;
    cursor: pointer;
    transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
    overflow: hidden !important; /* قص التأثيرات */
    clip-path: inset(0 0 0 0 round 10px) !important; /* قص يطابق border-radius */
}

.no-results:active {
    transform: scale(0.95) !important;
    box-shadow: inset 0 4px 8px rgba(0, 0, 0, 0.5) !important; /* ظل داخلي فقط */
    background: rgba(255, 255, 255, 0.2) !important;
    clip-path: inset(0 0 0 0 round 10px) !important; /* قص صارم */
}


.result-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, rgba(0, 0, 0, 0.5), rgba(50, 50, 50, 0.3));
    border-radius: 15px;
    padding: 20px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4), 0 0 10px rgba(255, 255, 255, 0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease, background 0.3s ease;
    cursor: pointer;
    width: 90%;
    max-width: 450px;
    min-width: 250px;
    margin: 0 auto;
    position: relative;
    overflow: hidden !important; /* قص التأثيرات */
    clip-path: inset(0 0 0 0 round 15px) !important; /* قص يطابق border-radius */
    min-height: 200px;
}

.result-card:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5), 0 0 15px rgba(70, 130, 180, 0.5);
    background: linear-gradient(135deg, rgba(20, 20, 20, 0.6), rgba(70, 130, 180, 0.2));
}

.result-card:active {
    transform: scale(0.97) !important;
    box-shadow: inset 0 6px 12px rgba(0, 0, 0, 0.6) !important; /* ظل داخلي فقط */
    background: linear-gradient(135deg, rgba(0, 0, 0, 0.7), rgba(50, 50, 50, 0.4)) !important;
    clip-path: inset(0 0 0 0 round 15px) !important; /* قص صارم عند الضغط */
}

.result-card img {
    width: clamp(80px, 20vw, 140px); /* زيادة حجم الصورة */
    height: clamp(80px, 20vw, 140px);
    border-radius: 50%;
    margin-bottom: 20px; /* زيادة المسافة تحت الصورة */
    object-fit: cover;
    border: 2px solid rgba(255, 255, 255, 0.2);
    transition: transform 0.3s ease;
}

.result-card:hover img {
    transform: rotate(10deg) scale(1.1);
}

.result-card h4 {
    font-size: clamp(18px, 5vw, 24px); /* زيادة حجم النص */
    font-weight: bold;
    color: white;
    margin: 0 0 20px 0; /* زيادة المسافة تحت الاسم */
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
    text-align: center;
    white-space: normal;
    word-wrap: break-word;
    max-width: 90%;
}

.result-card p {
    font-size: clamp(16px, 4.5vw, 22px); /* زيادة حجم السعر */
    color: #fff;
    margin: 0;
    padding: 8px 18px; /* زيادة حشوة المستطيل لتناسب الحجم الجديد */
    background: linear-gradient(45deg, #4682B4, #20B2AA);
    border-radius: 8px;
    font-weight: 600;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    text-align: center;
}

.result-card:hover p {
    transform: scale(1.05);
    box-shadow: 0 4px 10px rgba(70, 130, 180, 0.6);
}


/* السعر القديم (ينشطب بالأحمر) */
.old-price {
    color: #ffb3b3;
    text-decoration: line-through;
    opacity: 0.9;
    margin-inline-start: 5px;
}

/* السعر الجديد (عرض خاص) */
.new-price {
    font-weight: 700;
    margin-inline-end: 5px;
}


/* Media Queries */
@media (max-width: 480px) { /* موبايل صغير */
    .result-card {
        padding: 15px;
        width: 95%;
        min-height: 180px; /* ارتفاع أدنى للموبايل */
    }

    .result-card img {
        width: clamp(70px, 18vw, 120px); /* حجم أكبر للموبايل */
        height: clamp(70px, 18vw, 120px);
        margin-bottom: 15px;
    }

    .result-card h4 {
        font-size: clamp(16px, 4.5vw, 22px); /* نص أكبر للموبايل */
        margin-bottom: 15px;
    }

    .result-card p {
        font-size: clamp(14px, 4vw, 20px); /* سعر أكبر للموبايل */
        padding: 6px 15px;
    }
}

@media (min-width: 481px) and (max-width: 768px) { /* تابلت */
    .result-card {
        width: 90%;
        min-height: 190px;
    }

    .result-card img {
        width: clamp(80px, 15vw, 130px);
        height: clamp(80px, 15vw, 130px);
    }

    .result-card h4 {
        font-size: clamp(18px, 4.5vw, 24px);
    }

    .result-card p {
        font-size: clamp(16px, 4vw, 22px);
    }
}

@media (min-width: 769px) { /* كمبيوتر */
    .result-card {
        width: 85%;
        max-width: 450px;
        min-height: 200px;
    }

    .result-card img {
        width: 120px; /* حجم ثابت للكمبيوتر */
        height: 120px;
    }

    .result-card h4 {
        font-size: 24px; /* نص أكبر للكمبيوتر */
    }

    .result-card p {
        font-size: 22px; /* سعر أكبر للكمبيوتر */
    }
}

.results-container {
    display: flex;
    flex-direction: column;
    gap: 10px;
    max-height: 600px;
    overflow-y: auto;
    scroll-behavior: smooth;
    border-radius: 10px;
    padding: 10px;
    background: rgba(0, 0, 0, 0.2);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    transform: translateZ(0); /* تسريع عتادي */
}



/* تأثير ظهور تدريجي */
@keyframes fadeIn {
    from {
        opacity: 0;
        transform: scale(0.95);
    }
    to {
        opacity: 1;
        transform: scale(1);
    }
}

     


@keyframes shake {
    0%, 100% {
        transform: translateX(0);
    }
    25% {
        transform: translateX(-10px);
    }
    50% {
        transform: translateX(10px);
    }
    75% {
        transform: translateX(-10px);
    }
}


.news-bar {
    display: flex;
    align-items: center;
    justify-content: row-reverse;
    background: rgba(0, 0, 0, 0.3);
    padding: 8px 16px;
    border-radius: 25px;
    width: 100%;
    height: 40px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    transition: all 0.3s ease;
    margin-bottom: 2px; /* تقليل المسافة السفلية من 8px إلى 4px */
    box-sizing: border-box;
}

/* زر "عاجل" في اليمين */
.breaking-news {
    background: linear-gradient(135deg, #0082B5, #0070A0);
    color: white;
    font-weight: bold;
    padding: 6px 14px;
    border-radius: 20px;
    text-align: center;
    font-size: 14px;
    box-shadow: 0px 0px 10px rgba(0, 130, 181, 0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    height: 28px;
    margin-left: auto;
    order: 2;
    /* animation: none; */ /* أو احذف السطر ده نهائي */
}

@keyframes pulse {
    0% { transform: scale(1); opacity: 1; }
    100% { transform: scale(1.1); opacity: 0.9; }
}

/* تحسين حاوية الأخبار لجعلها بدون لون إضافي */
.news-ticker-container {
    flex: 1;
    height: 28px;
    overflow: hidden;
    position: relative;
    display: flex;
    align-items: center;
    background: transparent !important; /* ✅ اجعل الخلفية شفافة */
    border-radius: 15px;
    padding: 4px 8px; /* ✅ ضبط الحواف لتكون متساوية */
}

/* تحسين شريط الأخبار ليكون متناسقًا بدون خلفية منفصلة */
.news-ticker {
    display: flex;
    align-items: center;
    white-space: nowrap;
    position: absolute;
    animation: scrollText 60s linear infinite;
    color: white;
    font-weight: bold;
    font-size: 14px;
    gap: 25px;
    direction: rtl;
    unicode-bidi: plaintext;
    background: transparent !important; /* ✅ إزالة لون الخلفية */
}


/* ضبط كل جزء من الخبر لمنع تغيير ترتيب النصوص المختلطة */
.news-ticker span {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-right: 20px;
    direction: rtl; /* ✅ التأكد أن النصوص المختلطة تبقى متناسقة */
    unicode-bidi: embed; /* ✅ يضمن بقاء النصوص الإنجليزية ضمن مكانها الصحيح */
}

    
/* تحسين مظهر الأيقونة مع النص */
.news-ticker img {
    width: 16px;
    height: 16px;
    flex-shrink: 0; /* ✅ منع الأيقونات من التمدد أو التقلص */
}

/* تحسين الروابط داخل الأخبار */
.news-ticker a {
    color: white !important;
    text-decoration: none !important;
    direction: rtl; /* ✅ إجبار النص على البقاء في الاتجاه الصحيح */
}
.news-ticker a:hover {
    text-decoration: underline;
}

@keyframes scrollText {
    from { transform: translateX(-100%); }
    to { transform: translateX(100%); }
}
        


swal2-popup {
    background: rgba(255, 255, 255, 0.1); /* لون شفاف */
    border-radius: 15px;
    color: #fff;
    text-align: center;
    backdrop-filter: blur(10px);
    width: 300px; /* تقليل حجم النافذة */
    padding: 20px;
    font-family: 'Cairo', sans-serif !important;
}

.swal2-title {
    color: white;
    font-size: 24px !important;
    font-weight: bold !important;
    text-shadow: 0 2px 5px rgba(0, 0, 0, 0.7);
    margin-bottom: 15px;
}

.swal2-html-container {
    font-size: 16px !important;
    color: #dcdcdc !important;
    margin: 10px 0;
}

.swal2-actions {
    display: flex !important;
    flex-direction: row !important; /* جعل الأزرار جنب بعض */
    justify-content: center !important;
    gap: 10px !important; /* مسافة بين الأزرار */
    margin-top: 15px;
}


.swal2-confirm, .swal2-cancel {
    padding: 6px 16px !important; /* تقليل الحشوة لتصغير الأزرار */
    font-size: 14px !important; /* تقليل حجم النص */
    border-radius: 20px !important; /* زوايا مستديرة */
    font-weight: 600 !important;
    transition: all 0.3s ease !important;
    color: white !important;
    border: none !important;
    min-width: 60px !important; /* عرض أدنى للأزرار */
    overflow: hidden !important; /* قص التأثيرات */
    clip-path: inset(0 0 0 0 round 20px) !important; /* قص يطابق border-radius */
}

.swal2-confirm {
    background: linear-gradient(135deg, #43cea2, #185a9d) !important;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
}

.swal2-cancel {
    background: linear-gradient(135deg, #FF416C, #FF4B2B) !important;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
}

.swal2-confirm:hover, .swal2-cancel:hover {
    transform: scale(1.1);
    box-shadow: 0 8px 16px rgba(255, 255, 255, 0.3);
}

.swal2-confirm:active, .swal2-cancel:active {
    transform: scale(0.95) !important;
    box-shadow: inset 0 4px 8px rgba(0, 0, 0, 0.5) !important; /* ظل داخلي فقط */
    clip-path: inset(0 0 0 0 round 20px) !important; /* قص صارم */
}


.swal2-input {
    width: 90%;
    padding: 12px 15px;
    font-size: 16px;
    color: #ffffff;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 10px;
    box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.5);
    outline: none;
    transition: all 0.3s ease;
    margin: 10px auto;
    display: block;
    font-family: 'Cairo', sans-serif !important;
}

.swal2-input:focus {
    background: rgba(255, 255, 255, 0.2);
    border: 1px solid #43cea2;
    box-shadow: 0 0 10px #43cea2;
}



/* تنسيق زر الرجوع لأعلى */
.scroll-to-top {
    position: fixed;
    bottom: 60px;
    right: 20px;
    background: linear-gradient(45deg, #8B0000, #DC143C);
    color: #fff;
    border: none;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    cursor: pointer;
    transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease, opacity 0.3s ease;
    opacity: 0;
    visibility: hidden;
    z-index: 1000;
    overflow: hidden !important; /* قص صارم */
    clip-path: circle(25px at center); /* قص دائري صارم */
}

.scroll-to-top:hover {
    transform: translateY(-5px) scale(1.1);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
}

.scroll-to-top:active {
    transform: scale(0.9) !important; /* تصغير قوي */
    background: linear-gradient(45deg, #7A0000, #C01234) !important;
    box-shadow: none !important; /* إلغاء الظل الخارجي */
    box-shadow: inset 0 6px 12px rgba(0, 0, 0, 0.7) !important; /* ظل داخلي فقط */
    clip-path: circle(25px at center) !important; /* تأكيد القص الدائري */
}

/* إظهار الزر */
.show-scroll-btn {
    opacity: 1;
    visibility: visible;
}

footer p {
    margin: 0; /* إزالة الهوامش */
    padding: 3px 0; /* تصغير الحشوة العلوية والسفلية */
    font-size: 14px; /* تصغير حجم النص */
    color: white; /* تأكيد اللون الأبيض */
    text-align: center;
}





footer {
    background-color: rgba(0, 0, 0, 0.8); /* جعل الخلفية أكثر وضوحًا */
    color: white;
    text-align: center;
    padding: 10px 0; /* تقليل التباعد لجعله أنيقًا */
    width: 100%;
    font-family: 'Montserrat', sans-serif;
    font-size: 14px;
    box-shadow: 0 -3px 10px rgba(0, 0, 0, 0.4); /* تحسين الظل لجعله أكثر بروزًا */
    position: fixed; /* تثبيت الفوتر أسفل الصفحة */
    bottom: 0; /* تثبيته في الأسفل */
    left: 0;
    z-index: 1000; /* جعله فوق جميع العناصر */
}

/* التأكد من عدم اختفاء المحتوى خلف الفوتر */
body {
    padding-bottom: 50px; /* يضمن عدم تغطية المحتوى بالفوتر */
}



/* ✅ نافذة إعلان مودرن */
#promoPopup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -100%); /* مهم حتى يشتغل slideDown/slideUp */
    width: min(420px, 92vw);
    background:
        radial-gradient(circle at top left, rgba(67, 206, 162, 0.15), transparent),
        rgba(15, 23, 42, 0.97); /* dark glassy */
    backdrop-filter: blur(18px);
    padding: 20px 18px 16px;
    border-radius: 18px;
    text-align: center;
    color: #e5e7eb;
    box-shadow: 0 18px 40px rgba(0, 0, 0, 0.85);
    display: none;
    flex-direction: column;
    gap: 12px;
    z-index: 9999;
}

/* محتوى البوب أب */
#promoPopup .promo-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
}

/* ✅ البادج الصغير فوق العنوان */
.promo-badge {
    font-size: 12px;
    font-weight: 600;
    letter-spacing: .04em;
    text-transform: uppercase;
    padding: 4px 10px;
    border-radius: 999px;
    background: rgba(34, 197, 94, 0.07);
    border: 1px solid rgba(34, 197, 94, 0.6);
    color: #bbf7d0;
}

/* صورة العرض (تصير كرت نظيف) */
#promoImage {
    width: 80px;
    height: 80px;
    border-radius: 20px;
    object-fit: cover;
    border: 1px solid rgba(148, 163, 184, 0.5);
    box-shadow: 0 8px 18px rgba(15, 23, 42, 0.9);
    transition: transform 0.25s ease;
    cursor: pointer;
}

#promoImage:hover {
    transform: translateY(-2px) scale(1.03);
}

/* عنوان الإعلان – بدون ألوان فاقعة */
.popup-title {
    font-size: 20px;
    font-weight: 700;
    margin: 0;
    color: #f9fafb;
    text-shadow: none;
    background: none;
    -webkit-text-fill-color: currentColor;
}

/* نص الإعلان */
.promo-text {
    margin: 0;
    font-size: 14px;
    line-height: 1.7;
    color: #cbd5f5;
}

/* زر الدعوة للفعل (CTA) */
#closeBtn {
    width: 100%;
    padding: 10px 0;
    font-size: 15px;
    font-weight: 600;
    color: #0b1120;
    background: linear-gradient(135deg, #22c55e, #06b6d4);
    border: none;
    border-radius: 999px;
    cursor: pointer;
    box-shadow: 0 10px 22px rgba(8, 47, 73, 0.7);
    transition: transform 0.18s ease, box-shadow 0.18s ease, filter 0.18s ease;
    font-family: 'Cairo', sans-serif !important;
}

#closeBtn:hover {
    transform: translateY(-1px);
    filter: brightness(1.05);
    box-shadow: 0 14px 28px rgba(8, 47, 73, 0.8);
}

#closeBtn:active {
    transform: translateY(1px) scale(0.97);
    box-shadow: inset 0 4px 8px rgba(15, 23, 42, 0.8);
}

/* ملاحظة صغيرة تحت الزر (اختيارية، لو ضفت span.promo-hint بالـ HTML) */
.promo-hint {
    font-size: 11px;
    color: #9ca3af;
    margin-top: 4px;
}

/* موبايلات – تكبير النص شوي وتخفيف المسافات */
@media (max-width: 480px) {
    #promoPopup {
        padding: 16px 14px 12px;
        border-radius: 16px;
    }

    .popup-title {
        font-size: 18px;
    }

    .promo-text {
        font-size: 13px;
    }

    #promoImage {
        width: 70px;
        height: 70px;
        border-radius: 16px;
    }
}




/* ===== Alert Popup: قالب إشعار عام (تعديل العرض وتوسيط المحتوى) ===== */
#promoPopup.alert-shell {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -100%);  /* حتى تشتغل أنيميشن slideDown/slideUp */

    /* 🔹 عرض أضيق وأرتب */
    width: min(360px, 90vw);   /* كان 420px, هسه أصغر */
    padding: 18px 16px 16px;
    border-radius: 18px;

    display: none;
    flex-direction: column;
    align-items: center;       /* توسيط كل المحتوى أفقياً */
    gap: 14px;

    z-index: 9999;
    direction: rtl;

    /* نخلي كل النصوص بالنص */
    text-align: center;

    background:
        radial-gradient(circle at top left, var(--alert-color-soft, rgba(34, 197, 94, 0.14)), transparent),
        rgba(15, 23, 42, 0.98);
    color: #e5e7eb;
    backdrop-filter: blur(20px);
}


/* ثيم الخصم / العروض */
#promoPopup.alert-sale {
    --alert-color: #fb923c;
    --alert-color-soft: rgba(251, 146, 60, 0.16);
    --alert-color-strong: #f97316;
}

/* ثيم المناسبات / الأحداث */
#promoPopup.alert-event {
    --alert-color: #38bdf8;
    --alert-color-soft: rgba(56, 189, 248, 0.18);
    --alert-color-strong: #0ea5e9;
}

/* ثيم التنبيهات العامة */
#promoPopup.alert-info {
    --alert-color: #a855f7;
    --alert-color-soft: rgba(168, 85, 247, 0.18);
    --alert-color-strong: #7c3aed;
}

/* ===== البنية الداخلية ===== */

/* الهيدر مال الإعلان */
.alert-header {
    display: flex;
    flex-direction: column;   /* كان صف، هسه فوق/جوه */
    align-items: center;      /* أيقونة + نص بالنص */
    gap: 10px;
}

/* النص اللي ويا العنوان */
.alert-head-text {
    display: flex;
    flex-direction: column;
    gap: 4px;
    min-width: 0;
    align-items: center;      /* توسيط داخلي */
    text-align: center;
}

/* العنوان */
.alert-title {
    margin: 0;
    font-size: 18px;
    line-height: 1.6;
    font-weight: 700;
    color: #f9fafb;
}


.alert-icon {
    width: 42px;
    height: 42px;
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;

    background: rgba(15, 23, 42, 0.96);
    border: 1px solid var(--alert-color);
    box-shadow: 0 10px 22px rgba(15, 23, 42, 0.9);
}

.alert-icon i {
    font-size: 18px;
    color: var(--alert-color-strong);
}



.alert-kicker {
    font-size: 11px;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    color: #9ca3af;
}



/* ===== النص الرئيسي ===== */

.alert-body {
    margin-top: 6px;
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.alert-text {
    margin: 0;
    font-size: 13px;
    line-height: 1.7;
    color: #d1d5db;
}

/* شريط معلومات / ميتا */
.alert-meta {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;   /* تصير بالنص */
    gap: 6px 8px;
}


.alert-pill {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 4px 8px;
    font-size: 11px;
    border-radius: 999px;
    background: rgba(15, 23, 42, 0.9);
    border: 1px solid rgba(148, 163, 184, 0.5);
    color: #9ca3af;
}

.alert-pill i {
    font-size: 11px;
    color: var(--alert-color);
}

/* ===== الفوتر / الأزرار ===== */



.alert-footer {
    margin-top: 12px;
    display: flex;
    justify-content: center;   /* كان flex-end */
    gap: 10px;
    flex-wrap: wrap;           /* لو زرّين أو ثلاثة يبقون مرتبين */
    width: 100%;
}

/* نخلي الأزرار نفس الحجم تقريبا وتكون مرتبة بالنص */
.alert-secondary,
.alert-primary {
    border-radius: 999px;
    padding: 8px 16px;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    border: none;
    outline: none;
    transition:
        transform 0.18s ease,
        box-shadow 0.18s ease,
        background 0.18s ease,
        border-color 0.18s ease;
    font-family: inherit;
    text-align: center;
    flex: 1 1 auto;      /* يخلي الزرّين ياخذون مساحة حلوة متساوية */
    max-width: 140px;    /* حتى ما يطلعن عريضة كلش */
}


/* زر ثانوي */
.alert-secondary {
    background: transparent;
    color: #e5e7eb;
    border: 1px solid rgba(148, 163, 184, 0.7);
}

.alert-secondary:hover {
    background: rgba(15, 23, 42, 0.96);
    border-color: rgba(209, 213, 219, 0.9);
}

/* زر رئيسي */
.alert-primary {
    background: linear-gradient(135deg, var(--alert-color), var(--alert-color-strong));
    color: #0b1120;
    box-shadow: 0 10px 22px rgba(0, 0, 0, 0.55);
}

.alert-primary:hover {
    transform: translateY(-1px);
    box-shadow: 0 14px 28px rgba(0, 0, 0, 0.7);
}

.alert-primary:active {
    transform: scale(0.97);
    box-shadow: inset 0 5px 10px rgba(0, 0, 0, 0.65);
}

/* ===== موبايل ===== */

@media (max-width: 480px) {
    #promoPopup.alert-shell {
        width: min(92vw, 340px);   /* أضيق شوي للموبايل */
        padding: 14px 14px 12px;
        border-radius: 16px;
    }

    .alert-title {
        font-size: 16px;
    }

    .alert-text {
        font-size: 12px;
    }

    .alert-footer {
        justify-content: center;   /* حتى بالموبايل تبقى الأزرار بالنص */
    }
}


/* 🔥 تحديث شكل نافذة العناصر الجديدة – نفس الـ ID الموجود */
#newItemsModal {
    position: fixed;
    top: 50px;          /* نفس منطقك: تحت الهيدر */
    bottom: 60px;       /* فوق الفوتر */
    left: 50%;
    transform: translateX(-50%);
    width: min(820px, calc(100% - 24px));
    padding: 18px 18px 14px;
    border-radius: 18px;
    background:
        radial-gradient(circle at top left, rgba(67, 206, 162, 0.16), transparent),
        rgba(15, 23, 42, 0.97); /* نفس جو إعلان promoPopup */
    box-shadow: 0 24px 60px rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(18px);
    border: 1px solid rgba(148, 163, 184, 0.35);
    display: none;
    flex-direction: column;
    gap: 12px;
    color: #e5e7eb;
    overflow: hidden;
    z-index: 10000;
}

/* العنوان داخل نافذة العناصر الجديدة */
#newItemsModal h2 {
    margin: 0 0 8px;
    font-size: 22px;
    letter-spacing: 0.04em;
    text-align: start;
    font-weight: 800;
    background: linear-gradient(135deg, #facc15, #f97316);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

/* زر الإغلاق الموجود أصلاً .close-modal-btn */
#newItemsModal .close-modal-btn {
    position: absolute;
    top: 10px;
    inset-inline-end: 10px;
    width: 32px;
    height: 32px;
    border-radius: 999px;
    border: none;
    background: rgba(15, 23, 42, 0.95);
    color: #e5e7eb;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.85);
    transition: transform 0.2s ease, background 0.2s ease, box-shadow 0.2s ease;
}

#newItemsModal .close-modal-btn:hover {
    transform: scale(1.08);
    background: linear-gradient(135deg, #ef4444, #b91c1c);
    box-shadow: 0 12px 28px rgba(185, 28, 28, 0.6);
}

#newItemsModal .close-modal-btn:active {
    transform: scale(0.9);
    box-shadow: none;
}

/* جسم النافذة – نفس .modal-content بس مودرن أكثر */
#newItemsModal .modal-content {
    margin-top: 4px;
    padding: 6px;
    border-radius: 14px;
    background: rgba(15, 23, 42, 0.96);
    border: 1px solid rgba(31, 41, 55, 0.95);
    overflow-y: auto;
    max-height: 100%;
    display: flex;
    flex-direction: column;
    gap: 8px;
    scrollbar-width: none;          /* فيرفوكس */
    -ms-overflow-style: none;       /* Edge / IE */
}

#newItemsModal .modal-content::-webkit-scrollbar {
    display: none; /* كروم */
}

/* كارت العنصر – نفس .new-item-card */
#newItemsModal .modal-content .new-item-card {
    background:
        radial-gradient(circle at top left, rgba(96, 165, 250, 0.18), rgba(15, 23, 42, 0.95));
    border-radius: 14px;
    padding: 10px 12px;
    display: flex;
    align-items: center;
    gap: 12px;
    border: 1px solid rgba(55, 65, 81, 0.95);
    box-shadow: 0 10px 28px rgba(15, 23, 42, 0.85);
    position: relative;
    transition: transform 0.18s ease, box-shadow 0.18s ease, border-color 0.18s ease, background 0.18s ease;
}

#newItemsModal .modal-content .new-item-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 18px 40px rgba(15, 23, 42, 0.95);
    border-color: rgba(96, 165, 250, 1);
}

/* الدائرة اللي فيها اسم الفئة – نفس .category-circle */
#newItemsModal .modal-content .category-circle {
    width: 58px;
    height: 58px;
    border-radius: 999px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Cairo', sans-serif;
    font-weight: 700;
    font-size: 11px;
    text-align: center;
    padding: 6px;
    background: conic-gradient(from 160deg, #22c55e, #0ea5e9, #6366f1, #22c55e);
    color: #0b1120;
    box-shadow: 0 10px 25px rgba(15, 23, 42, 0.9);
}

/* محتوى النص – نفس .item-details و .new-badge و h4 و p */
#newItemsModal .modal-content .item-details {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

#newItemsModal .modal-content .item-details .new-badge {
    align-self: flex-start;
    font-size: 11px;
    padding: 3px 9px;
    border-radius: 999px;
    background: rgba(34, 197, 94, 0.15);
    color: #bbf7d0;
    border: 1px solid rgba(34, 197, 94, 0.5);
    text-transform: uppercase;
    letter-spacing: .12em;
}

#newItemsModal .modal-content .item-details h4 {
    margin: 0;
    font-size: 15px;
    color: #f9fafb;
    display: flex;
    align-items: center;
    gap: 8px;
}

#newItemsModal .modal-content .item-details h4 i {
    font-size: 14px;
    color: #22c55e;
}

#newItemsModal .modal-content .item-details p {
    margin: 0;
    font-size: 13px;
    padding: 4px 8px;
    border-radius: 8px;
    display: inline-block;
    background: linear-gradient(135deg, #1d4ed8, #06b6d4);
    color: #e0f2fe;
}

/* موبايل */
@media (max-width: 480px) {
    #newItemsModal {
        top: 45px;
        bottom: 55px;
        width: calc(100% - 10px);
        padding: 14px 10px 10px;
        border-radius: 16px;
    }

    #newItemsModal h2 {
        font-size: 19px;
    }

    #newItemsModal .modal-content .new-item-card {
        padding: 8px 9px;
        gap: 9px;
    }

    #newItemsModal .modal-content .category-circle {
        width: 50px;
        height: 50px;
        font-size: 10px;
    }

    #newItemsModal .modal-content .item-details h4 {
        font-size: 13px;
    }

    #newItemsModal .modal-content .item-details p {
        font-size: 12px;
    }
}


/* 🎨 تصميم عالمي لنافذة تحديث البيانات + نافذة النجاح */

.swal2-popup.update-dialog,
.swal2-popup.update-success-dialog {
    border-radius: 24px;
    padding: 22px 22px 18px;
    width: min(420px, 92vw);
    background:
        radial-gradient(circle at top left, rgba(56, 189, 248, 0.20), transparent 55%),
        radial-gradient(circle at bottom right, rgba(34, 197, 94, 0.18), transparent 55%),
        rgba(15, 23, 42, 0.98);
    box-shadow:
        0 30px 80px rgba(15, 23, 42, 0.95),
        0 0 0 1px rgba(51, 65, 85, 0.85);
    backdrop-filter: blur(22px);
    color: #e5e7eb;
    font-family: 'Cairo', 'Tajawal', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    text-align: center;
}

/* نافذة النجاح أصغر شوي */
.swal2-popup.update-success-dialog {
    width: min(380px, 90vw);
}

/* نضبط الكونتينر الداخلي */
.update-shell,
.update-success-shell {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 14px;
}

/* شارة صغيرة فوق */
.update-chip {
    font-size: 11px;
    letter-spacing: 0.18em;
    text-transform: uppercase;
    padding: 4px 12px;
    border-radius: 999px;
    border: 1px solid rgba(148, 163, 184, 0.75);
    background: rgba(15, 23, 42, 0.9);
    color: #9ca3af;
}

/* حلقة التحميل (حلقة ملونة تدور) */
.update-ring {
    width: 96px;
    height: 96px;
    border-radius: 999px;
    padding: 3px;
    background: conic-gradient(
        from 220deg,
        #22c55e,
        #06b6d4,
        #a855f7,
        #22c55e
    );
    display: flex;
    align-items: center;
    justify-content: center;
    animation: spin 1.1s linear infinite;
    box-shadow: 0 0 32px rgba(56, 189, 248, 0.6);
}

.update-ring-inner {
    width: 100%;
    height: 100%;
    border-radius: inherit;
    background: radial-gradient(circle at top, #020617, #020617);
    display: flex;
    align-items: center;
    justify-content: center;
}

.update-ring-inner i {
    font-size: 30px;
    color: #bbf7d0;
}

/* عنوان وشرح التحديث */
.update-title {
    font-size: 19px;
    font-weight: 800;
    margin: 0;
    background: linear-gradient(135deg, #facc15, #22c55e);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.update-subtitle {
    margin: 0;
    margin-top: 4px;
    font-size: 13px;
    color: #9ca3af;
    max-width: 280px;
    line-height: 1.7;
}

/* أيقونة النجاح */
.update-success-icon {
    width: 78px;
    height: 78px;
    border-radius: 999px;
    background: radial-gradient(circle at top, #22c55e, #16a34a);
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow:
        0 0 22px rgba(34, 197, 94, 0.9),
        0 0 40px rgba(34, 197, 94, 0.6);
}

.update-success-icon i {
    font-size: 34px;
    color: #ecfeff;
}

.update-success-title {
    font-size: 18px;
    font-weight: 800;
    margin: 0;
    background: linear-gradient(135deg, #bbf7d0, #22c55e);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.update-success-text {
    margin: 0;
    margin-top: 4px;
    font-size: 13px;
    color: #d1d5db;
    max-width: 260px;
    line-height: 1.7;
}

/* موبايل */
@media (max-width: 480px) {
    .swal2-popup.update-dialog,
    .swal2-popup.update-success-dialog {
        padding: 18px 14px 14px;
        border-radius: 20px;
    }

    .update-title,
    .update-success-title {
        font-size: 16px;
    }

    .update-subtitle,
    .update-success-text {
        font-size: 12px;
        max-width: 100%;
    }

    .update-ring {
        width: 84px;
        height: 84px;
    }

    .update-success-icon {
        width: 68px;
        height: 68px;
    }
}

/* 🎨 نافذة الخروج – تصميم عالمي مع غلاس وجراديانت */

.swal2-popup.exit-popup {
    background:
        radial-gradient(circle at top left, rgba(67, 206, 162, 0.18), transparent 55%),
        radial-gradient(circle at bottom right, rgba(56, 189, 248, 0.20), transparent 55%),
        rgba(15, 23, 42, 0.98);  /* dark glassy مثل الإعلان */
    border-radius: 22px;
    width: min(420px, 92vw);
    padding: 22px 20px 18px;
    box-shadow: 0 26px 70px rgba(0, 0, 0, 0.9);
    color: #e5e7eb;
    font-family: 'Cairo', sans-serif !important;
    text-align: center;
}

/* هيكل المحتوى الداخلي */
.exit-shell {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 14px;
}

/* الأيقونة الدائرية في الأعلى */
.exit-icon {
    width: 78px;
    height: 78px;
    border-radius: 999px;
    background: radial-gradient(circle at top, #f97316, #b91c1c);
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow:
        0 0 24px rgba(248, 113, 113, 0.9),
        0 0 40px rgba(15, 23, 42, 1);
}

.exit-icon i {
    font-size: 34px;
    color: #fff7ed;
}

/* العنوان والنص */
.exit-title {
    margin: 6px 0 0 0;
    font-size: 20px;
    font-weight: 800;
    background: linear-gradient(135deg, #fee2e2, #fecaca);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.exit-text {
    margin: 4px 0 0 0;
    font-size: 13px;
    color: #e5e7eb;
    max-width: 290px;
    line-height: 1.7;
}

/* أزرار الخروج / الرجوع */
.exit-confirm,
.exit-cancel {
    border-radius: 999px !important;
    padding: 8px 24px !important;
    font-size: 14px !important;
    font-weight: 700 !important;
    box-shadow: 0 10px 24px rgba(15, 23, 42, 0.85);
    border: none !important;
}

/* زر الخروج */
.exit-confirm {
    background: linear-gradient(135deg, #ef4444, #b91c1c) !important;
    color: #fef2f2 !important;
}

.exit-confirm:hover {
    transform: translateY(-1px);
    box-shadow: 0 14px 30px rgba(185, 28, 28, 0.9);
}

/* زر الرجوع */
.exit-cancel {
    background: rgba(15, 23, 42, 0.94) !important;
    color: #e5e7eb !important;
    border: 1px solid rgba(148, 163, 184, 0.6) !important;
}

.exit-cancel:hover {
    background: rgba(30, 41, 59, 0.96) !important;
}

/* موبايل */
@media (max-width: 480px) {
    .swal2-popup.exit-popup {
        width: min(95vw, 380px);
        padding: 18px 14px 14px;
        border-radius: 20px;
    }

    .exit-title {
        font-size: 18px;
    }

    .exit-text {
        font-size: 12px;
        max-width: 100%;
    }
}



/* 🌌 طبقة تغطي الشاشة كلها – نفس جو إعلان البداية تقريباً */
.activation-overlay {
    position: fixed;
    inset: 0;
    background:
        radial-gradient(circle at top left, rgba(67, 206, 162, 0.22), transparent 55%),
        radial-gradient(circle at bottom right, rgba(56, 189, 248, 0.20), transparent 60%),
        rgba(15, 23, 42, 0.96);
    backdrop-filter: blur(18px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.25s ease;
}

/* لما تنفتح النافذة */
.activation-overlay.is-open {
    opacity: 1;
    pointer-events: auto;
}

/* 🧊 صندوق المودال – تصميم ناعم وعالمي */
.activation-dialog {
    width: min(440px, 94vw);
    background: radial-gradient(circle at top, rgba(15, 23, 42, 0.95), #020617);
    border-radius: 24px;
    border: 1px solid rgba(148, 163, 184, 0.25);
    box-shadow:
        0 24px 80px rgba(15, 23, 42, 0.98),
        0 0 0 1px rgba(15, 23, 42, 0.9);
    padding: 22px 22px 18px;
    color: #e5e7eb;
    font-family: 'Cairo', sans-serif;
    transform: translateY(18px) scale(0.96);
    opacity: 0;
    transition: transform 0.28s ease, opacity 0.28s ease, box-shadow 0.28s ease;
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    overflow: hidden;
}

/* لمعة خفيفة تتحرك داخل النافذة */
.activation-dialog::before {
    content: '';
    position: absolute;
    inset: -40%;
    background:
        radial-gradient(circle at top center, rgba(56, 189, 248, 0.18), transparent 65%);
    opacity: 0.85;
    mix-blend-mode: screen;
    animation: activation-light-move 9s ease-in-out infinite;
    pointer-events: none;
}

/* هالة ناعمة حوالين النافذة */
.activation-dialog::after {
    content: '';
    position: absolute;
    inset: -1px;
    border-radius: inherit;
    border: 1px solid rgba(148, 163, 184, 0.35);
    box-shadow:
        0 0 25px rgba(56, 189, 248, 0.35),
        0 0 60px rgba(67, 206, 162, 0.25);
    opacity: 0.7;
    pointer-events: none;
}

/* حركة دخول بسيطة */
.activation-overlay.is-open .activation-dialog {
    transform: translateY(0) scale(1);
    opacity: 1;
}

/* 🔄 حركة لمعة الخلفية */
@keyframes activation-light-move {
    0%   { transform: translate3d(-10%, -6%, 0) scale(1); }
    50%  { transform: translate3d(8%, 10%, 0) scale(1.1); }
    100% { transform: translate3d(-10%, -6%, 0) scale(1); }
}

/* لوغو متحرك فوق */
.activation-logo {
    margin-bottom: 14px;
    position: relative;
    z-index: 1;
}

.activation-logo-ring {
    width: 72px;
    height: 72px;
    border-radius: 999px;
    background:
        conic-gradient(from 0deg, #22c55e, #0ea5e9, #a855f7, #facc15, #22c55e);
    display: flex;
    align-items: center;
    justify-content: center;
    animation: activation-spin 7s linear infinite;
    position: relative;
    box-shadow: 0 0 26px rgba(34, 197, 94, 0.55);
}

.activation-logo-core {
    width: 56px;
    height: 56px;
    border-radius: 999px;
    background: radial-gradient(circle at 30% 0%, #22c55e, #0f172a);
    display: flex;
    align-items: center;
    justify-content: center;
    color: #ecfdf5;
    font-size: 20px;
    font-weight: 700;
    text-shadow: 0 2px 8px rgba(0, 0, 0, 0.8);
}

/* دوران اللوجو */
@keyframes activation-spin {
    0%   { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* هيدر */
.activation-header {
    display: flex;
    flex-direction: column;
    gap: 4px;
    margin-bottom: 12px;
    align-items: center;
    position: relative;
    z-index: 1;
}

.activation-label {
    font-size: 11px;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: #9ca3af;
}

.activation-title {
    font-size: 21px;
    font-weight: 800;
    background: linear-gradient(135deg, #ffcc00, #22c55e);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.activation-subtitle {
    font-size: 13px;
    color: #9ca3af;
}

/* جسم المحتوى */
.activation-body {
    margin-top: 6px;
    margin-bottom: 10px;
    max-width: 360px;
    position: relative;
    z-index: 1;
}

.activation-text {
    font-size: 13px;
    color: #d1d5db;
    margin-bottom: 14px;
}

/* الحقل */
.activation-field-label {
    display: block;
    font-size: 12px;
    margin-bottom: 6px;
    color: #9ca3af;
}

.activation-input-row {
    position: relative;
    display: flex;
    align-items: center;
    border-radius: 999px;
    background: radial-gradient(circle at top, rgba(15, 23, 42, 0.4), #020617);
    border: 1px solid rgba(148, 163, 184, 0.45);
    padding-inline: 10px;
    box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.9), 0 0 22px rgba(56, 189, 248, 0.18);
    transition: border 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
}

.activation-input-row input {
    flex: 1;
    border: none;
    outline: none;
    background: transparent;
    color: #f9fafb;
    font-size: 14px;
    padding: 9px 4px 9px 0;
    font-family: 'Cairo', sans-serif;
    text-align: center;
}

.activation-input-row input::placeholder {
    color: #6b7280;
}

/* تفاعل عند التركيز */
.activation-input-row:focus-within {
    border-color: #22c55e;
    box-shadow:
        0 0 0 1px rgba(34, 197, 94, 0.7),
        0 0 26px rgba(34, 197, 94, 0.35);
    background: radial-gradient(circle at top, rgba(22, 163, 74, 0.25), #020617);
}

/* زر إظهار/إخفاء كلمة المرور */
.activation-toggle-password {
    border: none;
    background: transparent;
    cursor: pointer;
    padding: 0;
    margin-left: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #9ca3af;
    font-size: 17px;
    transition: color 0.18s ease, transform 0.18s ease;
}

.activation-toggle-password:hover {
    color: #e5e7eb;
    transform: scale(1.05);
}

/* رسالة الخطأ تحت الحقل */
.activation-error {
    min-height: 20px;
    font-size: 12px;
    color: #f97373;
    margin-top: 6px;
}

/* الفوتر والأزرار */
.activation-footer {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-top: 12px;
    position: relative;
    z-index: 1;
}

.activation-btn {
    border-radius: 999px;
    border: none;
    padding: 8px 20px;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    font-family: 'Cairo', sans-serif;
    transition: transform 0.18s ease, box-shadow 0.18s ease, background 0.18s ease;
}

/* زر التأكيد – أخضر متدرّج أنيق */
.activation-btn.primary {
    background: linear-gradient(135deg, #22c55e, #16a34a);
    color: #022c22;
    box-shadow:
        0 10px 25px rgba(34, 197, 94, 0.55);
}

.activation-btn.primary:hover {
    transform: translateY(-1px);
    box-shadow: 0 12px 30px rgba(34, 197, 94, 0.7);
}

/* زر الإغلاق – غامق أنيق */
.activation-btn.ghost {
    background: rgba(15, 23, 42, 0.9);
    color: #e5e7eb;
    border: 1px solid #374151;
}

.activation-btn.ghost:hover {
    background: #111827;
}

/* اهتزاز بسيط عند الخطأ */
@keyframes activation-shake {
    10%, 90% { transform: translateX(-2px); }
    20%, 80% { transform: translateX(4px); }
    30%, 50%, 70% { transform: translateX(-6px); }
    40%, 60% { transform: translateX(6px); }
}

.activation-dialog.is-shaking {
    animation: activation-shake 0.35s;
}

/* ------- حالة النجاح العالمية ------- */
.activation-dialog.is-success {
    border-color: #22c55e;
    box-shadow:
        0 0 0 1px rgba(34, 197, 94, 0.7),
        0 24px 80px rgba(34, 197, 94, 0.5);
    animation: activation-pop 0.45s ease-out;
}

@keyframes activation-pop {
    0%   { transform: scale(0.9); opacity: 0; }
    60%  { transform: scale(1.07); opacity: 1; }
    100% { transform: scale(1); }
}

.activation-success {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    padding-top: 4px;
    padding-bottom: 2px;
}


/* شعار نجاح ناعم وعالمي أكثر */
.activation-success-icon {
    position: relative;
    width: 90px;
    height: 90px;
    border-radius: 999px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: radial-gradient(circle at 30% 0%, #22c55e, #0f172a);
    box-shadow:
        0 0 28px rgba(34, 197, 94, 0.8),
        0 0 60px rgba(56, 189, 248, 0.45);
    overflow: hidden;
}

/* حلقة خارجية تمشي حوالين الشعار */
.activation-success-icon::before {
    content: "";
    position: absolute;
    inset: -4px;
    border-radius: inherit;
    border: 2px solid transparent;
    background:
        conic-gradient(from 0deg, #22c55e, #0ea5e9, #a855f7, #facc15, #22c55e);
    mask:
        radial-gradient(farthest-side, transparent 62%, #000 64%);
    -webkit-mask:
        radial-gradient(farthest-side, transparent 62%, #000 64%);
    animation: activation-success-ring 5s linear infinite;
    opacity: 0.9;
}

/* لمعة خفيفة تطلع وتروح */
.activation-success-icon::after {
    content: "";
    position: absolute;
    width: 120%;
    height: 120%;
    background: radial-gradient(circle at 10% 0%, rgba(248, 250, 252, 0.45), transparent 60%);
    opacity: 0;
    animation: activation-success-glow 2.4s ease-in-out infinite;
}

/* الدائرة الداخلية ويا علامة الصح (نفس الـ <i> اللي عندك) */
.activation-success-inner {
    position: relative;
    z-index: 1;
    width: 64px;
    height: 64px;
    border-radius: 999px;
    background: radial-gradient(circle at 30% 0%, #ecfdf5, #4ade80);
    display: flex;
    align-items: center;
    justify-content: center;
    color: #064e3b;
    font-size: 30px;
    box-shadow:
        0 8px 20px rgba(22, 163, 74, 0.7),
        0 0 0 1px rgba(22, 163, 74, 0.9);
    animation: activation-success-pulse 1.1s ease-out;
}

/* نبض الشعار أول ما يطلع */
@keyframes activation-success-pulse {
    0%   { transform: scale(0.6); opacity: 0; }
    50%  { transform: scale(1.08); opacity: 1; }
    100% { transform: scale(1); }
}

/* دوران الحلقة الخارجية */
@keyframes activation-success-ring {
    0%   { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* لمعة ناعمة تدخل وتطلع */
@keyframes activation-success-glow {
    0%, 100% { opacity: 0; }
    40%      { opacity: 0.8; }
}


.activation-success-title {
    font-size: 18px;
    font-weight: 700;
    color: #bbf7d0;
}

.activation-success-text {
    font-size: 13px;
    color: #d1fae5;
    max-width: 320px;
}


/* جعل الواجهة بعرض الشاشة على الحاسوب (شاشات كبيرة) */
@media (min-width: 1024px) {
    .container {
        width: 90%;        /* تاخذ كل عرض الصفحة */
        max-width: 100%;    /* تلغي حد 800px */
        margin: 10px 0 20px 0; /* نشيل auto حتى ما تنضغط بالنص */
    }

    .results-container {
        max-width: 100%;    /* النتائج هم تستفاد من كل العرض */
    }
}

/* تكبير كارت النتيجة على الحاسوب */
@media (min-width: 1024px) {
    /* حاوية النتائج تاخذ 80% من عرض الشاشة وتتوسّط */
    .results-container {
        width: 80%;
        max-width: 80%;
        margin: 0 auto;
    }

    /* الكارت نفسه ياخذ كل عرض حاوية النتائج */
    .result-card {
        width: 80%;
        max-width: 100%;
    }
}

/* 🔹 على الحاسوب: أزرار (أسعار بنمط الكروب + المتجر + التوافقات) بصف واحد */
@media (min-width: 1024px) {
    .categories {
        display: flex;
        flex-direction: row;   /* نخليهم صف */
        flex-wrap: wrap;       /* يسمح للسلايدر ينزل سطر جديد */
        justify-content: center;
        align-items: center;
        gap: 10px;
    }

    /* الأزرار الثلاثة بس تصير يم بعض */
    .categories > .new-category-btn,
    .categories > .category-btn,
    .categories > .tools-btn {
        width: auto;       /* نلغي 85% */
        max-width: none;   /* نلغي 250px */
        min-width: 220px;  /* عرض حلو مرتب */
    }

    /* السلايدر يبقى تحتهم بعرض كامل */
    .categories > .slider-container {
        flex-basis: 100%;
        margin-top: 8px;
    }
}


/* 🖥️ تحسين عرض كل النوافذ المنبثقة على الحاسوب فقط */
@media (min-width: 1024px) {

    /* نافذة الإعلان */
    #promoPopup {
        width: min(600px, 70vw);   /* أعرض من الموبايل بس مو فل الشاشة */
    }

    /* نافذة الآيتمات الجديدة */
    #newItemsModal {
        width: min(1100px, 90vw);  /* تاخذ عرض أكبر على الحاسوب */
        max-width: 1100px;
        left: 50%;
        transform: translateX(-50%);
    }

    /* كل نوافذ SweetAlert2 العادية (تنبيهات/رسائل) */
    .swal2-popup {
        width: min(520px, 60vw) !important;
        max-width: 520px !important;
    }

    /* نافذة تفعيل كلمة المرور – نخليها أوسع شوي */
    .swal2-popup.activation-popup {
        width: min(580px, 65vw) !important;
        max-width: 580px !important;
    }
}


/* يخلي مستطيل السعر القديم والجديد بصف واحد */
.price-row {
    display: flex;
    justify-content: center;
    align-items: stretch;
    gap: 8px;
    flex-wrap: wrap;
}

/* مستطيل السعر القديم يستخدم نفس ستايل p تماماً */
.old-price-pill {
    margin: 0; /* لا نريد فراغ إضافي */
}

/* الشطب على السعر القديم – أحمر غامق وبازر */
.old-price-text {
    color: #ffe5e5;
    text-decoration: line-through;
    text-decoration-color: #8b0000;  /* أحمر غامق قوي */
    text-decoration-thickness: 3px;  /* سميك */
    text-underline-offset: 4px;
}


/* مستطيل السعر الجديد – نفس الأبعاد تقريباً لكن أحمر غامق وخط أبيض */
.new-price-pill {
    margin: 0;
    font-size: clamp(16px, 4.5vw, 22px);
    padding: 8px 18px;
    border-radius: 8px;
    font-weight: 700;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
    background-color: #8b0000;  /* أحمر غامق */
    color: #ffffff;             /* خط أبيض قوي */
    min-width: 120px;
    text-align: center;

    position: relative;         /* ضروري للأنيميشن */
    overflow: hidden;
}

/* النصين داخل البادج الأحمر ("عرض خاص" / السعر) */
.new-price-pill .new-price-text {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    white-space: nowrap;
    opacity: 0;
}

/* "عرض خاص" – يرمش أكثر من مرة وبشكل سريع بالبداية */
.new-price-pill .new-price-label {
    animation: blinkOffer 3s infinite;
}

/* السعر – يظهر بعد الرمشات ويبقى باقي الفترة */
.new-price-pill .new-price-value {
    animation: showPrice 3s infinite;
}

/* يرَمّش "عرض خاص" أكثر من مرة بسرعة ثم يختفي */
@keyframes blinkOffer {
    0%   { opacity: 1; }
    10%  { opacity: 0; }
    20%  { opacity: 1; }
    30%  { opacity: 0; }
    40%  { opacity: 1; }
    50%  { opacity: 0; }  /* نهاية الرمشات السريعة */
    60%  { opacity: 0; }
    100% { opacity: 0; }  /* باقي الدورة مخفي */
}

/* السعر: مخفي بالبداية، يظهر بعد الرمشات ويبقى ظاهر */
@keyframes showPrice {
    0%   { opacity: 0; }
    55%  { opacity: 0; }
    65%  { opacity: 1; }
    100% { opacity: 1; }
}


.new-price-pill {
    margin: 0;
    font-size: clamp(16px, 4.5vw, 22px);
    padding: 8px 18px;
    border-radius: 8px;
    font-weight: 700;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);

    /* هنا التعديل المهم */
    background: #8b0000 !important;   /* أحمر غامق صريح، يقتل الغراديانت */
    color: #ffffff;

    min-width: 120px;
    text-align: center;

    position: relative;
    overflow: hidden;
}


/* تعديل خفيف لمحاذاة السعر عمودياً داخل البادجات على الموبايل فقط */
@media (max-width: 768px) {

    /* ⬇️ نزّل السعر القديم داخل صف التخفيض */
    .old-price-text {
        position: relative;
        top: 2px;   /* تقدر تخليها 2px إذا بعده عالي */
    }

    /* ⬇️ نزّل النص داخل البادج الأحمر (عرض خاص / السعر) */
    .new-price-pill .new-price-text {
        transform: translateY(2px); /* هم تقدر تخليها 2px */
    }

}

/* ✅ ضبط البادج اللي فيها "سعر واحد فقط" (بدون تخفيض) */

/* هذا يمسك أي p جوّه .result-card ومو هو البادج القديم ولا الجديد */
.result-card p:not(.old-price-pill):not(.new-price-pill) {
    display: flex !important;
    align-items: center !important;    /* سنترة عمودي */
    justify-content: center !important;/* سنترة أفقي */
    line-height: 1.2 !important;       /* يقلل إحساس إنه طالع لفوك */
}

/* لو تريده مضبوط أكثر على الموبايل */
@media (max-width: 768px) {
    .result-card p:not(.old-price-pill):not(.new-price-pill) {
        padding-top: 10px !important;
        padding-bottom: 8px !important;
    }
}


/* 🔁 توحيد أبعاد كل بادجات السعر (سعر واحد / قديم / جديد) */
.result-card p,
.price-row .old-price-pill,
.price-row .new-price-pill {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    line-height: 1.2;

    /* نفس الحشوة ونفس شكل المستطيل للجميع */
    padding: 8px 18px;
    border-radius: 8px;
    min-height: 40px;
    box-sizing: border-box;
}

/* 📴 موبايل – نفس الأبعاد بس مصغّرة للجميع همين */
@media (max-width: 480px) {
    .result-card p,
    .price-row .old-price-pill,
    .price-row .new-price-pill {
        padding: 6px 15px;
        min-height: 36px;
    }
}


/* زر العروض بالهيدر */
.header-buttons .offers-btn{
    background: linear-gradient(135deg, rgba(250,204,21,.95), rgba(249,115,22,.95));
    color:#111827;
}
.header-buttons .offers-btn:hover{
    transform: scale(1.06);
    filter: brightness(1.05);
}
.header-buttons .offers-btn:active{
    transform: scale(0.95);
}

/* نافذة العروض */
#offersModal{
    position: fixed;
    top: 50px;
    bottom: 60px;
    left: 50%;
    transform: translateX(-50%);
    width: calc(100% - 20px);
    max-width: 980px;
    background:
        radial-gradient(circle at top left, rgba(250,204,21,.12), transparent 45%),
        radial-gradient(circle at bottom right, rgba(249,115,22,.10), transparent 55%),
        rgba(15, 23, 42, 0.92);
    backdrop-filter: blur(18px);
    border: 1px solid rgba(55, 65, 81, 0.75);
    border-radius: 18px;
    padding: 14px;
    z-index: 10000;
    display: none;
    flex-direction: column;
    gap: 10px;
    box-shadow: 0 20px 60px rgba(0,0,0,.75);
}

/* زر الإغلاق (نسخة خاصة للعروض) */
#offersModal .close-modal-btn{
    position:absolute;
    top: 10px;
    inset-inline-end: 10px;
    width: 34px;
    height: 34px;
    border-radius: 999px;
    border: none;
    background: rgba(17,24,39,.85);
    color:#e5e7eb;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    box-shadow: 0 10px 25px rgba(0,0,0,.6);
    transition: transform .18s ease, background .18s ease;
}
#offersModal .close-modal-btn:hover{
    transform: scale(1.08);
    background: linear-gradient(135deg, #ef4444, #b91c1c);
}
#offersModal .close-modal-btn:active{ transform: scale(.92); }

/* رأس النافذة */
#offersModal .offers-head{
    display:flex;
    align-items:center;
    justify-content: space-between;
    gap: 10px;
    padding: 6px 4px 0;
}
#offersModal h2{
    margin:0;
    font-size: 22px;
    font-weight: 900;
    letter-spacing: .02em;
    background: linear-gradient(135deg, #facc15, #fb923c);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}
#offersModal .offers-chip{
    font-family: 'Cairo', sans-serif;
    font-size: 12px;
    color: #111827;
    background: rgba(250,204,21,.95);
    padding: 6px 10px;
    border-radius: 999px;
    box-shadow: 0 10px 24px rgba(0,0,0,.35);
    white-space: nowrap;
}

/* شريط البحث */
#offersModal .offers-toolbar{
    position: relative;
    width: 100%;
    padding: 0 4px;
}
#offersModal .offers-toolbar i{
    position:absolute;
    inset-inline-end: 18px;
    top: 50%;
    transform: translateY(-50%);
    color: rgba(229,231,235,.7);
    pointer-events:none;
}
#offersSearchInput{
    width: 100%;
    padding: 12px 44px 12px 12px;
    border-radius: 14px;
    background: rgba(17,24,39,.72);
    border: 1px solid rgba(55,65,81,.85);
    color: #fff;
    outline: none;
    font-family: 'Cairo', sans-serif;
    transition: box-shadow .2s ease, border-color .2s ease;
}
#offersSearchInput:focus{
    border-color: rgba(250,204,21,.85);
    box-shadow: 0 0 0 4px rgba(250,204,21,.12);
}

/* محتوى العروض (Grid) */
#offersModal .offers-content{
    width: 100%;
    flex: 1;
    overflow-y: auto;
    padding: 6px;
    border-radius: 16px;
    background: rgba(15,23,42,.55);
    border: 1px solid rgba(31,41,55,.75);
    display: grid;
    grid-template-columns: 1fr;
    gap: 10px;
    scrollbar-width: none;
    -ms-overflow-style: none;
}
#offersModal .offers-content::-webkit-scrollbar{ display:none; }

@media (min-width: 640px){
    #offersModal .offers-content{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
}
@media (min-width: 1024px){
    #offersModal{ width: min(1200px, 92vw); }
    #offersModal .offers-content{ grid-template-columns: repeat(3, minmax(0, 1fr)); }
}

/* كارت العرض */
.offer-card{
    border-radius: 16px;
    padding: 12px;
    background:
        radial-gradient(circle at top left, rgba(96,165,250,.16), rgba(15,23,42,.92));
    border: 1px solid rgba(55,65,81,.85);
    box-shadow: 0 14px 34px rgba(0,0,0,.55);
    transition: transform .18s ease, box-shadow .18s ease;
}
.offer-card:hover{
    transform: translateY(-2px);
    box-shadow: 0 18px 44px rgba(0,0,0,.65);
}

.offer-top{
    display:flex;
    align-items:flex-start;
    gap: 10px;
}
.offer-icon{
    width: 44px;
    height: 44px;
    border-radius: 14px;
    background: rgba(250,204,21,.08);
    border: 1px solid rgba(250,204,21,.20);
    display:flex;
    align-items:center;
    justify-content:center;
}
.offer-icon i{ font-size: 18px; color: #facc15; }

.offer-title{
    font-size: 15px;
    font-weight: 900;
    color: #fff;
    line-height: 1.35;
    margin: 0 0 6px 0;
}
.offer-meta{
    display:flex;
    align-items:center;
    justify-content: space-between;
    gap: 8px;
    flex-wrap: wrap;
}
.offer-tag{
    font-size: 12px;
    color: rgba(229,231,235,.9);
    background: rgba(31,41,55,.75);
    border: 1px solid rgba(55,65,81,.75);
    padding: 4px 8px;
    border-radius: 999px;
}
.offer-save{
    font-size: 12px;
    color: #111827;
    background: rgba(250,204,21,.95);
    padding: 4px 8px;
    border-radius: 999px;
    font-weight: 800;
}

/* جزء الأسعار داخل الكارت (يعتمد على price-row/old-price-pill/new-price-pill الموجودة عندك) */
.offer-prices{ margin-top: 10px; }
.offer-prices .price-row{ justify-content: flex-start; }


/* ✅ مستطيل السعر السابق فقط (بدون أي نص إضافي) */
.old-price-pill{
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  padding: 12px 14px !important;
  border-radius: 14px !important;

  background: rgba(255,255,255,.06) !important;
  border: 1px solid rgba(239,68,68,.22) !important;
  box-shadow: 0 10px 26px rgba(0,0,0,.30) !important;
}

/* تخلي الرقم مشطوب بشكل أنيق */
.old-price-text{
  font-weight: 1000 !important;
  color: rgba(255,255,255,.90) !important;
  text-decoration: line-through !important;
  text-decoration-color: rgba(239,68,68,.95) !important;
  text-decoration-thickness: 3px !important;
  text-underline-offset: 4px !important;
}

/* ==============================
   OFFER CARD - NEW CLEAN LAYOUT
   Desktop + Mobile (Override)
   Paste at END of CSS
============================== */

/* الكارت: مسافات وترتيب أوضح */
.offer-card{
  padding: 14px !important;
}

/* الجزء العلوي يصير “صف مرتب”: أيقونة + تفاصيل */
.offer-top{
  display: grid !important;
  grid-template-columns: 52px 1fr !important;
  gap: 12px !important;
  align-items: center !important;
}

/* الأيقونة تثبت */
.offer-icon{
  width: 52px !important;
  height: 52px !important;
  border-radius: 16px !important;
}

/* العنوان يصير أوضح وما يطوّل */
.offer-title{
  margin: 0 0 8px 0 !important;
  line-height: 1.35 !important;

  /* سطرين كحد أقصى (حتى يبقى الكارت مرتب) */
  display: -webkit-box !important;
  -webkit-line-clamp: 2 !important;
  -webkit-box-orient: vertical !important;
  overflow: hidden !important;
}

/* سطر الميتا (التصنيف + وفر) ترتيب ثابت */
.offer-meta{
  justify-content: flex-start !important;
  gap: 8px !important;
}
.offer-save{
  margin-inline-start: auto; /* يخلي “وفر” يروح للطرف بدون توسيط */
}

/* قسم الأسعار يصير مثل Footer داخل الكارت */
.offer-prices{
  margin-top: 12px !important;
  padding-top: 12px !important;
  border-top: 1px solid rgba(255,255,255,.08) !important;
}

/* صف السعرين: Grid ثابت */
.price-row{
  display: grid !important;
  grid-template-columns: 1fr 1fr !important;
  gap: 10px !important;
  align-items: stretch !important;
  justify-content: unset !important;
}

/* البادجات تاخذ عرضها بالكامل */
.old-price-pill,
.new-price-pill{
  width: 100% !important;
  min-width: 0 !important; /* يلغي min-width 120px إذا مأثر */
}

/* بالموبايل: نرتّبها عمودي حتى ما ينخنق المحتوى */
@media (max-width: 520px){
  .offer-top{
    grid-template-columns: 44px 1fr !important;
    align-items: start !important;
  }
  .offer-icon{
    width: 44px !important;
    height: 44px !important;
    border-radius: 14px !important;
  }

  .price-row{
    grid-template-columns: 1fr !important; /* السعرين تحت بعض */
    gap: 8px !important;
  }

  .offer-title{
    -webkit-line-clamp: 3 !important; /* نخليه 3 أسطر بالموبايل */
  }

  .offer-save{
    margin-inline-start: 0; /* لا يروح بعيد بالموبايل */
  }
}


/* داخل نافذة العروض فقط: نفس أبعاد مستطيل السعرين */
#offersModal .old-price-pill,
#offersModal .new-price-pill{
  width: 100% !important;
  min-width: 0 !important;
  padding: 12px 14px !important;
  border-radius: 14px !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  box-sizing: border-box !important;
  min-height: 44px !important; /* نفس الارتفاع دائماً */
}

/* X داخل نافذة العروض: أعلى اليمين + أحمر غامق */
#offersModal .close-modal-btn{
  top: 12px !important;
  right: 12px !important;
  left: auto !important;

  inset-inline-end: auto !important;   /* يلغي RTL اللي يوديه يسار */
  inset-inline-start: auto !important;

  background: #6b0000 !important;
  color: #fff !important;
}
#offersModal .close-modal-btn:hover{
  background: #8b0000 !important;
}

/* يزحف عنوان "العروض الجديدة" لليسار حتى ما يجي تحت زر الإغلاق */
#offersModal .offers-head h2{
  margin-right: 46px !important;  /* يزيد فراغ يمين ويزحف النص لليسار */
}


/* ✅ موبايل: طفي البلور والبلند واللمعة المتحركة */
@media (hover: none), (pointer: coarse), (max-width: 768px) {

  /* طفي blur لأنه أكثر سبب للومضة */
  #maintenance-overlay.activation-overlay {
    -webkit-backdrop-filter: none !important;
    backdrop-filter: none !important;
    background: rgba(0,0,0,0.75) !important; /* بديل أنيق بدون blur */
  }

  /* طفي اللمعة/البلند */
  #maintenance-overlay .activation-dialog::before {
    animation: none !important;
    mix-blend-mode: normal !important;
    opacity: 0.25 !important;
  }

  /* خفف تغييرات الفوكس اللي تسوي فلاش */
  #maintenance-overlay .activation-input-row,
  #maintenance-overlay .activation-input-row:focus-within {
    box-shadow: none !important;
    transition: border 0.15s ease, background 0.15s ease !important;
  }

  /* ✅ يمنع زوم iPhone (إذا الخط أقل من 16 يصير زوم وفلاش) */
  #maintenance-overlay input {
    font-size: 16px !important;
  }

  /* ✅ يمنع “الوميض الأزرق” مال اللمس */
  #maintenance-overlay, #maintenance-overlay * {
    -webkit-tap-highlight-color: transparent;
  }
}


/* ✅ ثبّت الأوفرلاي كطبقة كاملة فوق كلشي */
#maintenance-overlay.activation-overlay{
  position: fixed !important;
  inset: 0 !important;
  width: 100vw !important;
  height: 100dvh !important; /* مهم للموبايل */
  z-index: 999999 !important;
  background: rgba(0,0,0,0.78) !important;
  isolation: isolate; /* يمنع التداخل البصري */
  -webkit-backdrop-filter: none !important;
  backdrop-filter: none !important;
  overscroll-behavior: contain;
}

/* ✅ خَلّي نافذة الصيانة طبقة مستقرة وما تعيد رسم الواجهة تحت */
#maintenance-overlay .activation-dialog{
  transform: translate3d(0,0,0);
  will-change: transform;
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
  contain: layout paint; /* يمنع تسرب الرسم */
}

/* ✅ امنع قفزة التخطيط لما تظهر رسالة الخطأ */
#maintenance-overlay #maintenance-error-row{
  min-height: 18px;
}

/* ✅ اهتزاز ثلاثي الأبعاد (أقل مشاكل على الموبايل) */
#maintenance-overlay .activation-dialog.is-shaking{
  animation: maintenanceShake3d 0.35s ease;
}

@keyframes maintenanceShake3d{
  0%   { transform: translate3d(0,0,0); }
  20%  { transform: translate3d(-6px,0,0); }
  40%  { transform: translate3d(6px,0,0); }
  60%  { transform: translate3d(-4px,0,0); }
  80%  { transform: translate3d(4px,0,0); }
  100% { transform: translate3d(0,0,0); }
}


@media (hover: none), (pointer: coarse), (max-width: 768px) {

  /* ✅ ثبّت الأوفرلاي */
  #activation-overlay.activation-overlay{
    position: fixed !important;
    inset: 0 !important;
    width: 100vw !important;
    height: 100dvh !important;
    z-index: 999999 !important;
    background: rgba(0,0,0,0.78) !important;
    isolation: isolate;
    -webkit-backdrop-filter: none !important;
    backdrop-filter: none !important;
    overscroll-behavior: contain;
  }

  /* ✅ خَلّي النافذة طبقة مستقرة */
  #activation-overlay .activation-dialog{
    transform: translate3d(0,0,0);
    will-change: transform;
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
    contain: layout paint;
  }

  /* ✅ امنع قفزة التخطيط لما يظهر الخطأ */
  #activation-overlay #activation-error-row{
    min-height: 18px;
  }

  /* ✅ اهتزاز 3D يقلل الفلاش */
  #activation-overlay .activation-dialog.is-shaking{
    animation: activationShake3d 0.35s ease;
  }

  @keyframes activationShake3d{
    0%   { transform: translate3d(0,0,0); }
    20%  { transform: translate3d(-6px,0,0); }
    40%  { transform: translate3d(6px,0,0); }
    60%  { transform: translate3d(-4px,0,0); }
    80%  { transform: translate3d(4px,0,0); }
    100% { transform: translate3d(0,0,0); }
  }

  /* ✅ يمنع اللمعة/البلند إذا كانت موجودة بالـ ::before (نفس فكرة الصيانة) */
  #activation-overlay .activation-dialog::before{
    animation: none !important;
    mix-blend-mode: normal !important;
    opacity: 0.25 !important;
  }

  /* ✅ يمنع الوميض الأزرق */
  #activation-overlay, #activation-overlay * {
    -webkit-tap-highlight-color: transparent;
  }

  /* ✅ يمنع زوم iPhone اللي يسبب وميض */
  #activation-overlay input{
    font-size: 16px !important;
  }

  /* ✅ خفف الفوكس شادو */
  #activation-overlay .activation-input-row,
  #activation-overlay .activation-input-row:focus-within{
    box-shadow: none !important;
    transition: border 0.15s ease, background 0.15s ease !important;
  }
}


@media (hover: none), (pointer: coarse), (max-width: 768px) {
  /* يمنع المتصفح يسوي highlight/وميض وقت اللمس */
  #activation-overlay * { -webkit-tap-highlight-color: transparent; }

  /* يقفل أي سكرول داخل الأوفرلاي ويسوي طبقة ثابتة */
  #activation-overlay { touch-action: none; }

  /* يطفي أي outline افتراضي ممكن يسبب ومضة */
  #activation-overlay input:focus { outline: none !important; }
}


/* ===== Header Cart Button ===== */
.header-cart-btn{
  position: relative;
  display:flex;
  align-items:center;
  gap: 8px;
  padding: 0 12px;
  border: 1px solid rgba(255,255,255,.14);
  background: radial-gradient(circle at top left, rgba(96,165,250,.35), rgba(15,23,42,.2));
}
.header-cart-badge{
  min-width: 20px;
  height: 20px;
  padding: 0 6px;
  border-radius: 999px;
  background: rgba(17,24,39,.95);
  border: 1px solid rgba(255,255,255,.18);
  color:#fff;
  font-size: 11px;
  font-weight: 900;
  display:flex;
  align-items:center;
  justify-content:center;
}

/* ===== Overlay (اذا مو موجود عندك) ===== */
.overlay{
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.55);
  z-index: 9998;
}

/* ===== Cart Modal ===== */
.cart-modal{
  position: fixed;
  inset: 0;
  display: none;
  z-index: 9999;
  direction: rtl;
  font-family: 'Cairo', sans-serif;
}
.cart-shell{
  position: absolute;
  top: 70px;
  bottom: 70px;
  left: 50%;
  transform: translateX(-50%);
  width: min(980px, calc(100% - 20px));
  background:
    radial-gradient(circle at top left, rgba(249,115,22,.14), transparent 45%),
    radial-gradient(circle at bottom right, rgba(96,165,250,.16), transparent 55%),
    rgba(15,23,42,.92);
  border: 1px solid rgba(255,255,255,.12);
  border-radius: 18px;
  box-shadow: 0 28px 70px rgba(0,0,0,.75);
  backdrop-filter: blur(18px);
  display:flex;
  flex-direction: column;
  overflow: hidden;
}

/* top */
.cart-top{
  padding: 14px 14px 10px;
  display:flex;
  align-items:center;
  justify-content: space-between;
  border-bottom: 1px solid rgba(255,255,255,.10);
}
.cart-title{display:flex;align-items:center;gap:10px;}
.cart-ico{
  width: 38px;height:38px;border-radius: 14px;
  background: linear-gradient(135deg, rgba(249,115,22,.35), rgba(96,165,250,.20));
  border: 1px solid rgba(255,255,255,.12);
  display:grid;place-items:center;color:#fff;
}
.cart-h1{color:#fff;font-weight: 900;font-size: 18px;}
.cart-h2{color:#cbd5e1;font-size: 12px;margin-top:2px;}
.cart-x{
  width: 38px;height:38px;border-radius: 999px;
  border: 1px solid rgba(255,255,255,.12);
  background: rgba(255,255,255,.06);
  color:#fff;cursor:pointer;
}
.cart-x:hover{background: rgba(239,68,68,.25);}

/* body */
.cart-body{
  padding: 12px;
  overflow: auto;
  display:flex;
  flex-direction: column;
  gap: 10px;
}
.cart-body::-webkit-scrollbar{display:none;}
.cart-body{scrollbar-width:none;-ms-overflow-style:none;}

/* item row */
.cart-item{
  display:grid;
  grid-template-columns: 62px 1fr auto;
  gap: 10px;
  padding: 10px;
  border-radius: 16px;
  border: 1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.06);
}
.cart-item img{
  width: 62px;height:62px;border-radius: 16px;
  object-fit: cover;
  background: rgba(255,255,255,.06);
}
.cart-info{min-width:0;}
.cart-name{
  color:#fff;font-weight: 900;font-size: 14px;
  line-height: 1.25;
  white-space: normal;           /* <-- هذا يحل مشكلة “اسم المادة ما يطلع” */
  overflow: hidden;
  display:-webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
}
.cart-sub{
  margin-top: 6px;
  display:flex;
  flex-wrap: wrap;
  gap: 6px;
  color:#cbd5e1;
  font-size: 12px;
}
.cart-chip{
  padding: 4px 8px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,.12);
  background: rgba(0,0,0,.25);
}
.cart-side{
  display:flex;
  flex-direction: column;
  align-items:flex-end;
  gap: 8px;
}
.cart-line-total{color:#fff;font-weight: 900;}
.qty{
  display:flex;align-items:center;gap:6px;
  padding: 6px 8px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,.12);
  background: rgba(0,0,0,.25);
}
.qty button{
  width: 28px;height:28px;border-radius: 999px;
  border:none;background: rgba(255,255,255,.10);
  color:#fff;cursor:pointer;
}
.qty .qv{min-width: 18px;text-align:center;color:#fff;font-weight: 900;}
.cart-rm{
  width: 34px;height:34px;border-radius: 12px;
  border: 1px solid rgba(239,68,68,.25);
  background: rgba(239,68,68,.12);
  color:#fff;cursor:pointer;
}

/* bottom */
.cart-bottom{
  padding: 12px;
  border-top: 1px solid rgba(255,255,255,.10);
  background: rgba(2,6,23,.25);
}
.cart-sum{display:flex;flex-direction:column;gap:8px;margin-bottom:10px;}
.sum-row{display:flex;justify-content:space-between;align-items:center;color:#e5e7eb;}
.sum-disc{display:flex;align-items:center;gap:8px;}
.sum-disc input{
  width: 130px;
  padding: 8px 10px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,.12);
  background: rgba(255,255,255,.06);
  color:#fff;outline:none;
}
.sum-grand{
  padding-top: 8px;
  border-top: 1px dashed rgba(255,255,255,.16);
  font-size: 16px;
  font-weight: 900;
}

.cart-actions{display:flex;gap:10px;}
.cart-btn{
  flex:1;
  padding: 12px 10px;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,.12);
  cursor:pointer;
  font-weight: 900;
  font-family:'Cairo',sans-serif;
  color:#fff;
}
.cart-btn.ghost{background: rgba(255,255,255,.06);}
.cart-btn.primary{background: linear-gradient(135deg, rgba(249,115,22,.9), rgba(96,165,250,.55));}
.cart-btn:active{transform: scale(.98);}

/* ===== Mini Add Button (Elegant) داخل كارت النتيجة بدون تأثير على المقاس ===== */
.result-card{ position: relative; } /* مهم جداً */
.add-mini{
  position:absolute;
  top: 10px;
  left: 10px;
  width: 34px;
  height: 34px;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,.16);
  background: linear-gradient(135deg, rgba(249,115,22,.55), rgba(96,165,250,.25));
  color:#fff;
  display:grid;
  place-items:center;
  cursor:pointer;
  box-shadow: 0 10px 25px rgba(0,0,0,.35);
  backdrop-filter: blur(10px);
}
.add-mini:hover{transform: translateY(-1px);}
.add-mini:active{transform: scale(.96);}
@media (max-width: 520px){
  .add-mini{ width: 38px; height: 38px; border-radius: 16px; }
}


/* Invoice paper */
.invoice-paper{
  width: 794px;            /* تقريب A4 على 96dpi */
  background: #fff;
  color: #0f172a;
  direction: rtl;
  font-family: 'Cairo', sans-serif;
  padding: 28px;
}

.inv-head{
  display:flex;
  justify-content: space-between;
  align-items: center;
  gap: 16px;
  padding-bottom: 14px;
  border-bottom: 2px solid #e5e7eb;
}
.inv-brand{
  display:flex; align-items:center; gap:12px;
}
.inv-brand img{
  width: 66px; height: 66px;
  border-radius: 16px;
  object-fit: cover;
  border: 1px solid #e5e7eb;
}
.inv-brand .t1{font-size:18px;font-weight:900;}
.inv-brand .t2{font-size:12px;color:#475569;margin-top:2px;}

.inv-meta{
  text-align:left;
  direction:ltr;
  font-size:12px;
  color:#334155;
}
.inv-meta div{margin-bottom:4px;}

.inv-panels{
  margin-top: 14px;
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
}
.inv-panel{
  border: 1px solid #e5e7eb;
  border-radius: 14px;
  padding: 12px;
  background: #f8fafc;
}
.inv-panel .h{font-weight:900;margin-bottom:8px;}
.inv-panel .p{font-size:12px;color:#334155;line-height:1.6;}

.inv-table{
  width:100%;
  border-collapse: collapse;
  margin-top: 14px;
}
.inv-table th{
  background:#0f172a;
  color:#fff;
  font-size:12px;
  padding:10px;
  text-align:center;
}
.inv-table td{
  border:1px solid #e5e7eb;
  padding:10px;
  font-size:12px;
  vertical-align: top;
}
.inv-table td.center{text-align:center;}
.inv-item-name{font-weight:900;}
.inv-item-sub{margin-top:4px;color:#64748b;font-size:10px;}

.inv-sum{
  margin-top: 12px;
  display:flex;
  justify-content: flex-end;
}
.inv-sum .box{
  width: 320px;
  border:1px solid #e5e7eb;
  border-radius: 14px;
  padding: 12px;
  background:#fff;
}
.inv-sum .row{
  display:flex;
  justify-content: space-between;
  font-size:12px;
  margin-bottom:8px;
}
.inv-sum .row.g{
  border-top: 1px dashed #e5e7eb;
  padding-top: 10px;
  font-size:14px;
  font-weight:900;
}

.inv-foot{
  margin-top: 14px;
  padding-top: 12px;
  border-top:1px solid #e5e7eb;
  display:flex;
  justify-content: space-between;
  align-items:center;
  font-size:11px;
  color:#475569;
}


/* ✅ أزرار أيقونات للهيدر (عدا السلة) */
.header-icon-btn{
    width: 34px;
    height: 34px;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 10px;
    font-size: 16px;
    line-height: 1;
}
.header-icon-btn i{
    pointer-events: none;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.35));
}

/* ✅ ستايل زر العروض */
.header-btn.offers-btn{
    background: linear-gradient(135deg, #b45309, #d97706);
}
.header-btn.offers-btn:hover{
    background: linear-gradient(135deg, #d97706, #f59e0b);
}


/* ✅ Feedback: يبين تمّت الإضافة للسلة */
.add-mini{
  transition: transform .15s ease, filter .2s ease, box-shadow .2s ease;
}
.add-mini:focus-visible{
  outline: 2px solid rgba(96,165,250,.7);
  outline-offset: 2px;
}
.add-mini.adding{ transform: scale(.92); }

.add-mini.added{
  border-color: rgba(34,197,94,.35);
  background: linear-gradient(135deg, rgba(34,197,94,.65), rgba(16,185,129,.25));
  box-shadow: 0 12px 28px rgba(34,197,94,.18), 0 10px 25px rgba(0,0,0,.35);
}
.add-mini.added i{ animation: addPop .35s ease; }

.add-mini::after{
  content: "تمت الإضافة";
  position: absolute;
  left: 50%;
  top: -10px;
  transform: translate(-50%, -100%) scale(.96);
  opacity: 0;
  pointer-events: none;
  padding: 6px 10px;
  border-radius: 999px;
  font-size: 11px;
  font-weight: 900;
  color: #fff;
  background: rgba(2,6,23,.75);
  border: 1px solid rgba(255,255,255,.14);
  backdrop-filter: blur(10px);
  white-space: nowrap;
}
.add-mini.added::after{
  opacity: 1;
  transform: translate(-50%, -100%) scale(1);
}

@keyframes addPop{
  0%{ transform: scale(.85) rotate(-6deg); }
  60%{ transform: scale(1.15) rotate(0deg); }
  100%{ transform: scale(1) rotate(0deg); }
}



.swal2-container {
  z-index: 30000 !important;
}


.swal2-confirm, .swal2-cancel {
  border-radius: 8px !important;
  clip-path: inset(0 0 0 0 round 8px) !important;
  font-family: 'Cairo', sans-serif !important;
}


.swal2-confirm:active, .swal2-cancel:active {
  clip-path: inset(0 0 0 0 round 8px) !important;
}

.exit-confirm, .exit-cancel {
  border-radius: 8px !important;
  font-family: 'Cairo', sans-serif !important;
}

/* ✅ نفس إحساس زر الخروج: بدون هايلايت/فوكس يطلع برّه الزر */
.header-btn,
.header-icon-btn,
.header-cart-btn,
.exit-confirm,
.exit-cancel {
  -webkit-tap-highlight-color: transparent; /* يشيل لمعة الموبايل */
  outline: none;
  -webkit-appearance: none;
  appearance: none;
}

/* ✅ قص صارم يطابق الحواف (حتى الظلال/التأثيرات ما تطلع برّه) */
.header-btn{
  overflow: hidden !important;
  clip-path: inset(0 0 0 0 round 8px) !important; /* نفس border-radius مال header-btn */
}

/* زر العروض (لأن عنده border-radius 10px بالـ header-icon-btn) */
.header-icon-btn{
  overflow: hidden !important;
  clip-path: inset(0 0 0 0 round 10px) !important;
}

/* زر السلة (هو أصلاً header-btn بس نخليه مؤكد) */
.header-cart-btn{
  overflow: hidden !important;
  clip-path: inset(0 0 0 0 round 8px) !important;
}

/* ✅ يشيل الـ focus outline نهائياً (حتى بعد الضغط) */
.header-btn:focus,
.header-btn:focus-visible,
.header-icon-btn:focus,
.header-icon-btn:focus-visible,
.header-cart-btn:focus,
.header-cart-btn:focus-visible,
.exit-confirm:focus,
.exit-confirm:focus-visible,
.exit-cancel:focus,
.exit-cancel:focus-visible{
  outline: none !important;
}


/* ✅ نفس إحساس زر الخروج: بدون هايلايت/فوكس */
#offersModal .close-modal-btn,
#newItemsModal .close-modal-btn,
.cart-x,
.cart-btn,
.qty button,
.cart-rm{
  -webkit-tap-highlight-color: transparent !important;
  outline: none !important;
  -webkit-appearance: none;
  appearance: none;
}

/* ✅ قص صارم لأزرار الإغلاق (X) لأنها دائرية */
#offersModal .close-modal-btn,
#newItemsModal .close-modal-btn,
.cart-x{
  position: relative;
  overflow: hidden !important;
  clip-path: circle(50% at 50% 50%) !important;
}

/* ✅ قص صارم لأزرار السلة (مستطيلة بحواف 14px) */
.cart-btn{
  position: relative;
  overflow: hidden !important;
  clip-path: inset(0 0 0 0 round 14px) !important;
}

/* ✅ قص صارم لأزرار الكمية لأنها دائرية */
.qty button{
  position: relative;
  overflow: hidden !important;
  clip-path: circle(50% at 50% 50%) !important;
}

/* ✅ قص صارم لزر الحذف (حوافه 12px) */
.cart-rm{
  position: relative;
  overflow: hidden !important;
  clip-path: inset(0 0 0 0 round 12px) !important;
}

/* ✅ يشيل focus نهائياً حتى ما يطلع برّه الزر */
#offersModal .close-modal-btn:focus,
#offersModal .close-modal-btn:focus-visible,
#newItemsModal .close-modal-btn:focus,
#newItemsModal .close-modal-btn:focus-visible,
.cart-x:focus,
.cart-x:focus-visible,
.cart-btn:focus,
.cart-btn:focus-visible,
.qty button:focus,
.qty button:focus-visible,
.cart-rm:focus,
.cart-rm:focus-visible{
  outline: none !important;
  box-shadow: none !important;
}

/* فايرفوكس */
#offersModal .close-modal-btn::-moz-focus-inner,
#newItemsModal .close-modal-btn::-moz-focus-inner,
.cart-x::-moz-focus-inner,
.cart-btn::-moz-focus-inner,
.qty button::-moz-focus-inner,
.cart-rm::-moz-focus-inner{
  border: 0 !important;
}


.close-modal-btn{
  -webkit-tap-highlight-color: transparent !important;
  outline: none !important;
  overflow: hidden !important;
  clip-path: circle(50% at 50% 50%) !important;
}



/* ✅ زر إعلان الصفحة: نفس ستايل الأزرار الباقية + بدون بيضوية */
#promoPopup #closeBtn{
  border-radius: 14px !important;          /* بدل 999px/25px */
  overflow: hidden !important;
  clip-path: inset(0 0 0 0 round 14px) !important;

  -webkit-tap-highlight-color: transparent !important;
  outline: none !important;
  -webkit-appearance: none;
  appearance: none;

  font-family: 'Cairo', sans-serif !important;
}

/* ✅ منع الـ focus/الهايلايت نهائياً */
#promoPopup #closeBtn:focus,
#promoPopup #closeBtn:focus-visible{
  outline: none !important;
  box-shadow: none !important;
}

/* ✅ فايرفوكس */
#promoPopup #closeBtn::-moz-focus-inner{
  border: 0 !important;
}

/* ✅ تأكيد القص عند الضغط (حتى ما يطلع تأثير برا الزر) */
#promoPopup #closeBtn:active{
  clip-path: inset(0 0 0 0 round 14px) !important;
}


#promoPopup button{
  -webkit-tap-highlight-color: transparent !important;
  outline: none !important;
  -webkit-appearance: none;
  appearance: none;
  font-family: 'Cairo', sans-serif !important;
  overflow: hidden !important;
  border-radius: 14px !important;
  clip-path: inset(0 0 0 0 round 14px) !important;
}
#promoPopup button:focus,
#promoPopup button:focus-visible{
  outline: none !important;
  box-shadow: none !important;
}

/* ✅ زر X: ثابت يمين + نفس قص/منع هايلايت مثل بقية الأزرار */
#newItemsModal .close-modal-btn,
#offersModal .close-modal-btn{
  position: absolute !important;
  top: 10px !important;
  right: 10px !important;
  left: auto !important;
  margin: 0 !important;
  transform: none !important;

  /* نفس إحساس زر الخروج */
  -webkit-tap-highlight-color: transparent !important;
  outline: none !important;
  -webkit-appearance: none;
  appearance: none;

  /* يمنع أي تأثير يطلع برا الزر */
  overflow: hidden !important;
  clip-path: circle(50% at 50% 50%) !important;
}

/* ✅ شيل الـ focus نهائياً */
#newItemsModal .close-modal-btn:focus,
#newItemsModal .close-modal-btn:focus-visible,
#offersModal .close-modal-btn:focus,
#offersModal .close-modal-btn:focus-visible{
  outline: none !important;
  box-shadow: none !important;
}

/* ✅ فايرفوكس */
#newItemsModal .close-modal-btn::-moz-focus-inner,
#offersModal .close-modal-btn::-moz-focus-inner{
  border: 0 !important;
}


/* ✅ نفس إحساس زر الخروج: بدون هايلايت/فوكس يطلع برّه الزر (معاينة + فول سكرين) */
#imgPrevFull,
#imgPrevClose,
#imgFullBack{
  -webkit-tap-highlight-color: transparent;
  outline: none;
  -webkit-appearance: none;
  appearance: none;

  overflow: hidden !important;
  clip-path: inset(0 0 0 0 round 14px) !important; /* ✅ حواف مثل باقي الأزرار */
  border-radius: 14px !important;                 /* ✅ حتى يصير الشكل مو بيضوي */
}

/* ✅ يشيل الـ focus outline نهائياً */
#imgPrevFull:focus,
#imgPrevFull:focus-visible,
#imgPrevClose:focus,
#imgPrevClose:focus-visible,
#imgFullBack:focus,
#imgFullBack:focus-visible{
  outline: none !important;
  box-shadow: none !important;
}


/* =========================================================
   PROMO POPUP THEME (EDIT HERE)  ✅
   - خليه آخر CSS بالملف
   - كل أسبوع غيّر المتغيرات فقط (الألوان/الحركة)
   ========================================================= */



/* ====== PROMO GIFT (UI only) ====== */
#promoPopup.promo-gift{
  /* ✅ تثبيت بالنص 100% */
  position: fixed !important;
  top: 50% !important;
  left: 50% !important;
  transform: translate(-50%, -100%); /* مهم لبداية أنيميشن promoPopIn */
  z-index: 9999;

  width: min(460px, 92vw) !important;
  max-width: 460px !important;

  border-radius: 22px !important;
  padding: 18px 16px 14px !important;
  display: none;
  flex-direction: column;
  gap: 14px;

  text-align: right;
  direction: rtl;

  background:
    radial-gradient(1200px 600px at 10% 0%, rgba(34,197,94,.18), transparent 55%),
    radial-gradient(900px 500px at 100% 10%, rgba(14,165,233,.20), transparent 50%),
    rgba(10, 15, 28, .92);
  backdrop-filter: blur(18px);
  box-shadow:
    0 24px 60px rgba(0,0,0,.75),
    inset 0 0 0 1px rgba(255,255,255,.06);
  overflow: hidden;

  /* حركة خفيفة بعد الظهور */
  animation-name: none;
}

/* لمعان متحرك داخل النافذة */
#promoPopup.promo-gift::before{
  content:"";
  position:absolute;
  inset:-2px;
  background: linear-gradient(135deg, rgba(34,197,94,.55), rgba(14,165,233,.55), rgba(168,85,247,.55));
  filter: blur(18px);
  opacity: .32;
  z-index: 0;
}
#promoPopup.promo-gift::after{
  content:"";
  position:absolute;
  inset: -40%;
  background: radial-gradient(circle, rgba(255,255,255,.10), transparent 45%);
  transform: translateX(-35%) rotate(18deg);
  animation: promoShimmer 4.8s ease-in-out infinite;
  z-index: 0;
  opacity: .35;
}
@keyframes promoShimmer{
  0%   { transform: translateX(-35%) rotate(18deg); }
  50%  { transform: translateX(35%) rotate(18deg); }
  100% { transform: translateX(-35%) rotate(18deg); }
}

#promoPopup.promo-gift > *{ position: relative; z-index: 1; }

/* زر X */
#promoPopup.promo-gift .promo-x{
  position:absolute;
  top: 10px;
  left: 10px;
  width: 36px;
  height: 36px;
  border-radius: 12px;
  border: 0;
  cursor: pointer;
  background: rgba(255,255,255,.08);
  color: #e5e7eb;
  display:flex;
  align-items:center;
  justify-content:center;
  transition: transform .18s ease, background .18s ease;
}
#promoPopup.promo-gift .promo-x:hover{ transform: scale(1.06); background: rgba(255,255,255,.12); }
#promoPopup.promo-gift .promo-x:active{ transform: scale(.96); }

/* أعلى النافذة */
#promoPopup.promo-gift .promo-top{
  display:flex;
  gap: 12px;
  align-items:flex-start;
  padding-top: 8px;
}

/* أيقونة تتحرك */
#promoPopup.promo-gift .promo-badge{
  width: 56px;
  height: 56px;
  border-radius: 18px;
  position: relative;
  background: rgba(255,255,255,.06);
  box-shadow: 0 14px 30px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.10);
  display:flex;
  align-items:center;
  justify-content:center;
  flex: 0 0 auto;
  animation: badgeFloat 2.8s ease-in-out infinite;
}
@keyframes badgeFloat{
  0%,100%{ transform: translateY(0); }
  50%{ transform: translateY(-4px); }
}
#promoPopup.promo-gift .promo-badge i{
  font-size: 22px;
  color: #d1fae5;
  filter: drop-shadow(0 10px 20px rgba(34,197,94,.35));
  animation: giftWiggle 1.8s ease-in-out infinite;
}
@keyframes giftWiggle{
  0%,100%{ transform: rotate(0deg) scale(1); }
  35%{ transform: rotate(-6deg) scale(1.02); }
  70%{ transform: rotate(6deg) scale(1.02); }
}

/* رنّج يدور حول الأيقونة */
#promoPopup.promo-gift .promo-ring{
  position:absolute;
  inset: -10px;
  border-radius: 24px;
  background: conic-gradient(from 0deg, rgba(34,197,94,.0), rgba(34,197,94,.55), rgba(14,165,233,.55), rgba(168,85,247,.55), rgba(34,197,94,.0));
  filter: blur(0.2px);
  opacity: .55;
  animation: ringSpin 2.4s linear infinite;
  -webkit-mask: radial-gradient(circle, transparent 55%, #000 56%);
          mask: radial-gradient(circle, transparent 55%, #000 56%);
}
@keyframes ringSpin{
  to{ transform: rotate(360deg); }
}

/* شرارات صغيرة */
#promoPopup.promo-gift .promo-spark{
  position:absolute;
  width: 7px; height: 7px;
  border-radius: 999px;
  background: rgba(255,255,255,.85);
  filter: blur(.2px);
  opacity: .0;
  animation: spark 1.9s ease-in-out infinite;
}
#promoPopup.promo-gift .promo-spark.s1{ top: 6px; right: 10px; animation-delay: .1s; }
#promoPopup.promo-gift .promo-spark.s2{ bottom: 8px; left: 10px; animation-delay: .6s; }
#promoPopup.promo-gift .promo-spark.s3{ top: 26px; left: 4px; animation-delay: 1.1s; }
@keyframes spark{
  0%{ transform: scale(.6); opacity: 0; }
  35%{ transform: scale(1.2); opacity: .9; }
  60%{ transform: scale(.8); opacity: .3; }
  100%{ transform: scale(.6); opacity: 0; }
}

/* النصوص */
#promoPopup.promo-gift .promo-kicker{
  font-size: 12px;
  color: #a7f3d0;
  letter-spacing: .3px;
  margin-bottom: 4px;
}
#promoPopup.promo-gift .promo-title{
  font-size: 20px;
  font-weight: 900;
  line-height: 1.35;
  color: #f8fafc;
  margin-bottom: 6px;
}
#promoPopup.promo-gift .promo-sub{
  font-size: 13px;
  line-height: 1.75;
  color: rgba(226,232,240,.86);
}

/* العداد */
#promoPopup.promo-gift .promo-countdown{
  margin-top: 10px;
  padding: 12px;
  border-radius: 18px;
  background: rgba(255,255,255,.06);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.08);
  display:flex;
  align-items:center;
  justify-content:center;
  gap: 8px;
}

#promoPopup.promo-gift .cd-box{
  width: 66px;
  border-radius: 16px;
  padding: 10px 8px 8px;
  background: rgba(0,0,0,.25);
  box-shadow: 0 14px 26px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.06);
  text-align:center;
}
#promoPopup.promo-gift .cd-sec{ box-shadow: 0 18px 32px rgba(14,165,233,.25), inset 0 0 0 1px rgba(255,255,255,.08); }

#promoPopup.promo-gift .cd-num{
  font-size: 22px;
  font-weight: 900;
  color: #ffffff;
  line-height: 1;
  transform-origin: 50% 60%;
}
#promoPopup.promo-gift .cd-num.tick{
  animation: digitTick .22s ease-out;
}
@keyframes digitTick{
  0%{ transform: translateY(0) scale(1); }
  45%{ transform: translateY(-2px) scale(1.06); }
  100%{ transform: translateY(0) scale(1); }
}

#promoPopup.promo-gift .cd-lbl{
  margin-top: 6px;
  font-size: 11px;
  color: rgba(226,232,240,.75);
}
#promoPopup.promo-gift .cd-sep{
  font-weight: 900;
  color: rgba(226,232,240,.45);
  transform: translateY(-2px);
}

/* الأزرار: أصغر + أنعم */
#promoPopup.promo-gift .promo-actions{
  margin-top: 10px;
  display:flex;
  gap: 10px;
}
#promoPopup.promo-gift .promo-btn{
  flex: 1;
  padding: 9px 10px;               /* ✅ أصغر */
  border-radius: 999px;
  border: 0;
  cursor: pointer;
  font-family: 'Cairo', sans-serif !important;
  font-weight: 900;
  font-size: 13px;                  /* ✅ أصغر */
  display:flex;
  align-items:center;
  justify-content:center;
  gap: 8px;
  transition: transform .18s ease, filter .18s ease;
}
#promoPopup.promo-gift .promo-btn:active{ transform: scale(.98); }

#promoPopup.promo-gift .promo-primary{
  color: #08101f;
  background: linear-gradient(135deg, #22c55e, #06b6d4);
  box-shadow: 0 14px 26px rgba(8,47,73,.55);
  position: relative;
  overflow: hidden;
}
#promoPopup.promo-gift .promo-primary::after{
  content:"";
  position:absolute;
  inset: 0;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,.22), transparent);
  transform: translateX(-120%);
  animation: btnSweep 2.9s ease-in-out infinite;
  pointer-events:none;
}
@keyframes btnSweep{
  0%{ transform: translateX(-120%); opacity: 0; }
  25%{ opacity: 1; }
  60%{ transform: translateX(120%); opacity: 0; }
  100%{ transform: translateX(120%); opacity: 0; }
}

#promoPopup.promo-gift .promo-primary:hover{ filter: brightness(1.05); }

#promoPopup.promo-gift .promo-ghost{
  color: #e5e7eb;
  background: rgba(255,255,255,.08);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.10);
}
#promoPopup.promo-gift .promo-ghost:hover{ filter: brightness(1.07); }

#promoPopup.promo-gift .promo-footnote{
  margin-top: 6px;
  font-size: 11px;
  color: rgba(148,163,184,.85);
  text-align: center;
}

@media (max-width: 480px){
  #promoPopup.promo-gift{ width: min(440px, 94vw) !important; }
  #promoPopup.promo-gift .cd-box{ width: 62px; }
  #promoPopup.promo-gift .promo-title{ font-size: 18px; }
}


/* ✅ FIX: خلي النافذة تثبت بالنص وما ترجع لفوك بعد الأنيميشن */
#promoPopup.promo-gift{
  top: 50% !important;
  left: 50% !important;

  /* هاي أهم سطرين */
  transform: translate(-50%, -50%) !important;
  animation-fill-mode: forwards !important;
}


/* ✅ Buttons أصغر وأنعم */
#promoPopup.promo-gift .promo-actions{
  justify-content: center;
  gap: 10px;
}

#promoPopup.promo-gift .promo-btn{
  flex: 0 0 auto !important;     /* لا يتمدد */
  padding: 8px 12px !important;  /* أصغر */
  font-size: 12px !important;    /* أصغر */
  border-radius: 14px !important;
  min-width: 135px;              /* حجم مرتب */
}

#promoPopup.promo-gift .promo-btn i{
  font-size: 13px !important;
}

@media (max-width: 480px){
  #promoPopup.promo-gift .promo-btn{ min-width: 120px; }
}

/* ===== FIX: popup اختفت بسبب visibility hidden ===== */
#promoPopup{
  visibility: visible !important;   /* ✅ مهم حتى ما تختفي */
}

/* ===== Mobile Smooth (works with popup.style.animation) ===== */
#promoPopup.promo-gift{
  /* خلي الرسم يصير ناعم بالموبايل */
  will-change: transform, opacity;
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;

  /* حالة البداية (قبل الأنيميشن) حتى ما يصير فلاش */
  transform: translate3d(-50%, -60%, 0) scale(.96);
  opacity: 0;
}

/* ✅ نعيد تعريف نفس الأنيميشن اللي كودك يناديه */
@keyframes promoPopIn{
  0%   { transform: translate3d(-50%, -60%, 0) scale(.96); opacity: 0; filter: blur(1px); }
  60%  { transform: translate3d(-50%, -52%, 0) scale(1.02); opacity: 1; filter: blur(0px); }
  100% { transform: translate3d(-50%, -50%, 0) scale(1); opacity: 1; }
}

@keyframes promoPopOut{
  0%   { transform: translate3d(-50%, -50%, 0) scale(1); opacity: 1; }
  100% { transform: translate3d(-50%, -60%, 0) scale(.96); opacity: 0; }
}



/* ===== FIX: popup اختفت بسبب visibility hidden ===== */
#promoPopup{
  visibility: visible !important;   /* ✅ مهم حتى ما تختفي */
}

/* ===== Mobile Smooth (works with popup.style.animation) ===== */
#promoPopup.promo-gift{
  /* خلي الرسم يصير ناعم بالموبايل */
  will-change: transform, opacity;
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;

  /* حالة البداية (قبل الأنيميشن) حتى ما يصير فلاش */
  transform: translate3d(-50%, -60%, 0) scale(.96);
  opacity: 0;
}

/* ✅ نعيد تعريف نفس الأنيميشن اللي كودك يناديه */
@keyframes promoPopIn{
  0%   { transform: translate3d(-50%, -60%, 0) scale(.96); opacity: 0; filter: blur(1px); }
  60%  { transform: translate3d(-50%, -52%, 0) scale(1.02); opacity: 1; filter: blur(0px); }
  100% { transform: translate3d(-50%, -50%, 0) scale(1); opacity: 1; }
}

@keyframes promoPopOut{
  0%   { transform: translate3d(-50%, -50%, 0) scale(1); opacity: 1; }
  100% { transform: translate3d(-50%, -60%, 0) scale(.96); opacity: 0; }
}

/* ================================
   PROMO FINAL FIX (MOBILE NO-FLICKER)
   - Hide X
   - Bigger "العرض لفترة محدودة"
   - Remove button effects
   - Kill iPhone/Safari blink
================================ */

/* 1) إخفاء الـ X (إذا ما حذفته من الـ HTML) */
#promoPopup .promo-x{ display:none !important; }

/* 2) تكبير "العرض لفترة محدودة" (عندك حالياً 12px) :contentReference[oaicite:2]{index=2} */
#promoPopup.promo-gift .promo-kicker{
  font-size: 16px !important;
  font-weight: 900 !important;
  letter-spacing: .2px !important;
}

/* 3) إلغاء تأثيرات الأزرار (عندك transition/active/hover + لمعان متحرك) :contentReference[oaicite:3]{index=3} :contentReference[oaicite:4]{index=4} */
#promoPopup.promo-gift .promo-btn{
  transition: none !important;
}

#promoPopup.promo-gift .promo-btn:active{
  transform: none !important;
}

#promoPopup.promo-gift .promo-primary:hover,
#promoPopup.promo-gift .promo-ghost:hover{
  filter: none !important;
}

/* يلغي اللمعة المتحركة على زر الدخول */
#promoPopup.promo-gift .promo-primary::after{
  content: none !important;
  display: none !important;
  animation: none !important;
}

/* إذا عندك زر closeBtn بمكان ثاني وتريد تلغي تأثيراته همين :contentReference[oaicite:5]{index=5} */
#promoPopup #closeBtn{
  transition: none !important;
  animation: none !important;
}
#promoPopup #closeBtn:hover,
#promoPopup #closeBtn:active{
  transform: none !important;
  filter: none !important;
}

/* 4) أهم جزء: حل الومضة بالموبايل
   السبب: backdrop-filter blur بالـ overlay وبالنافذة يسبب redraw قوي :contentReference[oaicite:6]{index=6} :contentReference[oaicite:7]{index=7} */
@media (max-width: 600px){

  /* طفي البلور بالموبايل */
  #overlay{
    -webkit-backdrop-filter: none !important;
    backdrop-filter: none !important;
  }
  #promoPopup{
    -webkit-backdrop-filter: none !important;
    backdrop-filter: none !important;
  }

  /* ثبّت الرندر وخلّيه طبقة مستقلة حتى ما “يرجف” ويا الخلفية */
  #promoPopup{
    will-change: transform, opacity !important;
    -webkit-backface-visibility: hidden !important;
    backface-visibility: hidden !important;
    transform: translate3d(-50%, -50%, 0) !important;
    contain: layout paint !important;
    isolation: isolate !important;
  }
}

/* 5) إذا الـ JS ينادي promoPopIn وكان بيه blur (filter) نلغيه حتى ما يسبب flicker :contentReference[oaicite:8]{index=8} */
@keyframes promoPopIn{
  0%   { transform: translate3d(-50%, -60%, 0) scale(.92); opacity: 0; }
  60%  { transform: translate3d(-50%, -52%, 0) scale(1.02); opacity: 1; }
  100% { transform: translate3d(-50%, -50%, 0) scale(1); opacity: 1; }
}


/* =========================
   NO-FLASH FIX (CSS ONLY)
   Paste at the VERY END
   ========================= */

/* 1) overlay: خلي الفتح يصير بسلاسة بدون ومضة */
#overlay{
  /* خلي الخلفية ثابتة وناعمة بدل blur */
  background: rgba(0,0,0,.55) !important;

  /* يمنع أول فريم يطلع مفاجئ */
  opacity: 0;

  /* أول ما يصير display:block من JS راح يبدي هذا الأنيميشن */
  animation: overlayFadeIn .18s ease-out forwards;

  /* تحسينات أداء */
  will-change: opacity;
  transform: translateZ(0);
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;

  /* أهم شي: شيل البلور اللي يسوي وميض */
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}

/* 2) popup: ثبّت مكانه وخلي الأنيميشن transform/opacity */
#promoPopup{
  top: 50% !important;
  left: 50% !important;

  /* أول ما ينفتح (display:flex) يبقى مخفي لحظة بدل الومضة */
  opacity: 0;

  /* تحسينات أداء */
  will-change: transform, opacity;
  transform: translate3d(-50%,-50%,0) scale(.98);
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
  contain: layout paint;
  isolation: isolate;

  /* شيل blur اللي يسبب ومضة */
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}

/* 3) إعادة تعريف نفس الأنيميشنات اللي الـ JS يناديها */
@keyframes promoPopIn{
  from{
    opacity: 0;
    transform: translate3d(-50%,-54%,0) scale(.98);
  }
  to{
    opacity: 1;
    transform: translate3d(-50%,-50%,0) scale(1);
  }
}

@keyframes promoPopOut{
  from{
    opacity: 1;
    transform: translate3d(-50%,-50%,0) scale(1);
  }
  to{
    opacity: 0;
    transform: translate3d(-50%,-46%,0) scale(.98);
  }
}

@keyframes overlayFadeIn{
  from{ opacity: 0; }
  to{ opacity: 1; }
}



/* =========================
   NO-FLICKER MOBILE MODE ✅
   (Popup + Overlay only)
   ========================= */
@media (max-width: 768px){

  /* 1) الغِ blur نهائياً (هو مصدر الوميض) */
  #overlay{
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    background: rgba(0,0,0,.68) !important; /* نفس الإحساس بدون blur */
  }

  #promoPopup{
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
  }

  /* 2) الغِ أي filter/blur داخل أنيميشن الدخول/الخروج (مصدر وميض قوي) */
  @keyframes promoPopIn{
    0%   { transform: translate3d(-50%, -60%, 0) scale(.96); opacity: 0; }
    60%  { transform: translate3d(-50%, -52%, 0) scale(1.01); opacity: 1; }
    100% { transform: translate3d(-50%, -50%, 0) scale(1); opacity: 1; }
  }
  @keyframes promoPopOut{
    0%   { transform: translate3d(-50%, -50%, 0) scale(1); opacity: 1; }
    100% { transform: translate3d(-50%, -60%, 0) scale(.96); opacity: 0; }
  }

  /* 3) امنع إعادة الرسم الثقيلة بسبب الحلقات/اللمعة المتحركة */
  #promoPopup.promo-gift::after{ content: none !important; } /* لمعان متحرك */
  #promoPopup .promo-ring,
  #promoPopup .promo-spark{ display: none !important; }      /* حلقات/شرارات */

  /* 4) خلّي حركة “خفيفة” فقط على الأيقونة (transform GPU) بدون أي مؤثرات ثقيلة */
  #promoPopup .promo-badge{ 
    animation: badgeFloatMobile 3.2s ease-in-out infinite !important;
    will-change: transform;
  }
  #promoPopup .promo-badge i{
    animation: none !important; /* نوقف wiggle إذا كان يسبب redraw */
  }
  @keyframes badgeFloatMobile{
    0%,100%{ transform: translate3d(0,0,0); }
    50%{ transform: translate3d(0,-4px,0); }
  }

  /* 5) أوقف لمعة زر الدخول المتحركة لأنها تسبب repaint ببعض الأجهزة */
  #promoPopup .promo-primary::after{ animation: none !important; }
}



/* =========================================================
   PROMO POPUP THEME (EDIT HERE)  ✅
                         نهاية البلووووووك   
   ========================================================= */


/* =========================
   ASSAL PRO COLORS ONLY
   Paste at END of <style>
   ========================= */

:root{
  --bg-0:#0b1220;
  --bg-1:#0e1a2f;
  --surface: rgba(255,255,255,.07);
  --surface-2: rgba(255,255,255,.10);
  --border: rgba(255,255,255,.14);

  --text:#e9eefc;
  --muted: rgba(233,238,252,.72);

  --primary:#46b3ff;
  --primary-2:#2dd4bf;
  --danger:#ff4d6d;
}

/* Base */
body{
  background:
    radial-gradient(900px 500px at 20% 10%, rgba(70,179,255,.20), transparent 55%),
    radial-gradient(900px 500px at 80% 0%, rgba(45,212,191,.16), transparent 55%),
    linear-gradient(160deg, var(--bg-1), var(--bg-0)) !important;
  color: var(--text) !important;
}

/* Header */
.header{
  background: rgba(8,12,22,.72) !important;
  border-bottom-color: rgba(255,255,255,.08) !important;
}

/* Header buttons */
.header-btn{
  background: linear-gradient(135deg, rgba(255,255,255,.10), rgba(255,255,255,.06)) !important;
  border-color: rgba(255,255,255,.10) !important;
  color: var(--text) !important;
}
.header-btn.refresh-btn{
  background: linear-gradient(135deg, rgba(70,179,255,.22), rgba(255,255,255,.06)) !important;
}
.header-btn.notes-btn{
  background: linear-gradient(135deg, rgba(45,212,191,.22), rgba(255,255,255,.06)) !important;
}
.header-btn.back-btn,
.header-btn.exit-btn{
  background: linear-gradient(135deg, rgba(255,77,109,.22), rgba(255,255,255,.06)) !important;
}

/* Main container */
.container{
  background: linear-gradient(135deg, rgba(255,255,255,.09), rgba(255,255,255,.04)) !important;
  border-color: rgba(255,255,255,.10) !important;
  color: var(--text) !important;
}

/* Category / New category buttons */
.category-btn, .new-category-btn, .tools-btn{
  background: rgba(255,255,255,.06) !important;
  border-color: rgba(255,255,255,.12) !important;
  color: var(--text) !important;
}
.category-btn:hover, .new-category-btn:hover, .tools-btn:hover{
  background: linear-gradient(135deg, rgba(70,179,255,.18), rgba(45,212,191,.14)) !important;
}
.category-btn:active, .new-category-btn:active, .tools-btn:active{
  background: linear-gradient(135deg, rgba(70,179,255,.18), rgba(45,212,191,.14)) !important;
}

/* Slider categories (round icons) */
.category{
  background: rgba(255,255,255,.06) !important;
  border-color: rgba(255,255,255,.12) !important;
  color: var(--text) !important;
}
.category:hover{
  background: linear-gradient(135deg, rgba(70,179,255,.14), rgba(45,212,191,.10)) !important;
}
.category.active{
  background: linear-gradient(135deg, rgba(70,179,255,.26), rgba(45,212,191,.20)) !important;
  border-color: rgba(70,179,255,.35) !important;
}

/* Search */
.search-container input{
  background: rgba(255,255,255,.06) !important;
  border-color: rgba(255,255,255,.14) !important;
  color: var(--text) !important;
}
.search-container input::placeholder{ color: rgba(233,238,252,.55) !important; }
.search-container input:focus{
  border-color: rgba(70,179,255,.45) !important;
}
.search-container button{
  background: linear-gradient(135deg, rgba(70,179,255,.85), rgba(45,212,191,.75)) !important;
  color: #0b1220 !important;
}

/* Result cards */
.result-card{
  background: linear-gradient(135deg, rgba(255,255,255,.08), rgba(255,255,255,.04)) !important;
  border-color: rgba(255,255,255,.10) !important;
  color: var(--text) !important;
}

/* New Items Modal */
#newItemsModal{
  background: linear-gradient(135deg, rgba(8,12,22,.90), rgba(12,20,36,.72)) !important;
  border-color: rgba(255,255,255,.10) !important;
  color: var(--text) !important;
}
#newItemsModal .close-modal-btn{
  background: linear-gradient(135deg, rgba(255,77,109,.85), rgba(255,77,109,.55)) !important;
  color: #fff !important;
}

/* Notes drawer */
.notes-drawer{
  background: rgba(8,12,22,.82) !important;
  border-left-color: rgba(255,255,255,.10) !important;
  color: var(--text) !important;
}

/* SweetAlert2 */
.swal2-popup{
  background: linear-gradient(135deg, rgba(8,12,22,.92), rgba(12,20,36,.78)) !important;
  border-color: rgba(255,255,255,.10) !important;
}
.swal2-title{ color: var(--text) !important; }
.swal2-html-container{ color: var(--muted) !important; }
.swal2-input{
  background: rgba(255,255,255,.06) !important;
  border-color: rgba(255,255,255,.14) !important;
  color: var(--text) !important;
}
.swal2-input:focus{ border-color: rgba(70,179,255,.45) !important; }
.swal2-confirm{
  background: linear-gradient(135deg, rgba(70,179,255,.85), rgba(45,212,191,.75)) !important;
  color: #0b1220 !important;
}
.swal2-cancel{
  background: linear-gradient(135deg, rgba(255,77,109,.85), rgba(255,77,109,.60)) !important;
  color: #fff !important;
}

/* Footer */
footer{
  background: rgba(8,12,22,.72) !important;
  border-top-color: rgba(255,255,255,.08) !important;
  color: var(--text) !important;
}

/* Scroll to top */
.scroll-to-top{
  background: linear-gradient(135deg, rgba(70,179,255,.85), rgba(45,212,191,.75)) !important;
  color: #0b1220 !important;
}


/* منع تحديد النص */
body, * {
  -webkit-user-select: none;
  user-select: none;
  -webkit-touch-callout: none; /* يمنع قائمة النسخ على iOS/بعض الويبفيو */
}

/* استثناء حقول الإدخال حتى تظل تشتغل طبيعي */
input, textarea, [contenteditable="true"] {
  -webkit-user-select: text;
  user-select: text;
}


/* زر التواصل بالهيدر */
.header-icon-btn.contact-btn{
  border: 1px solid rgba(255,255,255,0.14);
  background: radial-gradient(circle at top left, rgba(34,197,94,.35), rgba(15,23,42,.20));
  box-shadow: 0 10px 22px rgba(0,0,0,.35);
}
.header-icon-btn.contact-btn:hover{
  transform: translateY(-1px) scale(1.02);
}
.header-icon-btn.contact-btn:active{
  transform: scale(.96);
}

/* نافذة التواصل */
#contactModal{
  position: fixed;
  top: 70px;               /* تحت الهيدر */
  left: 50%;
  transform: translateX(-50%);
  width: min(560px, calc(100% - 20px));
  background:
    radial-gradient(circle at top left, rgba(34,197,94,.18), transparent 55%),
    radial-gradient(circle at bottom right, rgba(96,165,250,.14), transparent 60%),
    rgba(15,23,42,.94);
  border: 1px solid rgba(255,255,255,.12);
  border-radius: 18px;
  box-shadow: 0 28px 70px rgba(0,0,0,.75);
  padding: 16px;
  z-index: 10000;
  display: none;
  flex-direction: column;
  gap: 12px;
}

#contactModal .close-modal-btn{
  position: absolute;
  top: 10px;
  inset-inline-end: 10px;
  width: 34px;
  height: 34px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,.12);
  background: rgba(255,255,255,.06);
  color: #e5e7eb;
  cursor: pointer;
  box-shadow: 0 10px 24px rgba(0,0,0,.55);
  display: grid;
  place-items: center;
  transition: transform .18s ease, background .18s ease;
}
#contactModal .close-modal-btn:hover{
  transform: scale(1.06);
  background: linear-gradient(135deg, #ef4444, #b91c1c);
}
#contactModal .close-modal-btn:active{ transform: scale(.92); }

#contactModal .contact-head{
  display:flex;
  align-items:center;
  gap: 12px;
  padding-inline-end: 34px; /* حتى ما يتعارك ويا زر الإغلاق */
}
#contactModal .contact-ico{
  width: 44px;
  height: 44px;
  border-radius: 16px;
  display:grid;
  place-items:center;
  background: linear-gradient(135deg, rgba(34,197,94,.35), rgba(96,165,250,.18));
  border: 1px solid rgba(255,255,255,.12);
  color: #fff;
  box-shadow: 0 18px 40px rgba(0,0,0,.45);
}
#contactModal h2{
  margin:0;
  font-size: 20px;
  font-weight: 900;
  background: linear-gradient(135deg, #86efac, #60a5fa);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}
#contactModal .contact-sub{
  font-size: 12px;
  color: #cbd5e1;
  margin-top: 2px;
}

#contactModal .contact-card{
  display:flex;
  align-items:center;
  justify-content: space-between;
  gap: 10px;
  padding: 12px 12px;
  border-radius: 16px;
  text-decoration: none;
  background: rgba(17,24,39,.72);
  border: 1px solid rgba(55,65,81,.85);
  box-shadow: 0 14px 34px rgba(0,0,0,.45);
  transition: transform .18s ease, border-color .18s ease, box-shadow .18s ease;
}
#contactModal .contact-card:hover{
  transform: translateY(-1px);
  border-color: rgba(34,197,94,.55);
  box-shadow: 0 18px 44px rgba(0,0,0,.55);
}
#contactModal .contact-card:active{ transform: scale(.98); }

#contactModal .contact-label{
  color:#e5e7eb;
  font-weight: 900;
  font-size: 13px;
}
#contactModal .contact-num{
  color:#fff;
  font-weight: 800;
  letter-spacing: .02em;
  font-size: 16px;
  margin-top: 2px;
}
#contactModal .contact-note{
  color:#94a3b8;
  font-size: 12px;
  text-align: center;
}

.call-icon-btn{
  width: 40px;
  height: 40px;
  border-radius: 999px;
  display: grid;
  place-items: center;
  text-decoration: none;
  color: #fff;
  border: 1px solid rgba(255,255,255,.14);
  background: linear-gradient(135deg, rgba(34,197,94,.55), rgba(22,163,74,.25));
  box-shadow: 0 12px 28px rgba(0,0,0,.55);
  transition: transform .18s ease, filter .18s ease;
  flex: 0 0 auto;
}
.call-icon-btn:hover{
  transform: translateY(-1px) scale(1.05);
  filter: brightness(1.06);
}
.call-icon-btn:active{
  transform: scale(.95);
}

/* تباعد مرتب بين الكروت */
.branches-grid{
  display: flex;
  flex-direction: column;
  gap: 12px; /* التباعد اللي تريده */
}

/* كرت الفرع بشكل احترافي */
.branch-card{
  display:flex;
  align-items:center;
  justify-content: space-between;
  gap: 12px;
  padding: 14px 14px;
  border-radius: 18px;
  background:
    radial-gradient(circle at top left, rgba(34,197,94,.16), transparent 60%),
    radial-gradient(circle at bottom right, rgba(96,165,250,.12), transparent 65%),
    rgba(17,24,39,.70);
  border: 1px solid rgba(255,255,255,.10);
  box-shadow: 0 18px 44px rgba(0,0,0,.55);
  transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
}

.branch-card:hover{
  transform: translateY(-1px);
  border-color: rgba(34,197,94,.35);
  box-shadow: 0 22px 54px rgba(0,0,0,.65);
}

.branch-info{
  display:flex;
  flex-direction: column;
  gap: 4px;
  min-width: 0;
}

.branch-title{
  font-size: 12px;
  font-weight: 900;
  color: #cbd5e1;
  letter-spacing: .02em;
}

.branch-name{
  font-size: 15px;
  font-weight: 900;
  color: #ffffff;
  line-height: 1.25;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* رقم الهاتف بشكل كبسولة */
.branch-phone{
  display: inline-flex;
  align-items: center;
  width: fit-content;
  padding: 6px 10px;
  border-radius: 999px;
  font-weight: 900;
  font-size: 14px;
  color: #e5e7eb;
  background: rgba(255,255,255,.06);
  border: 1px solid rgba(255,255,255,.10);
  box-shadow: inset 0 0 0 1px rgba(0,0,0,.10);
}

/* نخلي زر الاتصال أوضح شوي داخل الكرت */
.branch-card .call-icon-btn{
  width: 42px;
  height: 42px;
  box-shadow: 0 14px 34px rgba(0,0,0,.60);
}

/* الغاء أي تأثير لمس/هوفر على كروت الفروع - فقط زر الاتصال */
.branch-card{
  cursor: default;
  -webkit-tap-highlight-color: transparent;
  user-select: none;
  touch-action: manipulation;
}

/* لا تحرّك ولا تلمّع الكرت عند hover/active */
.branch-card:hover,
.branch-card:active{
  transform: none !important;
  filter: none !important;
  box-shadow: inherit !important;
}

/* الغاء الهايلايت على نصوص داخل الكرت */
.branch-card .branch-info,
.branch-card .branch-title,
.branch-card .branch-name,
.branch-card .branch-phone{
  -webkit-tap-highlight-color: transparent;
  user-select: none;
}

/* زر الاتصال فقط هو القابل للضغط */
.call-icon-btn{
  -webkit-tap-highlight-color: transparent;
  outline: none;
}

/* امنع أي outline افتراضي */
.call-icon-btn:focus,
.call-icon-btn:focus-visible{
  outline: none;
}






    
/* =========================
   LUX ADS SYSTEM (Ahmed)
   - control by AD_CHOICE
   ========================= */
#adOverlay{
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.65);
  backdrop-filter: blur(14px);
  -webkit-backdrop-filter: blur(14px);
  z-index: 100000;
  display: none;
  opacity: 0;
  transition: opacity .25s ease;
}
#adModal{
  position: fixed;
  inset: 0;
  display: none;
  place-items: center;
  z-index: 100001;
  padding: 18px;
}
#adModal .ad-shell{
  width: min(720px, 100%);
  max-width: 100%;
  border-radius: 26px;
  overflow: hidden;
  color: #fff;
  box-shadow: 0 30px 80px rgba(0,0,0,75);
  transform: translateZ(0);
}

#adModal .ad-topbar{
  display:flex;
  align-items:center;
  justify-content: space-between;
  padding: 14px 16px;
  background: rgba(255,255,255,.06);
  border-bottom: 1px solid rgba(255,255,255,.10);
}
#adModal .ad-brand{
  display:flex; align-items:center; gap:10px;
  font-family:'Cairo',sans-serif;
  font-weight: 800;
  letter-spacing: .3px;
  font-size: clamp(14px, 2.8vw, 18px);
}
#adModal .ad-brand i{ opacity:.95; }
#adModal .ad-close{
  width: 40px; height: 40px;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,.18);
  background: rgba(0,0,0,.28);
  color:#fff;
  cursor:pointer;
  display:grid;
  place-items:center;
  transition: transform .18s ease, background .18s ease;
}
#adModal .ad-close:hover{ transform: scale(1.06); background: rgba(0,0,0,.38); }
#adModal .ad-close:active{ transform: scale(.96); }

#adModal .ad-body{
  padding: 18px 18px 16px;
  font-family:'Cairo',sans-serif;
  text-align: center;            /* توسيط النص */
}

#adModal .ad-body > *{
  margin-left: auto;
  margin-right: auto;            /* توسيط العناصر البلوكية */
}

#adModal .ad-actions{
  justify-content: center;        /* توسيط الازرار */
}

#adModal h3{
  font-size: clamp(22px, 5.4vw, 36px);
  line-height: 1.15;
  margin: 0 0 10px 0;
  letter-spacing: .2px;
}
#adModal p{
  margin: 0;
  font-size: clamp(14px, 3.7vw, 18px);
  color: rgba(255,255,255,.88);
  line-height: 1.75;
}
#adModal .ad-actions{
  display:flex;
  gap: 10px;
  flex-wrap: wrap;
  margin-top: 14px;
}
#adModal .ad-btn{
  border: 0;
  cursor: pointer;
  padding: 11px 14px;
  border-radius: 16px;
  font-family:'Cairo',sans-serif;
  font-weight: 800;
  font-size: clamp(13px, 3.2vw, 16px);
  display:flex; align-items:center; gap:10px;
  transition: transform .18s ease, filter .18s ease;
}
#adModal .ad-btn:hover{ transform: translateY(-1px) scale(1.02); filter: brightness(1.05); }
#adModal .ad-btn:active{ transform: translateY(0) scale(.98); }
#adModal .ad-btn.secondary{
  background: rgba(255,255,255,.10);
  color: #fff;
  border: 1px solid rgba(255,255,255,.14);
}
#adModal .ad-btn.primary{ color:#0b1220; }

/* shared animated sparkle */
@keyframes luxShine{
  0%{ transform: translateX(-35%) rotate(12deg); opacity:.0; }
  15%{ opacity:.45; }
  60%{ opacity:.35; }
  100%{ transform: translateX(35%) rotate(12deg); opacity:0; }
}
.ad-sheen{
  position: relative;
  overflow: hidden;
}
.ad-sheen::after{
  content:"";
  position:absolute;
  inset:-40% -60%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,.28), transparent);
  transform: translateX(-35%) rotate(12deg);
  animation: luxShine 2.8s ease-in-out infinite;
  pointer-events:none;
}

/* ===== Theme 1: Barca Super Cup (trophy + confetti) ===== */
.ad-theme-barca{
  background:
    radial-gradient(1200px 600px at 10% 0%, rgba(255, 204, 0, .20), transparent 55%),
    radial-gradient(900px 500px at 90% 20%, rgba(255, 0, 102, .18), transparent 60%),
    linear-gradient(135deg, rgba(12, 18, 40, .95), rgba(10, 12, 24, .96));
  border: 1px solid rgba(255,255,255,.12);
}
.ad-theme-barca .ad-topbar{ background: rgba(255, 0, 102, .10); }
.ad-theme-barca .ad-badge{
  display:inline-flex; align-items:center; gap:10px;
  padding: 8px 12px;
  border-radius: 999px;
  background: rgba(255,204,0,.14);
  border: 1px solid rgba(255,204,0,.28);
  margin-bottom: 12px;
}
.ad-theme-barca .ad-badge i{ color: #ffcc00; }
@keyframes trophyBounce{ 0%,100%{ transform: translateY(0) rotate(-6deg);} 50%{ transform: translateY(-6px) rotate(6deg);} }
.ad-theme-barca .trophy{
  margin-left:auto; margin-right:auto;
  display:inline-grid; place-items:center;
  width: 74px; height: 74px;
  border-radius: 24px;
  background: rgba(255,204,0,.12);
  border: 1px solid rgba(255,204,0,.30);
  box-shadow: 0 18px 40px rgba(0,0,0,.45);
  animation: trophyBounce 1.6s ease-in-out infinite;
}
.ad-theme-barca .trophy i{ font-size: 34px; color: #ffcc00; }
.ad-theme-barca .ad-btn.primary{ background: linear-gradient(135deg, #ffcc00, #ff0066); }

/* ===== Theme 2: Ramadan Greeting (crescent + lantern sway) ===== */
.ad-theme-ramadan{
  background:
    radial-gradient(1200px 700px at 10% 10%, rgba(34, 197, 94, .18), transparent 60%),
    radial-gradient(900px 500px at 90% 20%, rgba(245, 158, 11, .18), transparent 60%),
    linear-gradient(135deg, rgba(2, 6, 23, .96), rgba(10, 18, 34, .96));
  border: 1px solid rgba(255,255,255,.10);
}
.ad-theme-ramadan .ad-topbar{ background: rgba(245, 158, 11, .10); }
.ad-theme-ramadan .moon{
  display:flex; align-items:center; gap:10px;
  margin-bottom: 10px;
  justify-content:center;
}
.ad-theme-ramadan .moon i{ color:#fbbf24; font-size: 28px; }
@keyframes lanternSway{ 0%,100%{ transform: rotate(-6deg) translateY(0);} 50%{ transform: rotate(7deg) translateY(2px);} }
.ad-theme-ramadan .lantern{
  margin-left:auto; margin-right:auto;
  width: 68px; height: 68px;
  border-radius: 22px;
  display:grid; place-items:center;
  background: rgba(245,158,11,.14);
  border: 1px solid rgba(245,158,11,.30);
  box-shadow: 0 14px 35px rgba(0,0,0,.45);
  animation: lanternSway 2.2s ease-in-out infinite;
}
.ad-theme-ramadan .lantern i{ font-size: 30px; color:#fbbf24; }
.ad-theme-ramadan .ad-btn.primary{ background: linear-gradient(135deg, #22c55e, #f59e0b); }

/* ===== Theme 3: Hadith & Duas (quote carousel, calm glass) ===== */
.ad-theme-dua{
  background:
    radial-gradient(1000px 600px at 0% 30%, rgba(99, 102, 241, .18), transparent 55%),
    radial-gradient(900px 500px at 100% 0%, rgba(56, 189, 248, .14), transparent 55%),
    linear-gradient(135deg, rgba(15, 23, 42, .96), rgba(2, 6, 23, .96));
  border: 1px solid rgba(255,255,255,.10);
}
.ad-theme-dua .ad-topbar{ background: rgba(99, 102, 241, .10); }
.ad-theme-dua .quote-card{
  margin-top: 10px;
  padding: 14px 14px;
  border-radius: 22px;
  background: rgba(255,255,255,.07);
  border: 1px solid rgba(255,255,255,.12);
}
.ad-theme-dua .quote-row{
  display:flex; align-items:flex-start; gap:12px;
}
.ad-theme-dua .quote-ico{
  width: 44px; height: 44px;
  border-radius: 16px;
  display:grid; place-items:center;
  background: rgba(99,102,241,.16);
  border: 1px solid rgba(99,102,241,.30);
}
.ad-theme-dua .quote-ico i{ color:#a5b4fc; }
.ad-theme-dua .quote-text{
  font-size: clamp(14px, 3.8vw, 18px);
  line-height: 1.85;
  color: rgba(255,255,255,.92);
}
.ad-theme-dua .quote-meta{
  margin-top: 8px;
  font-size: 12px;
  opacity: .75;
}
.ad-theme-dua .nav{
  display:flex; gap:10px; margin-top: 12px; flex-wrap:wrap;
  justify-content:center;
}
.ad-theme-dua .nav button{
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.08);
  color:#fff;
  border-radius: 14px;
  padding: 9px 12px;
  cursor:pointer;
  font-family:'Cairo',sans-serif;
  font-weight: 800;
  transition: transform .18s ease;
}
.ad-theme-dua .nav button:hover{ transform: scale(1.03); }
.ad-theme-dua .ad-btn.primary{ background: linear-gradient(135deg, #60a5fa, #a78bfa); color:#08101f; }

/* ===== Theme 4: Eid Al-Fitr (fireworks) ===== */
.ad-theme-eid{
  background:
    radial-gradient(1200px 700px at 15% 10%, rgba(236, 72, 153, .18), transparent 55%),
    radial-gradient(900px 500px at 90% 20%, rgba(34, 197, 94, .16), transparent 60%),
    linear-gradient(135deg, rgba(4, 6, 28, .96), rgba(12, 14, 40, .96));
  border: 1px solid rgba(255,255,255,.10);
}
.ad-theme-eid .ad-topbar{ background: rgba(236, 72, 153, .10); }
@keyframes popFire{ 0%{ transform: scale(.92); filter: blur(.2px);} 50%{ transform: scale(1.03);} 100%{ transform: scale(.98);} }
.ad-theme-eid .fire{
  margin-left:auto; margin-right:auto;
  display:flex; gap:10px; flex-wrap:wrap; align-items:center;
  margin-bottom: 10px;
}
.ad-theme-eid .fire span{
  display:inline-flex; align-items:center; gap:8px;
  padding: 8px 12px;
  border-radius: 999px;
  background: rgba(236,72,153,.14);
  border: 1px solid rgba(236,72,153,.28);
  animation: popFire 1.8s ease-in-out infinite;
}
.ad-theme-eid .fire i{ color:#fb7185; }
.ad-theme-eid .ad-btn.primary{ background: linear-gradient(135deg, #fb7185, #22c55e); color:#0b1220; }

/* ===== Theme 5: Discounts (neon tag + grid) ===== */
.ad-theme-discount{
  background:
    radial-gradient(1200px 700px at 0% 0%, rgba(16, 185, 129, .18), transparent 55%),
    radial-gradient(900px 500px at 100% 0%, rgba(59, 130, 246, .16), transparent 60%),
    linear-gradient(135deg, rgba(0, 0, 0, .90), rgba(12, 18, 32, .96));
  border: 1px solid rgba(255,255,255,.10);
}
.ad-theme-discount .ad-topbar{ background: rgba(16, 185, 129, .12); }
.ad-theme-discount .deal-grid{
  display:grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 10px;
  margin-top: 12px;
  justify-items:center;
}
@media (min-width: 640px){
  .ad-theme-discount .deal-grid{ grid-template-columns: repeat(3, minmax(0,1fr)); }
}
.ad-theme-discount .deal{
  border-radius: 18px;
  padding: 10px 10px;
  background: rgba(255,255,255,.06);
  border: 1px solid rgba(255,255,255,.12);
  display:flex; gap:10px; align-items:center;
  justify-content:center;
  text-align:center;
}
.ad-theme-discount .deal i{ color: #34d399; }
.ad-theme-discount .deal div{ text-align:center; }
.ad-theme-discount .deal b{ display:block; font-size: 13px; }
.ad-theme-discount .deal small{ display:block; opacity:.78; font-size: 11px; margin-top: 2px; }
.ad-theme-discount .ad-btn.primary{ background: linear-gradient(135deg, #34d399, #60a5fa); color:#06121f; }

/* Reduce motion respect */
@media (prefers-reduced-motion: reduce){
  #adModal *{ animation: none !important; transition: none !important; }
}

/* ✅ خلي أزرار الإعلان نفس ستايل أزرار الصفحة (خصوصاً موبايل) */
#adModal .ad-btn{
  position: relative;
  border-radius: 25px;                 /* نفس .category-btn */
  overflow: hidden;                    /* يمنع أي تأثير يطلع برا الزر */
  clip-path: inset(0 0 0 0 round 25px);

  -webkit-tap-highlight-color: transparent !important;
  outline: none !important;
  -webkit-appearance: none;
  appearance: none;

  box-shadow: 0 4px 10px rgba(0,0,0,.2); /* نفس إحساس الصفحة */
  transition: all .3s ease;
}

/* نفس hover مال الصفحة */
#adModal .ad-btn:hover{
  transform: scale(1.1);
}

/* نفس active مال الصفحة */
#adModal .ad-btn:active{
  transform: scale(0.95);
  box-shadow: inset 0 2px 5px rgba(0,0,0,.3);
  clip-path: inset(0 0 0 0 round 25px); /* تأكيد القص عند الضغط */
}

/* ✅ مهم للموبايل: امنع hover يثبت بعد اللمس */
@media (hover: none), (pointer: coarse){
  #adModal .ad-btn:hover{ transform: none; }
}

/* ✅ زر X نفس ستايل أزرار الصفحة */
#adModal .ad-close{
  border-radius: 25px !important;      /* نفس .category-btn */
  overflow: hidden;
  clip-path: inset(0 0 0 0 round 25px);

  -webkit-tap-highlight-color: transparent !important;
  outline: none !important;
  -webkit-appearance: none;
  appearance: none;

  box-shadow: 0 4px 10px rgba(0,0,0,.2);
  transition: all .3s ease;
}

/* نفس hover مال الصفحة */
#adModal .ad-close:hover{
  transform: scale(1.1);
}

/* نفس active مال الصفحة */
#adModal .ad-close:active{
  transform: scale(0.95);
  box-shadow: inset 0 2px 5px rgba(0,0,0,.3);
  clip-path: inset(0 0 0 0 round 25px);
}

/* ✅ للموبايل: امنع hover يثبت بعد اللمس */
@media (hover: none), (pointer: coarse){
  #adModal .ad-close:hover{ transform: none; }
}


/* ===== Theme 6: Paid Ads (Aurora / Candy - eye catching) ===== */
.ad-theme-paid{
  position: relative;
  background:
    radial-gradient(900px 520px at 12% 10%, rgba(255, 204, 0, .28), transparent 55%),
    radial-gradient(900px 520px at 92% 18%, rgba(255, 0, 102, .22), transparent 55%),
    radial-gradient(900px 520px at 55% 105%, rgba(67, 206, 162, .22), transparent 55%),
    linear-gradient(135deg, rgba(12, 18, 40, .92), rgba(16, 24, 48, .90));
  border: 1px solid rgba(255,255,255,.14);
  overflow: hidden;
}

/* فقاعات/لمعة متحركة بالخلفية */
.ad-theme-paid::before{
  content:"";
  position:absolute;
  inset:-40%;
  background:
    radial-gradient(circle at 20% 30%, rgba(255,255,255,.18), transparent 35%),
    radial-gradient(circle at 80% 25%, rgba(255,255,255,.12), transparent 32%),
    radial-gradient(circle at 60% 80%, rgba(255,255,255,.10), transparent 40%);
  filter: blur(2px);
  opacity: .55;
  animation: paidBG 8s ease-in-out infinite;
  pointer-events:none;
}
@keyframes paidBG{
  0%,100%{ transform: translate3d(0,0,0) scale(1); }
  50%{ transform: translate3d(3%, -2%, 0) scale(1.03); }
}

.ad-theme-paid .ad-topbar{
  background: rgba(255,255,255,.10);
  border-bottom: 1px solid rgba(255,255,255,.12);
}

/* ✅ توسيط “حقيقي” للكل */
.ad-theme-paid .paid-stage{
  position: relative;
  width: 100%;
  text-align: center;
  display:flex;
  flex-direction: column;
  align-items:center;
  gap: 12px;
}
.ad-theme-paid .paid-stage > *{
  margin-left:auto;
  margin-right:auto;
}

.ad-theme-paid .paid-kicker{
  display:inline-flex;
  align-items:center;
  gap: 10px;
  padding: 8px 14px;
  border-radius: 999px;
  background: rgba(255,255,255,.12);
  border: 1px solid rgba(255,255,255,.18);
  font-weight: 1000;
  font-size: 12px;
  letter-spacing: .2px;
}

/* أيقونات متحركة (٣ أيقونات تطير) */
.ad-theme-paid .paid-icons{
  display:flex;
  gap: 10px;
  justify-content:center;
  flex-wrap: wrap;
  margin-top: 4px;
}
@keyframes paidFloat{
  0%,100%{ transform: translateY(0) rotate(-2deg); }
  50%{ transform: translateY(-7px) rotate(2deg); }
}
@keyframes paidWiggle{
  0%,100%{ transform: rotate(-6deg); }
  50%{ transform: rotate(7deg); }
}

.ad-theme-paid .paid-ico{
  width: 62px;
  height: 62px;
  border-radius: 22px;
  display:grid;
  place-items:center;
  background: rgba(255,255,255,.12);
  border: 1px solid rgba(255,255,255,.18);
  box-shadow: 0 18px 45px rgba(0,0,0,.40);
  position: relative;
  overflow:hidden;
}
.ad-theme-paid .paid-ico::after{
  content:"";
  position:absolute;
  inset:-35% -55%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,.35), transparent);
  transform: translateX(-35%) rotate(12deg);
  animation: paidShine 2.6s ease-in-out infinite;
  opacity: .7;
}
@keyframes paidShine{
  0%{ transform: translateX(-45%) rotate(12deg); opacity:0; }
  15%{ opacity:.55; }
  100%{ transform: translateX(45%) rotate(12deg); opacity:0; }
}

.ad-theme-paid .paid-ico i{
  font-size: 26px;
  color: rgba(255,255,255,.96);
  position: relative;
  z-index: 1;
  animation: paidFloat 2.6s ease-in-out infinite;
}
.ad-theme-paid .paid-ico.i2 i{ animation-duration: 2.9s; }
.ad-theme-paid .paid-ico.i3 i{ animation: paidFloat 2.3s ease-in-out infinite, paidWiggle 1.7s ease-in-out infinite; }

/* سطور/مقاييس بشكل “بهرجة محترمة” */
.ad-theme-paid .paid-metrics{
  width: 100%;
  display:flex;
  justify-content:center;
  flex-wrap: wrap;
  gap: 10px;
}
.ad-theme-paid .pill{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap: 8px;
  padding: 9px 13px;
  border-radius: 999px;
  background: rgba(255,255,255,.12);
  border: 1px solid rgba(255,255,255,.18);
  font-weight: 1000;
  font-size: 12px;
}

/* كروت الأنواع (مرتبة + وسط) */
.ad-theme-paid .paid-cards{
  width: 100%;
  max-width: 660px;
  display:grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 10px;
}
@media (max-width: 560px){
  .ad-theme-paid .paid-cards{ grid-template-columns: 1fr; }
}
.ad-theme-paid .paid-card{
  background: rgba(255,255,255,.12);
  border: 1px solid rgba(255,255,255,.18);
  border-radius: 18px;
  padding: 12px;
  display:flex;
  align-items:center;
  justify-content:center;
  gap: 10px;
  text-align:center;
  transition: transform .18s ease, filter .18s ease;
}
.ad-theme-paid .paid-card:hover{ transform: translateY(-2px) scale(1.02); filter: brightness(1.05); }

.ad-theme-paid .paid-card .ico{
  width: 40px;
  height: 40px;
  border-radius: 16px;
  display:grid;
  place-items:center;
  background: rgba(255, 204, 0, .16);
  border: 1px solid rgba(255, 204, 0, .28);
}
.ad-theme-paid .paid-card b{ display:block; font-size: 13px; font-weight: 1000; }
.ad-theme-paid .paid-card small{ display:block; margin-top: 2px; font-size: 11px; opacity:.78; }

.ad-theme-paid .paid-note{
  max-width: 560px;
  font-size: 11px;
  opacity: .78;
}

/* CTA يصيح بس “راقي” */
.ad-theme-paid .ad-btn.primary{
  background: linear-gradient(135deg, #ffcc00, #ff0066);
  color:#0b1220;
}


</style>
</head>
<body>
  

<button id="scrollToTopBtn" class="scroll-to-top"><i class="fas fa-arrow-up"></i></button>

<!-- دائرة عائمة للعناصر الجديدة -->
<div id="newItemsFloatingBtn" class="floating-new-btn">
    <span>جديد</span>
    <div class="new-items-count"></div>
</div>

<!-- النافذة المنبثقة للعناصر الجديدة -->
<div id="newItemsModal">
    <button class="close-modal-btn" onclick="closeNewItemsModal()"><i class="fas fa-times"></i></button>
    <h2>العناصر الجديدة</h2>
    <div class="modal-content"></div>
</div>

<!-- نافذة العروض -->
<div id="offersModal" dir="rtl">
    <button class="close-modal-btn" onclick="closeOffersModal()"><i class="fas fa-times"></i></button>

    <div class="offers-head">
        <h2>العروض الجديدة</h2>
        <div class="offers-chip" id="offersCountChip">0 عرض</div>
    </div>

    <div class="offers-toolbar">
        <i class="fas fa-search"></i>
        <input id="offersSearchInput" type="text" placeholder="ابحث داخل العروض...">
    </div>

    <div class="offers-content"></div>
</div>


<!-- نافذة التواصل -->
<div id="contactModal" dir="rtl" aria-hidden="true">
  <button class="close-modal-btn" onclick="closeContactModal()" aria-label="إغلاق">
    <i class="fas fa-times"></i>
  </button>

  <div class="contact-head">
    <div class="contact-ico"><i class="fab fa-whatsapp"></i></div>
    <div class="contact-head-text">
      <h2>تواصل ويانه</h2>
      <div class="contact-sub">اتصال مباشر</div>
    </div>
  </div>

 <div class="contact-body branches-grid">

  <div class="contact-card branch-card">
    <div class="contact-card-left branch-info">
      <div class="branch-title">الفرع الأول</div>
      <div class="branch-name">مكتب عسل الفرع الرئيسي</div>
      <div class="branch-phone">07728640560</div>
    </div>
    <a class="call-icon-btn" href="tel:07728640560" aria-label="اتصال الفرع الرئيسي">
      <i class="fas fa-phone"></i>
    </a>
  </div>

  <div class="contact-card branch-card">
    <div class="contact-card-left branch-info">
      <div class="branch-title">الفرع الثاني</div>
      <div class="branch-name">مكتب عسل فرع حي المعلمين</div>
      <div class="branch-phone">07711107595</div>
    </div>
    <a class="call-icon-btn" href="tel:07711107595" aria-label="اتصال فرع حي المعلمين">
      <i class="fas fa-phone"></i>
    </a>
  </div>

  <div class="contact-card branch-card">
    <div class="contact-card-left branch-info">
      <div class="branch-title">الفرع الثالث</div>
      <div class="branch-name">مكتب عسل فرع التحرير</div>
      <div class="branch-phone">07730080731</div>
    </div>
    <a class="call-icon-btn" href="tel:07730080731" aria-label="اتصال فرع التحرير">
      <i class="fas fa-phone"></i>
    </a>
  </div>

  <div class="contact-card branch-card">
    <div class="contact-card-left branch-info">
      <div class="branch-title">الفرع الرابع</div>
      <div class="branch-name">مكتب عسل فرع بلدروز</div>
      <div class="branch-phone">07755206020</div>
    </div>
    <a class="call-icon-btn" href="tel:07755206020" aria-label="اتصال فرع بلدروز">
      <i class="fas fa-phone"></i>
    </a>
  </div>

  <div class="contact-note">اضغط على أيقونة الاتصال حتى يتصل</div>
</div>


</div>




 
 <header class="header">
    <div class="header-title">مكتب عسل</div>
   
   
   <div class="header-buttons">
  <button class="header-btn header-icon-btn refresh-btn" onclick="refreshData()" title="تحديث البيانات" aria-label="تحديث البيانات">
    <i class="fas fa-arrows-rotate"></i>
  </button>

  <button class="header-btn header-icon-btn exit-btn" onclick="confirmExit()" title="خروج" aria-label="خروج">
    <i class="fas fa-right-from-bracket"></i>
  </button>

  <button class="header-btn header-icon-btn offers-btn" onclick="openOffersModal()" title="عروض" aria-label="عروض">
    <i class="fas fa-tags"></i>
  </button>

  <!-- السلة تبقى مثل ما هي -->
  <button class="header-btn header-cart-btn" id="openCartBtn" type="button" title="سلة المبيعات">
    <i class="fas fa-shopping-cart"></i>
    <span class="header-cart-badge" id="cartCount">0</span>
  </button>
  
 <button class="header-btn header-icon-btn contact-btn"
        onclick="openContactModal()"
        title="اتصل بينا"
        aria-label="اتصل بينا">
  <i class="fas fa-phone"></i>
</button>

  
</div>

   
   
</header>
 
<!-- يبقى الـ overlay مثل ما هو -->
<div id="overlay"></div>

<!-- ===== LUX ADS SYSTEM ===== -->
<div id="adOverlay" aria-hidden="true"></div>

<div id="adModal" role="dialog" aria-modal="true" aria-label="إعلان" tabindex="-1">
  <div class="ad-shell ad-sheen">
    <div class="ad-topbar">
      <div class="ad-brand"><i class="fa-solid fa-bolt"></i> إعلانات مكتب عسل</div>
      <button class="ad-close" type="button" aria-label="إغلاق الإعلان"><i class="fas fa-xmark"></i></button>
    </div>
    <div class="ad-body">
      <!-- injected -->
    </div>
  </div>
</div>
<!-- ===== /LUX ADS SYSTEM ===== -->



<!-- إعلان هدية التوافقات -->
<div id="promoPopup" class="alert-shell alert-event promo-gift" dir="rtl">
  <button class="promo-x" type="button" aria-label="إغلاق" onclick="closePopup()">
    <i class="fas fa-xmark"></i>
  </button>

  <div class="promo-top">
    <div class="promo-badge" aria-hidden="true">
      <span class="promo-ring"></span>
      <span class="promo-spark s1"></span>
      <span class="promo-spark s2"></span>
      <span class="promo-spark s3"></span>
      <i class="fas fa-gift"></i>
    </div>

    <div class="promo-head">
      <div class="promo-kicker">🎉 مفاجأة اليوم</div>
      <div class="promo-title">فتحنالك ميزة التوافقات مجاناً</div>
      <div class="promo-sub">
        لمدة <b>يومين</b> تگدر تستخدمها بالكامل… باقي على انتهاء الهدية:
      </div>
    </div>
  </div>

  <!-- Countdown -->
  <div class="promo-countdown" aria-label="الوقت المتبقي للهدية">
    <div class="cd-box">
      <div id="promoDays" class="cd-num">00</div>
      <div class="cd-lbl">يوم</div>
    </div>
    <div class="cd-sep">:</div>
    <div class="cd-box">
      <div id="promoHours" class="cd-num">00</div>
      <div class="cd-lbl">ساعة</div>
    </div>
    <div class="cd-sep">:</div>
    <div class="cd-box">
      <div id="promoMins" class="cd-num">00</div>
      <div class="cd-lbl">دقيقة</div>
    </div>
    <div class="cd-sep">:</div>
    <div class="cd-box cd-sec">
      <div id="promoSecs" class="cd-num">00</div>
      <div class="cd-lbl">ثانية</div>
    </div>
  </div>

  <div class="promo-actions">
    <button class="promo-btn promo-primary" type="button" onclick="goToSimilaritesFromPromo()">
      <i class="fas fa-arrow-up-right-from-square"></i>
      دخول التوافقات
    </button>

    <button class="promo-btn promo-ghost" type="button" onclick="closePopup()">
      إغلاق
    </button>
  </div>

  <div class="promo-footnote">
    * العرض محدود… لا يفوتك.
  </div>
</div>





    <div class="container">
      
      
      
    <!-- شعار دائري -->
   <div class="notification-container">
    <div class="logo-container" id="logo"> 
     <img src="images/logo.png" alt="Logo">
    </div>
    <div class="notification" id="notification">
        <div class="notification-text" id="notification-text"></div>
    </div>
</div>
    


<!-- شريط الأخبار -->
<div class="news-bar">
    <div class="breaking-news">🔥 تقنيات</div>
    <div class="news-ticker-container">
        <div class="news-ticker" id="newsTicker">جاري تحميل الأخبار...</div>
    </div>
</div>


        

      <div class="categories">
    <!-- زر أسعار بنمط الكروب -->
     <button class="new-category-btn" onclick="openLCDPage()"><i class="fas fa-list"></i> أسعار بنمط الكروب</button>
          <button class="category-btn tools-btn" onclick="openToolsPage()"><i class="fas fa-shopping-cart"></i> متجر عسل </button>
      <button class="category-btn" onclick="openSimilaritesPage()"><i class="fas fa-sync"></i> توافقات قطع الغيار  </button>
           <div class="slider-container">
    <button class="slider-btn prev-btn"><i class="fas fa-chevron-left"></i></button>
    <div class="slider" id="slider">
        <div class="category" onclick="filterCategory('LCD')">
            <i class="fas fa-tv"></i>
            <span>شاشات</span>
        </div>
        <div class="category" onclick="filterCategory('BATTERY')">
            <i class="fas fa-battery-full"></i>
            <span>بطاريات</span>
        </div>
        <div class="category" onclick="filterCategory('HOUSING')">
            <i class="fas fa-mobile-alt"></i>
            <span>شواصي</span>
        </div>
        <div class="category" onclick="filterCategory('BACK')">
            <i class="fas fa-tablet-alt"></i>
            <span>اظهر</span>
        </div>
        <div class="category" onclick="filterCategory('CAMERA')">
            <i class="fas fa-camera"></i>
            <span>كاميرا</span>
        </div>
        <div class="category" onclick="filterCategory('CHARGING')">
            <i class="fas fa-plug"></i>
            <span>شحن</span>
        </div>
        <div class="category" onclick="filterCategory('BUZZER')">
            <i class="fas fa-bell"></i>
            <span>جرس</span>
        </div>
        


        <div class="category" onclick="filterCategory('FINGER')">
    <i class="fas fa-fingerprint"></i>
    <span>بصمة</span>
</div>



<div class="category" onclick="filterCategory('FLAT LCD')">
    <i class="fas fa-film"></i>
    <span>ش. شاشة</span>
</div>



<div class="category" onclick="filterCategory('POWER')">
    <i class="fas fa-power-off"></i>
    <span>ف. بور</span>
</div>


<div class="category" onclick="filterCategory('LENS')">
    <i class="fas fa-bullseye"></i>
    <span>عدسة</span>
</div>


<div class="category" onclick="filterCategory('VOLUME')">
    <i class="fas fa-sliders-h"></i>
    <span>ف. صوت</span>
</div>


<div class="category" onclick="filterCategory('SPEAKER')">
            <i class="fas fa-volume-up"></i>
            <span>سماعة</span>
        </div>


<div class="category" onclick="filterCategory('FLAT SPEAKER')">
    <i class="fas fa-phone-alt"></i>
    <span>ف. سماعة</span>
</div>

<div class="category" onclick="filterCategory('HOLLDER')">
  <i class="fas fa-sim-card"></i>
  <span>هولدر سيم</span>
</div>

<div class="category" onclick="filterCategory('IC')">
  <i class="fas fa-microchip"></i>
  <span>IC</span>
</div>

<div class="category" onclick="filterCategory('CC')">
  <i class="fas fa-bolt"></i>
  <span>قاعدة شحن</span>
</div>

<div class="category" onclick="filterCategory('VIBRATION')">
  <i class="fa-solid fa-wave-square"></i>
  <span>هزاز</span>
</div>


    </div>
    <button class="slider-btn next-btn"><i class="fas fa-chevron-right"></i></button>
</div>

</div>

        <div class="search-container">
    <button id="adminCompatBtn" class="admin-compat-btn" type="button" onclick="searchCompatibilitiesAdmin()" title="توافقات (كادر عسل فقط)" disabled>
        <i class="fas fa-sync"></i>
    </button>
    <input type="text" id="searchInput" placeholder="Search for items...">
    <button id="clearBtn" class="clear-btn" onclick="clearSearch()" style="display: none;"><i class="fas fa-times"></i></button>
    <button id="searchBtn" onclick="searchItems()"><i class="fas fa-search"></i></button>
</div>


        <div id="results" class="results"></div>

</div>



<div id="cartModal" class="cart-modal" aria-hidden="true">
  <div class="cart-shell">
    <div class="cart-top">
      <div class="cart-title">
        <div class="cart-ico"><i class="fas fa-receipt"></i></div>
        <div>
          <div class="cart-h1">سلة المبيعات</div>
          <div class="cart-h2" id="cartSubtitle">0 عنصر</div>
        </div>
      </div>

      <button class="cart-x" id="closeCartBtn" type="button" title="إغلاق">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <div class="cart-body" id="cartItems"></div>

    <div class="cart-bottom">
      <div class="cart-sum">
        <div class="sum-row"><span>المجموع</span><strong id="cartSubtotal">0 د.ع</strong></div>
        <div class="sum-row">
          <span>خصم</span>
          <div class="sum-disc">
            <input id="cartDiscount" type="number" min="0" step="250" value="0" />
            <span>د.ع</span>
          </div>
        </div>
        <div class="sum-row sum-grand"><span>الإجمالي</span><strong id="cartTotal">0 د.ع</strong></div>
      </div>

      <div class="cart-actions">
        <button class="cart-btn ghost" id="clearCartBtn" type="button"><i class="fas fa-trash"></i> تفريغ</button>
        <button class="cart-btn ghost" id="printImgBtn" type="button"><i class="fas fa-image"></i> Image</button>
        <button class="cart-btn primary" id="printPdfBtn" type="button"><i class="fas fa-file-pdf"></i> PDF</button>
      </div>
    </div>
  </div>
</div>

<div id="invoiceTemplate" class="invoice-paper" style="display:none;"></div>





<footer>
    <p>&copy; 2025 Assal Office. All rights reserved.</p>
</footer>



    <script>
// ================== صلاحية كادر مكتب عسل (أدمن) ==================
// ⚠️ غيّر كلمة الأدمن هنا (لا تخليها نفس 112233)
const ADMIN_PASSWORD = "778899"; 
const ADMIN_FLAG_KEY = "isAdmin";

// ملف التوافقات (Google Sheet)
const dropboxSimilaritesFile = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRRZZFGe3dDXCCb9L5HtgpnXoj-H6kvqWeMS_tvYyWAL2VqpJh64rCMqRpoTaMw3v9fdazd5fWB5E2d/pub?output=xlsx" + "&t=" + new Date().getTime();

let compatDatabase = [];
let compatLoaded = false;

function isAdminUser() {
    return localStorage.getItem(ADMIN_FLAG_KEY) === "true";
}

function setAdminUser(isAdmin) {
    if (isAdmin) localStorage.setItem(ADMIN_FLAG_KEY, "true");
    else localStorage.removeItem(ADMIN_FLAG_KEY);
    updateAdminCompatBtn();
}

function updateAdminCompatBtn() {
    const btn = document.getElementById("adminCompatBtn");
    if (!btn) return;
    const ok = isAdminUser();
    btn.disabled = !ok;
    btn.classList.toggle("is-disabled", !ok);
    btn.title = ok ? "بحث التوافقات" : "هذه الخاصية حصرا لكادر مكتب عسل";
}

function showStaffOnlyPopup() {
    showExitLikeAlert({
        icon: "fas fa-user-lock",
        title: "وصول محدود",
        message: "هذه الخاصية حصرا لكادر مكتب عسل",
        confirmText: "موافق"
    });
}

function openSimilaritesPage() {
  
    window.location.href = "similarites.html";
}

document.addEventListener("DOMContentLoaded", updateAdminCompatBtn);
// ================================================================

      




// دالة للتحكم في ظهور/إخفاء زر المسح
function toggleClearButton() {
    const searchInput = document.getElementById("searchInput");
    const clearBtn = document.getElementById("clearBtn");
    
    if (searchInput.value.trim().length > 0) {
        clearBtn.style.display = "flex"; // إظهار الزر عند الكتابة
    } else {
        clearBtn.style.display = "none"; // إخفاء الزر إذا الحقل فارغ
    }
}

// دالة لمسح حقل البحث
function clearSearch() {
    const searchInput = document.getElementById("searchInput");
    const resultsContainer = document.getElementById("results");
    
    searchInput.value = ""; // تفريغ الحقل
    resultsContainer.style.display = "none"; // إخفاء النتائج
    toggleClearButton(); // تحديث حالة زر المسح
    toggleScrollToTopButton(); // تحديث زر الرجوع لأعلى
}

// ربط حدث الكتابة بحقل البحث
document.getElementById("searchInput").addEventListener("input", toggleClearButton);

// التأكد من حالة الزر عند تحميل الصفحة
document.addEventListener("DOMContentLoaded", toggleClearButton);
      

// جعل الدائرة قابلة للسحب
const floatingBtn = document.getElementById("newItemsFloatingBtn");
let isDragging = false;
let isDraggingInitiated = false; // متغير لتتبع ما إذا حدث سحب
let baseX, baseY; // الموقع الأساسي عند بدء السحب
let startX, startY;
const dragThreshold = 5; // عتبة الحركة (بالبكسل)
let touchStartTime; // لتتبع وقت بدء اللمس


// إعداد الموقع الأولي بناءً على `left` و`bottom`

floatingBtn.style.left = "20px";
floatingBtn.style.bottom = "50px";


// تحديث القيم الأولية بناءً على الموقع الفعلي
const updateInitialPosition = () => {
    const rect = floatingBtn.getBoundingClientRect();
    baseX = rect.left; // الموقع الأساسي في بداية السحب
    baseY = rect.top;
};


updateInitialPosition(); // تهيئة القيم عند التحميل

floatingBtn.addEventListener("mousedown", startDragging);
floatingBtn.addEventListener("touchstart", startDragging);

function startDragging(e) {
    e.preventDefault();
    isDragging = true;
    isDraggingInitiated = false;
    updateInitialPosition(); // إعادة تحديث القيم الأولية عند بدء السحب
    if (e.type === "touchstart") {
        startX = e.touches[0].clientX;
        startY = e.touches[0].clientY;
        touchStartTime = Date.now(); // تسجيل وقت بدء اللمس
    } else {
        startX = e.clientX;
        startY = e.clientY;
    }
    floatingBtn.style.cursor = "grabbing";
    floatingBtn.style.transition = "none"; // إزالة أي انتقال (transition) أثناء السحب
}

document.addEventListener("mousemove", drag);
document.addEventListener("touchmove", drag);

function drag(e) {
    if (isDragging) {
        e.preventDefault();
        let newX, newY;
        if (e.type === "touchmove") {
            newX = e.touches[0].clientX;
            newY = e.touches[0].clientY;
        } else {
            newX = e.clientX;
            newY = e.clientY;
        }

        const deltaX = Math.abs(newX - startX);
        const deltaY = Math.abs(newY - startY);
        if (deltaX > dragThreshold || deltaY > dragThreshold) {
            isDraggingInitiated = true;

            // حساب الموقع الجديد بناءً على الفرق النسبي من الموقع الأساسي
            const offsetX = newX - startX;
            const offsetY = newY - startY;
            let currentX = baseX + offsetX;
            let currentY = baseY + offsetY;

            const maxX = window.innerWidth - floatingBtn.offsetWidth;
            const maxY = window.innerHeight - floatingBtn.offsetHeight;
            currentX = Math.max(0, Math.min(currentX, maxX));
            currentY = Math.max(0, Math.min(currentY, maxY));

            floatingBtn.style.left = currentX + "px";
            floatingBtn.style.top = currentY + "px";
            floatingBtn.style.right = "auto";
            floatingBtn.style.bottom = "auto";
        }
    }
}

document.addEventListener("mouseup", stopDragging);
document.addEventListener("touchend", stopDragging);

function stopDragging(e) {
    if (isDragging) {
        isDragging = false;
        floatingBtn.style.cursor = "pointer";
        updateInitialPosition(); // تحديث الموقع الأساسي بعد انتهاء السحب

        // التحقق مما إذا كان النقر باللمس (tap) وليس سحب
        if (e.type === "touchend" && !isDraggingInitiated) {
            const touchEndTime = Date.now();
            const touchDuration = touchEndTime - touchStartTime;

            // إذا كانت مدة اللمس قصيرة (أقل من 300 مللي ثانية)، نعتبرها نقرة
            if (touchDuration < 300) {
                openModal();
            }
        }
    }
}

// متغير لتتبع حالة النافذة
let isModalOpen = false;

// فتح نافذة العناصر الجديدة
function openModal() {
    try {
        if (isModalOpen) return; // إذا مفتوحة لا تفتحها مرة ثانية

        const modal = document.getElementById("newItemsModal");
        const overlay = document.getElementById("overlay"); // نفس تظليل الإعلان

        // شغّل التظليل
        if (overlay) {
            overlay.style.display = "block";
        }

        // افتح النافذة مع الأنيميشن
        modal.style.display = "flex";
        modal.style.animation = "slideDownModal 0.5s ease-out forwards";

        isModalOpen = true;
        loadNewItems(); // مثل ما كان عندك
    } catch (error) {
        console.error("Error in openModal:", error);
    }
}



// إغلاق نافذة العناصر الجديدة
function closeNewItemsModal() {
    try {
        const modal   = document.getElementById("newItemsModal");
        const overlay = document.getElementById("overlay");
        const promo   = document.getElementById("promoPopup"); // إعلان الخصم

        // حركة الخروج
        modal.style.animation = "slideUpModal 0.5s ease-in forwards";

        setTimeout(() => {
            modal.style.display = "none";
            isModalOpen = false;

            if (overlay) {
                // إذا ماكو إعلان مفتوح حالياً، طفي التظليل
                if (!promo || promo.style.display !== "flex") {
                    overlay.style.display = "none";
                }
            }
        }, 500); // نفس وقت الأنيميشن

    } catch (error) {
        console.error("Error in closeNewItemsModal:", error);
        isModalOpen = false;

        // بحالة الخطأ نضمن نطفي التظليل
        const overlay = document.getElementById("overlay");
        if (overlay) overlay.style.display = "none";
    }
}

let isOffersModalOpen = false;
let offersCache = [];

function openOffersModal(){
    try{
        if (isOffersModalOpen) return;

        const modal = document.getElementById("offersModal");
        const overlay = document.getElementById("overlay"); // نفس overlay مالك

        if (overlay) overlay.style.display = "block";

        modal.style.display = "flex";
        modal.style.animation = "slideDownModal 0.5s ease-out forwards";

        isOffersModalOpen = true;
        loadOffers();
    }catch(err){
        console.error("Error in openOffersModal:", err);
    }
}

function closeOffersModal(){
    try{
        const modal   = document.getElementById("offersModal");
        const overlay = document.getElementById("overlay");
        const promo   = document.getElementById("promoPopup");
        const newItemsModal = document.getElementById("newItemsModal");

        modal.style.animation = "slideUpModal 0.5s ease-in forwards";

        setTimeout(() => {
            modal.style.display = "none";
            isOffersModalOpen = false;

            if (overlay) {
                const isPromoOpen = promo && promo.style.display === "flex";
                const isNewOpen = newItemsModal && newItemsModal.style.display === "flex";
                if (!isPromoOpen && !isNewOpen) overlay.style.display = "none";
            }
        }, 500);
    }catch(err){
        console.error("Error in closeOffersModal:", err);
        isOffersModalOpen = false;
        const overlay = document.getElementById("overlay");
        if (overlay) overlay.style.display = "none";
    }
}

function loadOffers(){
    const modal = document.getElementById("offersModal");
    const container = modal.querySelector(".offers-content");
    const chip = document.getElementById("offersCountChip");

    container.innerHTML = "";

    // نفس فكرة اللستة مالتك (وأضفت LENS + LNES حتى ما نضيع شي)
    const categories = ["LCD","BATTERY","HOUSING","BACK","CAMERA","CHARGING","BUZZER","FINGER","FLAT LCD","POWER","LENS","VOLUME","SPEAKER","FLAT SPEAKER","HOLLDER","IC","CC","VIBRATION"];

    let offers = [];

    categories.forEach(category => {
        if (!database[category]) return;

        database[category].forEach(item => {
            const originalPriceRaw = item["Price"];
            const discountPriceRaw = item["Discount Price"];

            if (!originalPriceRaw || !discountPriceRaw) return;

            const pNum = parseFloat(String(originalPriceRaw).replace(/,/g,'').trim());
            const dNum = parseFloat(String(discountPriceRaw).replace(/,/g,'').trim());
            if (isNaN(pNum) || isNaN(dNum)) return;

            const saving = Math.max(0, pNum - dNum);
            offers.push({ item, category, saving });
        });
    });

    // رتب من الأعلى توفيراً
    offers.sort((a,b) => (b.saving - a.saving));

    offersCache = offers;

    chip.textContent = `${offers.length} عرض`;

    if (offers.length === 0){
        container.innerHTML = `
            <div style="padding:18px;text-align:center;color:#e5e7eb;font-family:'Cairo',sans-serif;">
                حالياً ماكو عروض مضافة 🙃
            </div>
        `;
        return;
    }

    renderOffers(offers);
}

function renderOffers(list){
    const modal = document.getElementById("offersModal");
    const container = modal.querySelector(".offers-content");

    let html = "";

    list.forEach(({item, category, saving}) => {
        const name = item["Item Name"] || item["Item"] || "بدون اسم";

        // نفس تنسيق عرض الأسعار عندك بـ displayResults :contentReference[oaicite:4]{index=4}
        const originalFormatted = item["Price"].toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        const discountFormatted = item["Discount Price"].toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");

        const savingFormatted = saving.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");

        const iconClass = (typeof getCategoryIcon === "function") ? getCategoryIcon(category) : "fas fa-tag";

        const priceHtml = `
            <div class="price-row">
                <p class="old-price-pill">
                    <span class="old-price-text">${originalFormatted} د.ع</span>
                </p>
                <p class="new-price-pill">
                    <span class="new-price-text new-price-label">عرض خاص</span>
                    <span class="new-price-text new-price-value">${discountFormatted} د.ع</span>
                </p>
            </div>
        `;

        html += `
            <div class="offer-card">
                <div class="offer-top">
                    <div class="offer-icon"><i class="${iconClass}"></i></div>
                    <div style="flex:1;min-width:0">
                        <div class="offer-title">${name}</div>
                        <div class="offer-meta">
                            <span class="offer-tag">${category}</span>
                            ${saving > 0 ? `<span class="offer-save">وفر ${savingFormatted} د.ع</span>` : ``}
                        </div>
                    </div>
                </div>

                <div class="offer-prices">
                    ${priceHtml}
                </div>
            </div>
        `;
    });

    container.innerHTML = html;
}

/* بحث داخل العروض */
document.addEventListener("DOMContentLoaded", () => {
    const input = document.getElementById("offersSearchInput");
    if (!input) return;

    input.addEventListener("input", () => {
        const q = input.value.trim().toLowerCase();
        const filtered = offersCache.filter(x => {
            const name = (x.item["Item Name"] || x.item["Item"] || "").toString().toLowerCase();
            return name.includes(q);
        });
        renderOffers(filtered);
    });

    input.addEventListener("keydown", (e) => {
        if (e.key === "Enter") e.preventDefault();
    });
});





// معالج النقر بالماوس
floatingBtn.addEventListener("click", (e) => {
    if (!isDraggingInitiated) {
        openModal();
    }
    isDraggingInitiated = false; // إعادة تعيين بعد النقر
});

      
 const notifications = [
    "شاشات KBS 👌 ضمان بعد الشد",
    "شاشات FLYCDI 🔥 ضمان بعد الشد",
    "تره أسعارنا الأرخص بالمحافظة 😉",
    "متانة وجودة ✨ وسعر يبرد الگلب",
    "مكتب عسل .. خبرة سنين بالقطع",
    "مو الوحيدين.. بس إحنا الأفضل 😎",
    "مكتب عسل اسم بالثقة والقطع",
    "شاشات قوية 💪 وياها ضمان كامل",
    "أرخص سعر 🔧 وأعلى جودة",
    "مكتب عسل الأول بالثقة 👍",
    "خبرتنا كفيلة ترضيك دومًا ✨",
    "FLYCDI شاشات ما إلها مثيل 🔥",
    "مكتبنا عنوان التميّز بالمحافظة",
    "أسعار تخلي الكل راضي 😍",
    "KBS الشاشات الأقوى بالسوق",
    "الجودة موجودة .. والتكلفة قليلة 💰"
];


function triggerAnimation() {
    const logo = document.getElementById("logo");
    const notification = document.getElementById("notification");
    const notificationText = document.getElementById("notification-text");
    const resultsContainer = document.getElementById("results");
    const searchInput = document.getElementById("searchInput");

    // إذا كانت النتائج معروضة أو يوجد نص في حقل البحث، نؤخر الانفجار
    if (!logo || !notification || !notificationText || 
        resultsContainer.style.display === "flex" || 
        searchInput.value.trim().length > 0) {
        setTimeout(triggerAnimation, 100); // تأخير بسيط جدًا
        return;
    }

    // اهتزاز اللوغو
    logo.style.animation = "shake 0.5s ease-in-out";
    setTimeout(() => {
        logo.style.animation = "none";
    }, 500);

    // انفجار اللوغو واختفاءه
    setTimeout(() => {
        logo.style.animation = "explode 0.5s ease-out";
        logo.style.opacity = "0";
    }, 800);

    // عرض الإشعار
    setTimeout(() => {
        const randomNotification = notifications[Math.floor(Math.random() * notifications.length)];
        notificationText.textContent = randomNotification;
        notification.classList.add("show");
    }, 1300);

    // اختفاء الإشعار بانيميشن GSAP
    setTimeout(() => {
        notification.classList.remove("show");
        gsap.to(notification, {
            scale: 0.8,
            opacity: 0,
            rotation: 180,
            duration: 0.8,
            ease: "power2.inOut",
            onComplete: () => {
                notification.style.transform = "scale(0)";
            }
        });
    }, 5000);

    // إعادة اللوغو من جديد (بدون دوران - يظهر فجأة)
    setTimeout(() => {
        gsap.set(logo, { scale: 0, opacity: 0 }); // ماكو rotation
        gsap.to(logo, {
            scale: 1,
            opacity: 1,
            duration: 1.2,
            ease: "bounce.out"
        });
    }, 5800);

    setTimeout(triggerAnimation, 8000);
}



      
    // ✅ قفل الصيانة: true = تظهر نافذة الصيانة وتمنع الدخول، false = طبيعي
let maintenanceLock = false;

// ✅ سماح مؤقت للأدمن (جلسة المتصفح الحالية فقط)
const maintenanceBypassKey = 'maintenanceBypass';

// ✅ كلمة أدمن الصيانة (لا تخليها 112233)
const MAINTENANCE_ADMIN_PASSWORD = '445566';


const activatedBackupKey = 'isActivatedBackup';





// ✅ يبقى محفوظ بالجهاز
const MAINTENANCE_BYPASS_TTL_HOURS = 24; // "بعد فترة" = 24 ساعة (غيّرها إذا تريد)

function getMaintenanceBypass() {
    // أولاً إذا موجود بالجلسة
    if (sessionStorage.getItem(maintenanceBypassKey) === 'true') return true;

    // ثانياً إذا محفوظ بالجهاز
    const raw = localStorage.getItem(maintenanceBypassKey);
    if (!raw) return false;

    try {
        const data = JSON.parse(raw);
        if (!data || data.ok !== true || !data.ts) return false;

        const age = Date.now() - data.ts;
        const maxAge = MAINTENANCE_BYPASS_TTL_HOURS * 60 * 60 * 1000;

        // انتهت الصلاحية -> لازم يطلب مرة ثانية
        if (age > maxAge) return false;

        return true;
    } catch (e) {
        return false;
    }
}

function setMaintenanceBypass() {
    const payload = { ok: true, ts: Date.now() };
    localStorage.setItem(maintenanceBypassKey, JSON.stringify(payload));
    sessionStorage.setItem(maintenanceBypassKey, 'true');
}

function clearMaintenanceBypass() {
    localStorage.removeItem(maintenanceBypassKey);
    sessionStorage.removeItem(maintenanceBypassKey);
}






      
      
 let showPromoPopup = false; // 🔥 يتحكم فقط في النافذة المنبثقة، false = تعطيل النافذة
let promoAlreadyShown = sessionStorage.getItem('promoShown') === 'true';

window.onload = function() {

    // ✅ إذا الصيانة مطفية: امسح bypass + رجّع التفعيل إذا كان محفوظ قبل الصيانة
    if (!maintenanceLock) {
        clearMaintenanceBypass();

        // ✅ Restore: إذا انمسح isActivated أثناء الصيانة، رجّعه من النسخة الاحتياطية
        if (localStorage.getItem('isActivated') !== 'true' &&
            localStorage.getItem(activatedBackupKey) === 'true') {
            localStorage.setItem('isActivated', 'true');
            localStorage.removeItem(activatedBackupKey);
        }
    }

    const bypass = getMaintenanceBypass();
    const isActivated = localStorage.getItem('isActivated') === 'true';

    // ✅ أول شرط: إذا صيانة شغالة وماكو أدمن => امنع الدخول للجميع (حتى لو مفعل سابقاً)
    if (maintenanceLock && !bypass) {

        // ✅ Backup: إذا المستخدم كان مفعل قبل الصيانة، خزّن نسخة حتى ما يضيع تفعيله
        if (localStorage.getItem('isActivated') === 'true') {
            localStorage.setItem(activatedBackupKey, 'true');
        }

        showMaintenancePopup();
        return;
    }

    // ✅ إذا مو مفعل وماكو bypass => نافذة 112233
    if (!isActivated && !bypass) {
        showActivationPopup();
        return;
    }

    // ✅ هنا طبيعي يدخل
    triggerAnimation();

    // ===== Lux Ads System (Popup Ads) =====
    LuxAds.maybeShow();


    if (showPromoPopup && !promoAlreadyShown) {
        setTimeout(() => {
            let popup = document.getElementById('promoPopup');
            popup.style.display = 'flex';
           popup.style.animation = 'promoPopIn 0.75s cubic-bezier(.2,.8,.2,1) forwards';

            document.getElementById('overlay').style.display = 'block';
        }, 500);
        sessionStorage.setItem('promoShown', 'true');
    }

    loadExcelFiles().then(result => {
        if (result.success) {
            console.log("تم تحميل البيانات بنجاح، جارٍ تحميل العناصر الجديدة.");
            loadNewItems();
        } else {
            console.warn("فشل تحميل البيانات:", result.message);
        }
    });
};








async function showActivationPopup() {
    // إذا التطبيق مفعّل مسبقاً، لا تفتح النافذة
    if (localStorage.getItem('isActivated') === 'true') {
        return;
    }

    let overlay = document.getElementById('activation-overlay');

    // أول مرة نجي، ننشئ هيكل النافذة
    if (!overlay) {
        const template = `
            <div id="activation-overlay" class="activation-overlay">
                <div class="activation-dialog" dir="rtl">
                    <div class="activation-logo">
                        <div class="activation-logo-ring">
                            <div class="activation-logo-core">
                                <!-- تقدر تخلي حرف A أو أيقونة قفل أو شعار مكتبك -->
                                <i class="fa-solid fa-lock"></i>
                            </div>
                        </div>
                    </div>

                    <div class="activation-header">
                        <div class="activation-label">Secure Access</div>
                        <div class="activation-title">تأكيد الدخول للتطبيق</div>
                        <div class="activation-subtitle">
                            الوصول مخصص لزبائن مكتب عسل فقط.
                        </div>
                    </div>

                    <div class="activation-body">
                        <p class="activation-text">
                            حتى نحافظ على سرّية الأسعار وشغل المكتب، الدخول للتطبيق يحتاج كلمة مرور
                            تستلمها مباشرة من مكتب عسل. اكتب الكلمة هنا وتوكل على الله.
                        </p>

                        <label class="activation-field-label" for="activation-password-input">
                            كلمة المرور
                        </label>

                        <div class="activation-input-row">
                            <input
                                id="activation-password-input"
                                type="password"
                                autocomplete="off"
                                placeholder="اكتب كلمة المرور هنا"
                            />
                            <button
                                type="button"
                                class="activation-toggle-password"
                                aria-label="إظهار / إخفاء كلمة المرور"
                            >
                                <i class="fa-regular fa-eye"></i>
                            </button>
                        </div>

                        <div class="activation-error" id="activation-error-row"></div>
                    </div>

                    <div class="activation-footer">
                        <button
                            type="button"
                            id="activation-confirm-btn"
                            class="activation-btn primary"
                        >
                            تأكيد الدخول
                        </button>

                        <button
                            type="button"
                            id="activation-cancel-btn"
                            class="activation-btn ghost"
                        >
                            إغلاق التطبيق
                        </button>
                    </div>
                </div>
            </div>
        `;

        document.body.insertAdjacentHTML('beforeend', template);
        overlay = document.getElementById('activation-overlay');

        const dialog        = overlay.querySelector('.activation-dialog');
        const passwordInput = document.getElementById('activation-password-input');
        const errorRow      = document.getElementById('activation-error-row');
        const confirmBtn    = document.getElementById('activation-confirm-btn');
        const cancelBtn     = document.getElementById('activation-cancel-btn');
        const toggleBtn     = overlay.querySelector('.activation-toggle-password');

        const focusNoScroll = () => {
            setTimeout(() => {
                try {
                    passwordInput.focus({ preventScroll: true });
                } catch (e) {
                    passwordInput.focus();
                }
            }, 50);
        };

        const setError = (msg) => {
            errorRow.textContent = msg || '';
            dialog.classList.remove('is-shaking');
            if (msg) {
                // نعيد تشغيل أنيميشن الاهتزاز
                void dialog.offsetWidth;
                dialog.classList.add('is-shaking');
            }
        };

        // زر العين – إظهار/إخفاء كلمة المرور
        toggleBtn.addEventListener('click', () => {
            const isPassword = passwordInput.type === 'password';
            passwordInput.type = isPassword ? 'text' : 'password';
            toggleBtn.innerHTML = isPassword
                ? '<i class="fa-regular fa-eye-slash"></i>'
                : '<i class="fa-regular fa-eye"></i>';
            focusNoScroll(); // ✅ بدل focus العادي
        });

        // زر تأكيد الدخول
        confirmBtn.addEventListener('click', () => {
            const value = (passwordInput.value || '').trim();

            if (!value) {
                setError('رجاءً اكتب كلمة المرور أولاً.');
                focusNoScroll(); // ✅ بدل focus العادي
                return;
            }

            // نفس كلمة المرور القديمة بالضبط
            if (value === '112233' || value === ADMIN_PASSWORD) {
                // ✅ تفعيل التطبيق
                localStorage.setItem('isActivated', 'true');
                // ✅ تفعيل وضع الكادر حسب كلمة المرور
                setAdminUser(value === ADMIN_PASSWORD);

                setError('');
                dialog.classList.remove('is-shaking');

                // 🎉 عرض شاشة نجاح عالمية داخل نفس النافذة
                dialog.classList.add('is-success');
                dialog.innerHTML = `
                    <div class="activation-success" dir="rtl">
                        <div class="activation-success-icon">
                            <div class="activation-success-inner">
                                <i class="fa-solid fa-check"></i>
                            </div>
                        </div>
                        <div class="activation-success-title">تم التفعيل بنجاح</div>
                        <div class="activation-success-text">
                            تم تفعيل تطبيق عسل لحسابك. خلال لحظات راح نفتح لك الواجهة الرئيسية
                            وتكمل شغلك براحتك.
                        </div>
                    </div>
                `;

                // بعد الأنيميشن نعيد تحميل الصفحة
                setTimeout(() => {
                    overlay.classList.remove('is-open');

                    // ✅ فتح السكرول قبل الريلود
                    document.documentElement.style.overflow = '';
                    document.body.style.overflow = '';

                    setTimeout(() => {
                        location.reload();
                    }, 150);
                }, 1600);
            } else {
                // كلمة مرور خاطئة
                setError('كلمة المرور غير صحيحة. تأكد منها وجرب مرة ثانية.');
                passwordInput.select();
            }
        });

        // زر إغلاق التطبيق (نفس فكرة "لازم تفعّل")
        cancelBtn.addEventListener('click', () => {
            setError('لا يمكنك استخدام التطبيق بدون تفعيل. راجع مكتب عسل للحصول على كلمة المرور.');
            focusNoScroll(); // ✅ بدل focus العادي
        });

        // إنتر = تأكيد
        passwordInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                confirmBtn.click();
            }
        });
    }

    // كل مرة ننادي showActivationPopup نعرض النافذة
    overlay.classList.add('is-open');

    // ✅ قفل السكرول أول ما تنفتح النافذة
    document.documentElement.style.overflow = 'hidden';
    document.body.style.overflow = 'hidden';

    const input = document.getElementById('activation-password-input');
    const error = document.getElementById('activation-error-row');

    if (error) error.textContent = '';
    if (input) {
        input.value = '';

        // ✅ فوكس بدون سكرول لتقليل وميض الموبايل
        setTimeout(() => {
            try {
                input.focus({ preventScroll: true });
            } catch (e) {
                input.focus();
            }
        }, 50);
    }
}





// ✅ حركة الخروج بنفس مسار النزول (لأعلى)
function closePopup() {
  const popup  = document.getElementById('promoPopup');
  const overlay = document.getElementById('overlay');
  const newItemsModal = document.getElementById("newItemsModal");
  const offersModal   = document.getElementById("offersModal");

  popup.style.animation = 'promoPopOut 0.55s ease-in forwards';

  setTimeout(() => {
    popup.style.display = 'none';

    if (overlay) {
      const isNewOpen    = newItemsModal && newItemsModal.style.display === "flex";
      const isOffersOpen = offersModal && offersModal.style.display === "flex";
      if (!isNewOpen && !isOffersOpen) overlay.style.display = 'none';
    }
  }, 560);
}


function openCartFromPromo(){
  closePopup();
  setTimeout(() => {
    try { if (typeof openCart === "function") openCart(); } catch(e) {}
  }, 650);
}




function showMaintenancePopup() {
    let overlay = document.getElementById('maintenance-overlay');

    if (!overlay) {
        const template = `
            <div id="maintenance-overlay" class="activation-overlay">
                <div class="activation-dialog" dir="rtl">
                    <div class="activation-logo">
                        <div class="activation-logo-ring">
                            <div class="activation-logo-core">
                                <i class="fa-solid fa-screwdriver-wrench"></i>
                            </div>
                        </div>
                    </div>

                    <div class="activation-header">
                        <div class="activation-label">Maintenance Mode</div>
                        <div class="activation-title">التطبيق تحت الصيانة</div>
                        <div class="activation-subtitle">الدخول فقط لكادر عسل</div>
                    </div>

                    <div class="activation-body">
                        <p class="activation-text">
                            حالياً التطبيق متوقف للصيانة والتحديثات.
                            إذا انت من الكادر، سجل دخول أدمن.
                        </p>

                        <label class="activation-field-label" for="maintenance-admin-input">
                            دخول أدمن
                        </label>

                        <div class="activation-input-row">
                            <input
                                id="maintenance-admin-input"
                                type="password"
                                autocomplete="off"
                                placeholder="اكتب كلمة الأدمن"
                            />
                            <button
                                type="button"
                                class="activation-toggle-password"
                                aria-label="إظهار / إخفاء كلمة المرور"
                                id="maintenance-toggle-btn"
                            >
                                <i class="fa-regular fa-eye"></i>
                            </button>
                        </div>

                        <div class="activation-error" id="maintenance-error-row"></div>
                    </div>

                    <div class="activation-footer">
                        <button type="button" id="maintenance-enter-btn" class="activation-btn primary">
                            دخول
                        </button>

                        <button type="button" id="maintenance-close-btn" class="activation-btn ghost">
                            إغلاق
                        </button>
                    </div>
                </div>
            </div>
        `;

        document.body.insertAdjacentHTML('beforeend', template);
        overlay = document.getElementById('maintenance-overlay');

        const dialog     = overlay.querySelector('.activation-dialog');
        const adminInput = document.getElementById('maintenance-admin-input');
        const errorRow   = document.getElementById('maintenance-error-row');
        const enterBtn   = document.getElementById('maintenance-enter-btn');
        const closeBtn   = document.getElementById('maintenance-close-btn');
        const toggleBtn  = document.getElementById('maintenance-toggle-btn');

        const setError = (msg) => {
            errorRow.textContent = msg || '';
            dialog.classList.remove('is-shaking');
            if (msg) {
                void dialog.offsetWidth;
                dialog.classList.add('is-shaking');
            }
        };

        toggleBtn.addEventListener('click', () => {
            const isPassword = adminInput.type === 'password';
            adminInput.type = isPassword ? 'text' : 'password';
            toggleBtn.innerHTML = isPassword
                ? '<i class="fa-regular fa-eye-slash"></i>'
                : '<i class="fa-regular fa-eye"></i>';
            adminInput.focus();
        });

        enterBtn.addEventListener('click', () => {
            const entered = (adminInput.value || '').trim();

            if (!entered) {
                setError('رجاءً اكتب كلمة الأدمن أولاً.');
                adminInput.focus();
                return;
            }

            // ✅ هنا كلمة الأدمن الخاصة بالصيانة فقط
            if (entered === MAINTENANCE_ADMIN_PASSWORD) {
                setMaintenanceBypass(); // ✅ التعديل: ينحفظ بالجهاز وما يطلبه كل مرة
                setError('');
                overlay.classList.remove('is-open');

                // ✅ فتح السكرول قبل الريلود
                document.documentElement.style.overflow = '';
                document.body.style.overflow = '';

                setTimeout(() => location.reload(), 150);
            } else {
                setError('كلمة الأدمن غير صحيحة.');
                adminInput.select();
            }
        });

        closeBtn.addEventListener('click', () => {
            setError('التطبيق تحت الصيانة. الدخول متاح فقط للأدمن.');
            adminInput.focus();
        });

        adminInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                enterBtn.click();
            }
        });
    }

    overlay.classList.add('is-open');

    // ✅ قفل السكرول أول ما تنفتح النافذة
    document.documentElement.style.overflow = 'hidden';
    document.body.style.overflow = 'hidden';

    const adminInput = document.getElementById('maintenance-admin-input');
    const error = document.getElementById('maintenance-error-row');

    if (error) error.textContent = '';
    if (adminInput) {
        adminInput.value = '';
        adminInput.focus();
    }
}







// إغلاق النافذة أو الإعلان عند الضغط على الخلفية الضبابية
document.addEventListener("DOMContentLoaded", () => {
    const overlay = document.getElementById("overlay");
    if (!overlay) return;

    overlay.addEventListener("click", () => {
        const modal = document.getElementById("newItemsModal");
        const promo = document.getElementById("promoPopup");

        if (modal && modal.style.display === "flex") {
            closeNewItemsModal();
        } else if (promo && promo.style.display === "flex") {
            // دالة الإعلان الموجودة عندك
            if (typeof closePopup === "function") {
                closePopup();
            }
        }
    });
});





const slider = document.getElementById('slider');
const prevBtn = document.querySelector('.prev-btn');
const nextBtn = document.querySelector('.next-btn');

prevBtn.addEventListener('click', () => {
    slider.scrollBy({ left: -100, behavior: 'smooth' });
});

nextBtn.addEventListener('click', () => {
    slider.scrollBy({ left: 100, behavior: 'smooth' });
});

function filterCategory(category) {
    alert("تم اختيار: " + category);
}




function showExitLikeAlert({ icon = "fas fa-exclamation-circle", title = "تنبيه", message = "", confirmText = "موافق" }) {
  return Swal.fire({
    html: `
      <div class="exit-shell">
        <div class="exit-icon">
          <i class="${icon}"></i>
        </div>
        <h2 class="exit-title">${title}</h2>
        <p class="exit-text">${message}</p>
      </div>
    `,
    confirmButtonText: confirmText,
    backdrop: 'rgba(2, 6, 23, 0.82)',
    allowOutsideClick: true,
    allowEscapeKey: true,
    customClass: {
      popup: 'swal2-popup exit-popup animate__animated animate__zoomIn',
      confirmButton: 'exit-confirm'
    },
    hideClass: {
      popup: 'animate__animated animate__zoomOut'
    }
  });
}




        
   const dropboxMainFile = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSZww_ZDcqXnX6pUjlKccZdFUkRR9Z_JmfmdvNsnGVYT_rq_RTsSB1ydTy6QVrrS_o4s_ml1DNBTnaQ/pub?output=xlsx&t=" + Date.now();

        let database = {};
        let currentCategory = null;

async function loadExcelFiles() {
    try {
        if (!dropboxMainFile) {
            console.error("رابط ملف Excel غير معرف.");
            Swal.fire({
                title: 'خطأ',
                html: '<p style="color: #ff4d4d;">رابط ملف Excel غير معرف. يرجى التحقق من الاتصال.</p>',
                iconHtml: '<i class="fas fa-exclamation-circle"></i>',
                confirmButtonText: 'موافق',
                customClass: {
                    popup: 'swal2-popup',
                    title: 'swal2-title',
                    htmlContainer: 'swal2-html-container',
                    confirmButton: 'swal2-confirm'
                }
            });
           return { success: false, hasData: false, message: "رابط ملف Excel غير معرف." };

        }

        console.log("جارٍ تحميل ملف Excel من:", dropboxMainFile);
        const mainResponse = await fetch(dropboxMainFile, { cache: 'no-store' });
        if (!mainResponse.ok) {
            console.error(`فشل تحميل ملف Excel: ${mainResponse.status} ${mainResponse.statusText}`);
            showExitLikeAlert({
             icon: "fas fa-exclamation-circle",
             title: "خطأ في التحميل",
             message: `فشل تحميل البيانات: ${mainResponse.status} - ${mainResponse.statusText}`,
             confirmText: "موافق"
            });

           return { success: false, hasData: false, message: `فشل تحميل ملف Excel: ${mainResponse.status}` };

        }

        const mainBuffer = await mainResponse.arrayBuffer();
        const mainWorkbook = XLSX.read(mainBuffer, { type: "array" });

        // تهيئة الكائن database
        database = {
            LCD: [],
            HUAWEI: [],
            BATTERY: [],
            HOUSING: [],
            BACK: [],
            CAMERA: [],
            CHARGING: [],
            BUZZER: [],
            HEADPHONE: [],
            FINGER: [],
            "FLAT LCD": [],
            POWER: [],
            LENS: [],
            VOLUME: [],
            SPEAKER: [],
            "FLAT SPEAKER": [],
            HOLLDER: []
            
        };

        // تحميل البيانات من كل ورقة
        database.LCD = XLSX.utils.sheet_to_json(mainWorkbook.Sheets["LCD"] || {}, { defval: null });
        database.HUAWEI = XLSX.utils.sheet_to_json(mainWorkbook.Sheets["HUAWEI"] || {}, { defval: null });
        database.BATTERY = XLSX.utils.sheet_to_json(mainWorkbook.Sheets["BATTERY"] || {}, { defval: null });
        database.HOUSING = XLSX.utils.sheet_to_json(mainWorkbook.Sheets["HOUSING"] || {}, { defval: null });
        database.BACK = XLSX.utils.sheet_to_json(mainWorkbook.Sheets["BACK"] || {}, { defval: null });
        database.CAMERA = XLSX.utils.sheet_to_json(mainWorkbook.Sheets["CAMERA"] || {}, { defval: null });
        database.CHARGING = XLSX.utils.sheet_to_json(mainWorkbook.Sheets["CHARGING"] || {}, { defval: null });
        database.BUZZER = XLSX.utils.sheet_to_json(mainWorkbook.Sheets["BUZZER"] || {}, { defval: null });
        database.HEADPHONE = XLSX.utils.sheet_to_json(mainWorkbook.Sheets["HEADPHONE"] || {}, { defval: null });
        database.FINGER = XLSX.utils.sheet_to_json(mainWorkbook.Sheets["FINGER"] || {}, { defval: null });
        database["FLAT LCD"] = XLSX.utils.sheet_to_json(mainWorkbook.Sheets["FLAT LCD"] || {}, { defval: null });
        database.POWER = XLSX.utils.sheet_to_json(mainWorkbook.Sheets["POWER"] || {}, { defval: null });
        database.LENS = XLSX.utils.sheet_to_json(mainWorkbook.Sheets["LENS"] || {}, { defval: null });
        database.VOLUME = XLSX.utils.sheet_to_json(mainWorkbook.Sheets["VOLUME"] || {}, { defval: null });
        database.SPEAKER = XLSX.utils.sheet_to_json(mainWorkbook.Sheets["SPEAKER"] || {}, { defval: null });
        database["FLAT SPEAKER"] = XLSX.utils.sheet_to_json(mainWorkbook.Sheets["FLAT SPEAKER"] || {}, { defval: null });
        database.HOLLDER = XLSX.utils.sheet_to_json(mainWorkbook.Sheets["HOLLDER"] || {}, { defval: null }),
        database.IC = XLSX.utils.sheet_to_json(mainWorkbook.Sheets["IC"] || {}, { defval: null }),
        database.CC = XLSX.utils.sheet_to_json(mainWorkbook.Sheets["CC"] || {}, { defval: null }),
        database.VIBRATION = XLSX.utils.sheet_to_json(mainWorkbook.Sheets["VIBRATION"] || {}, { defval: null })
         

        // تصحيح البيانات
        Object.keys(database).forEach(category => {
            console.log(`فئة ${category}: ${database[category].length} عنصر`, database[category]);
            if (database[category].length === 0) {
                console.warn(`لا توجد بيانات في ورقة ${category}`);
            } else {
                database[category].slice(0, 5).forEach(item => {
                    console.log(`عنصر في ${category}:`, {
                        name: item["Item Name"] || item["Item"],
                        price: item["Price"],
                        new: item["New"],
                        newType: typeof item["New"],
                        isNewEmpty: item["New"] === "" || item["New"] === undefined || item["New"] === null
                    });
                });
            }
        });

        const hasData = Object.values(database).some(items => items.length > 0);
        if (!hasData) {
            console.warn("ملف Excel لا يحتوي على بيانات صالحة (جميع الفئات فارغة).");
           
           showExitLikeAlert({
  icon: "fas fa-exclamation-circle",
  title: "خطأ",
  message: "ملف Excel لا يحتوي على بيانات صالحة.",
  confirmText: "موافق"
});

           
           return { success: false, hasData: false, message: "ملف Excel لا يحتوي على بيانات صالحة." };
        }

        return { success: true, hasData: true };
    } catch (error) {
        console.error("خطأ في تحميل ملف Excel:", error.message, error.stack);
       showExitLikeAlert({
  icon: "fas fa-wifi",
  title: "خطأ بالتحميل",
  message: `حدث خطأ أثناء تحميل البيانات: ${error.message}`,
  confirmText: "موافق"
});

       return { success: false, hasData: false, message: error.message };

    }
}



async function loadNewItems() {
    const modal = document.getElementById("newItemsModal");
    const modalContent = modal.querySelector(".modal-content");
    const newItemsCount = document.querySelector(".new-items-count");

    modalContent.innerHTML = "";
    const categories = ["LCD","BATTERY","HOUSING","BACK","CAMERA","CHARGING","BUZZER","FINGER","FLAT LCD","POWER","LENS","VOLUME","SPEAKER","FLAT SPEAKER","HOLLDER","IC","CC","VIBRATION"];
    let newItems = [];

    categories.forEach(category => {
        if (database[category]) {
            const items = database[category].filter(item => {
                const newField = item["New"] !== undefined ? item["New"] : 
                                item["new"] !== undefined ? item["new"] : 
                                item["NEW"] !== undefined ? item["NEW"] : null;
                const isNew = newField === "" || newField === undefined || newField === null || newField === " " || newField === "  ";
                const priceValue = item["Price"] ? String(item["Price"]).trim() : "";
                const hasPrice = priceValue && !isNaN(parseFloat(priceValue)) && !["❎", "xx"].includes(priceValue);
                return hasPrice && isNew;
            });
            items.forEach(item => newItems.push({ ...item, category }));
        }
    });

    console.log(`إجمالي العناصر الجديدة: ${newItems.length}`, newItems);
    newItemsCount.textContent = newItems.length;

    if (newItems.length === 0) {
        modalContent.innerHTML = `
            <p style="color: #fff; font-family: 'Cairo', sans-serif; text-align: center;">
                لا توجد عناصر جديدة حاليًا
            </p>
        `;
        return;
    }

    newItems.forEach(item => {
        const card = document.createElement("div");
        card.className = "new-item-card";
        const iconClass = getIconForCategory(item.category);
        card.innerHTML = `
            <div class="category-circle">${item.category}</div>
            <div class="item-details">
                <div class="new-badge">جديد</div>
                <h4><i class="${iconClass}"></i> ${item["Item Name"] || item["Item"]}</h4>
                <p>${item["Price"].toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")} د.ع</p>
            </div>
        `;
        modalContent.appendChild(card);
    });
}

// دالة لاختيار الأيقونة بناءً على الفئة
function getIconForCategory(category) {
    const icons = {
        "LCD": "fas fa-tv",
        "HUAWEI": "fas fa-mobile-alt",
        "BATTERY": "fas fa-battery-full",
        "HOUSING": "fas fa-mobile-alt",
        "BACK": "fas fa-tablet-alt",
        "CAMERA": "fas fa-camera",
        "CHARGING": "fas fa-plug",
        "BUZZER": "fas fa-bell",
        "HEADPHONE": "fas fa-volume-up",
        "FINGER": "fas fa-fingerprint",
        "FLAT LCD": "fas fa-film",
        "POWER": "fas fa-power-off",
        "LENS": "fas fa-bullseye",
        "VOLUME": "fas fa-sliders-h",
        "SPEAKER": "fas fa-phone-volume",
        "FLAT SPEAKER": "fas fa-phone-alt",
        
        
        
        "UNKNOWN": "fas fa-question-circle"
    };
    return icons[category] || icons["UNKNOWN"];
}



        
        
        document.getElementById("searchInput").addEventListener("keydown", function(event) {
    if (event.key === "Enter") {
        event.preventDefault(); // 🔴 منع إعادة تحميل الصفحة
        searchItems(); // ✅ استدعاء البحث
    }
});




        
function filterCategory(category) {
    currentCategory = category;

    // إزالة الفئة "active" من جميع العناصر في القائمة السلايد
    document.querySelectorAll(".category").forEach(cat => cat.classList.remove("active"));

    // إضافة الفئة "active" للعنصر المختار
    const selectedCategory = document.querySelector(`.category[onclick="filterCategory('${category}')"]`);
    if (selectedCategory) {
        selectedCategory.classList.add("active");
    }
}





        function normalizeString(str) {
            return str.replace(/\s+/g, '').toLowerCase();
        }



function displayResults(results) {
    const resultsContainer = document.getElementById("results");
    resultsContainer.innerHTML = '';

    if (results.length === 0) {
        resultsContainer.innerHTML = `
            <div class="no-results">
                هذا العنصر غير متوفر في الوقت الحالي
            </div>
        `;
    } else {
        let htmlContent = '';
        results.forEach(item => {

            // جزء الصورة كما هو
            const normalizedCategory = currentCategory
                .toLowerCase()
                .replace(/\s+/g, '-');

            const imgSrc = currentCategory === "SIMILARITES"
                ? 'images/default.png'
                : `images/${normalizedCategory}.png`;

            // منطق الأسعار
            const originalPriceRaw  = item["Price"];
            const discountPriceRaw  = item["Discount Price"]; // عمود جديد في ملف الإكسل

            let priceHtml = '<p>غير متوفر</p>';

            if (originalPriceRaw) {
                const originalFormatted = originalPriceRaw
                    .toString()
                    .replace(/\B(?=(\d{3})+(?!\d))/g, ",");

                if (discountPriceRaw) {
                    const discountFormatted = discountPriceRaw
                        .toString()
                        .replace(/\B(?=(\d{3})+(?!\d))/g, ",");

                    // 👉 عند وجود تخفيض: مستطيل السعر القديم + مستطيل السعر الجديد
                    priceHtml = `
                        <div class="price-row">
                            <p class="old-price-pill">
                                <span class="old-price-text">${originalFormatted} د.ع</span>
                            </p>
                            <p class="new-price-pill">
                                <span class="new-price-text new-price-label">عرض خاص</span>
                                <span class="new-price-text new-price-value">${discountFormatted} د.ع</span>
                            </p>
                        </div>
                    `;
                } else {
                    // 👉 بدون تخفيض: نفس البادج القديم
                    priceHtml = `<p>${originalFormatted} د.ع</p>`;
                }
            }

            /* ===== التعديل فقط: زر اضافة صغير + تحديد السعر الفعلي ===== */
            const itemName = (item["Item Name"] || item["Item"] || "بدون اسم").toString();
            const effectivePriceRaw = discountPriceRaw || originalPriceRaw;
            const effectivePrice = parseFloat(String(effectivePriceRaw || "").replace(/,/g, "")) || 0;
            const canAddToCart = effectivePrice > 0;

            htmlContent += `
                <div class="result-card">
                    ${canAddToCart ? `
                        <button class="add-mini"
                            type="button"
                            title="اضف للسلة"
                            data-name="${encodeURIComponent(itemName)}"
                            data-category="${encodeURIComponent(currentCategory)}"
                            data-price="${effectivePrice}"
                            data-img="${imgSrc}">
                            <i class="fas fa-cart-plus"></i>
                        </button>
                    ` : ''}

                    <img src="${imgSrc}" alt="Item Image">
                    <h4>${itemName}</h4>
                    ${priceHtml}
                </div>
            `;
        });

        resultsContainer.innerHTML = htmlContent;
    }

    requestAnimationFrame(() => {
        resultsContainer.style.display = "flex";
        resultsContainer.scrollIntoView({ behavior: "smooth", block: "start" });
        toggleScrollToTopButton();
    });
}










/* ================== توافقات قطع الغيار (بحث الأدمن) ================== */

function escapeHtml(str) {
    return String(str ?? "")
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
}

async function loadCompatibilitiesFile() {
    if (compatLoaded && Array.isArray(compatDatabase) && compatDatabase.length) {
        return { success: true };
    }

    try {
        const response = await fetch(dropboxSimilaritesFile, { cache: "no-store" });
        if (!response.ok) throw new Error("تعذر تحميل ملف التوافقات.");

        const arrayBuffer = await response.arrayBuffer();
        const workbook = XLSX.read(arrayBuffer, { type: "array" });

        const preferredSheet =
            workbook.SheetNames.find(n => n.toUpperCase().includes("SIMILAR")) ||
            workbook.SheetNames[0];

        const worksheet = workbook.Sheets[preferredSheet];
        compatDatabase = XLSX.utils.sheet_to_json(worksheet, { defval: "" });

        compatLoaded = true;
        return { success: true };
    } catch (err) {
        compatLoaded = false;
        compatDatabase = [];

        showExitLikeAlert({
            icon: "fas fa-exclamation-circle",
            title: "خطأ",
            message: "ما كدرنا نحمّل ملف التوافقات. تأكد من النت أو الرابط.",
            confirmText: "موافق"
        });

        return { success: false, message: err?.message || "error" };
    }
}

function pickCompatText(row) {
    // الشيت بيه حقل واحد فقط اسمه "Item"
    // نعتبره هو نص/وصف التوافق أو السطر اللي نبحث داخله
    const v = row && row["Item"] !== undefined ? String(row["Item"]).trim() : "";
    return v;
}


function pickItemName(row) {
    const keys = ["Item Name", "Item", "Name", "Part", "Model", "الموديل", "القطعة"];
    for (const k of keys) {
        if (row && row[k] !== undefined && String(row[k]).trim() !== "") {
            return String(row[k]).trim();
        }
    }
    return "بدون اسم";
}

function levenshteinDistance(a, b) {
    a = String(a || "");
    b = String(b || "");
    const alen = a.length, blen = b.length;
    if (alen === 0) return blen;
    if (blen === 0) return alen;

    const dp = new Array(blen + 1);
    for (let j = 0; j <= blen; j++) dp[j] = j;

    for (let i = 1; i <= alen; i++) {
        let prev = dp[0];
        dp[0] = i;
        for (let j = 1; j <= blen; j++) {
            const tmp = dp[j];
            const cost = a[i - 1] === b[j - 1] ? 0 : 1;
            dp[j] = Math.min(
                dp[j] + 1,      // حذف
                dp[j - 1] + 1,  // إضافة
                prev + cost     // استبدال
            );
            prev = tmp;
        }
    }
    return dp[blen];
}

function similarityScore(textNorm, queryNorm) {
    if (!textNorm || !queryNorm) return 0;

    // تطابق مباشر
    if (textNorm.includes(queryNorm)) return 1;

    // تشابه عبر Levenshtein
    const lev = levenshteinDistance(textNorm, queryNorm);
    const maxLen = Math.max(textNorm.length, queryNorm.length, 1);
    const levRatio = Math.max(0, 1 - (lev / maxLen));

    // تشابه عبر تقاطع الكلمات (Token Overlap)
    const t1 = textNorm.split(/\s+/).filter(Boolean);
    const t2 = queryNorm.split(/\s+/).filter(Boolean);
    const s1 = new Set(t1);
    const s2 = new Set(t2);
    let inter = 0;
    for (const x of s2) if (s1.has(x)) inter++;

    const union = new Set([...s1, ...s2]).size || 1;
    const jaccard = inter / union;

    // نختار الأفضل، مع وزن بسيط
    return Math.max(jaccard, levRatio * 0.92);
}


function displayCompatResults(results) {
    const resultsContainer = document.getElementById("results");
    resultsContainer.innerHTML = "";

    if (!results || results.length === 0) {
        resultsContainer.innerHTML = `
            <div class="no-results">
                هذا العنصر غير متوفر في الوقت الحالي
            </div>
        `;
    } else {
        let htmlContent = "";
        const imgSrc = "images/default.png";

        results.forEach(item => {
            const row = item.row || item;
            const score = typeof item.score === "number" ? item.score : 0;

            const rawText = pickCompatText(row) || pickItemName(row);
            const itemName = escapeHtml(rawText || "بدون اسم");

            const pct = Math.round(Math.max(0, Math.min(1, score)) * 100);

            htmlContent += `
                <div class="result-card">
                    <img src="${imgSrc}" alt="Item Image">
                    <h4>${itemName}</h4>
                    <p>نسبة التشابه: ${pct}%</p>
                </div>
            `;
        });

        resultsContainer.innerHTML = htmlContent;
    }

    requestAnimationFrame(() => {
        resultsContainer.style.display = "flex";
        resultsContainer.scrollIntoView({ behavior: "smooth", block: "start" });
        toggleScrollToTopButton();
    });
}

async function searchCompatibilitiesAdmin() {
    // ❌ مو أدمن
    if (!isAdminUser()) {
        showStaffOnlyPopup();
        return;
    }

    const inputEl = document.getElementById("searchInput");
    const searchInput = (inputEl?.value || "").trim();
    const resultsContainer = document.getElementById("results");

    if (!searchInput) {
        resultsContainer.style.display = "none";
        showExitLikeAlert({
            icon: "fas fa-exclamation-circle",
            title: "حقل فارغ",
            message: "يرجى كتابة اسم العنصر قبل المتابعة",
            confirmText: "موافق"
        });
        return;
    }

    const loadRes = await loadCompatibilitiesFile();
    if (!loadRes.success) return;

    const q = normalizeString(searchInput);

    // ✅ الشيت بيه عمود واحد فقط (Item)
    // نطلع "أقرب" النتائج حسب التشابه، ونرتبها
    const scored = (compatDatabase || []).map(row => {
        const txtNorm = normalizeString(pickCompatText(row) || pickItemName(row));
        const score = similarityScore(txtNorm, q);
        return { row, score, txtNorm };
    })
    .filter(x => x.score >= 0.32)          // فلترة بسيطة حتى لا تطلع نتائج بعيدة
    .sort((a, b) => b.score - a.score)
    .slice(0, 80);

    // إذا ماكو نتائج بعد الفلترة، نجرب "contains" فقط كخطة بديلة
    if (scored.length === 0) {
        const fallback = (compatDatabase || []).filter(row => {
            const txtNorm = normalizeString(pickCompatText(row) || pickItemName(row));
            return txtNorm.includes(q);
        }).slice(0, 80).map(row => ({ row, score: 1 }));
        displayCompatResults(fallback);
        return;
    }

    displayCompatResults(scored);
}

/* =============================================================== */

// إخفاء الحاوية عند تفريغ حقل البحث
function searchItems() {
    const searchInput = document.getElementById("searchInput").value.trim();
    const resultsContainer = document.getElementById("results");

    if (!searchInput) {
        resultsContainer.style.display = 'none';
      showExitLikeAlert({
  icon: "fas fa-exclamation-circle",
  title: "حقل فارغ",
  message: "يرجى كتابة اسم العنصر قبل المتابعة",
  confirmText: "موافق"
});

        return;
    }

if (!currentCategory) {
    resultsContainer.style.display = 'none';

    Swal.fire({
        html: `
            <div class="exit-shell">
                <div class="exit-icon">
                    <i class="fas fa-list-alt"></i>
                </div>
                <h2 class="exit-title">اختيار الصنف أولًا</h2>
                <p class="exit-text">
                    قبل ما نبحث، لازم تختار نوع القطعة من الشريط العلوي
                    (شاشات، بطاريات، شواصي، ...).
                </p>
            </div>
        `,
        confirmButtonText: 'تمام، راح أختار الصنف',
        backdrop: 'rgba(2, 6, 23, 0.82)',
        allowOutsideClick: true,
        allowEscapeKey: true,
        customClass: {
            popup: 'swal2-popup exit-popup animate__animated animate__zoomIn',
            confirmButton: 'exit-confirm'
        },
        hideClass: {
            popup: 'animate__animated animate__zoomOut'
        }
    });

    return;
}


    if (!database || !database[currentCategory] || database[currentCategory].length === 0) {
        resultsContainer.style.display = 'none';
      showExitLikeAlert({
  icon: "fas fa-database",
  title: "لا توجد بيانات",
  message: `لا توجد بيانات متاحة لفئة ${currentCategory}. يرجى تحديث الصفحة أو التحقق من الاتصال.`,
  confirmText: "موافق"
});

        return;
    }

    const query = normalizeString(searchInput);
    const results = database[currentCategory]?.filter(item => {
        const itemName = item["Item Name"] || item["Item"];
        if (!itemName) {
            console.warn(`عنصر بدون اسم في فئة ${currentCategory}:`, item);
            return false;
        }
        return normalizeString(itemName).includes(query);
    }) || [];

    if (results.length === 0) {
        console.log(`لا توجد نتائج مطابقة في فئة ${currentCategory} للبحث: ${query}`);
    } else {
        console.log(`تم العثور على ${results.length} نتيجة في فئة ${currentCategory}:`, results);
    }

    displayResults(results);
}


// دالة الرجوع لأعلى الصفحة
function scrollToTop() {
    window.scrollTo({
        top: 0,
        behavior: 'smooth' // تمرير سلس
    });
}

// التحكم بظهور الزر بناءً على التمرير وعدد النتائج
function toggleScrollToTopButton() {
    const scrollBtn = document.getElementById("scrollToTopBtn");
    const scrollPosition = window.scrollY; // موقع التمرير الحالي
    const results = document.getElementById("results");
    const resultCount = results.children.length; // عدد النتائج

    // الشرط: يظهر الزر إذا كانت هناك نتائج (حتى لو واحدة) وتم التمرير لأسفل أكثر من 100 بكسل
    if (resultCount > 0 && scrollPosition > 100) {
        scrollBtn.classList.add("show-scroll-btn");
    } else {
        scrollBtn.classList.remove("show-scroll-btn");
    }
}


// ربط الزر بالنقر
document.getElementById("scrollToTopBtn").addEventListener("click", scrollToTop);

// الاستماع لحدث التمرير
window.addEventListener("scroll", toggleScrollToTopButton);

// تحديث حالة الزر عند التحميل الأولي
document.addEventListener("DOMContentLoaded", toggleScrollToTopButton);

async function confirmExit() {
    const result = await Swal.fire({
        html: `
            <div class="exit-shell">
                <div class="exit-icon">
                    <i class="fas fa-sign-out-alt"></i>
                </div>
                <h2 class="exit-title">تأكيد الخروج</h2>
                <p class="exit-text">
                    مكتب عسل يتمنّى لك يومًا جميلًا.
هل أنت متأكّد من الخروج؟ 
                </p>
            </div>
        `,
        showCancelButton: true,
        confirmButtonText: 'نعم، خروج',
        cancelButtonText: 'رجوع',
        focusCancel: true,
        backdrop: 'rgba(2, 6, 23, 0.82)',            // ✅ طبقة ظلال ناعمة خلف النافذة
        allowOutsideClick: false,
        allowEscapeKey: true,
        customClass: {
            popup: 'swal2-popup exit-popup animate__animated animate__zoomIn',
            confirmButton: 'exit-confirm',
            cancelButton: 'exit-cancel'
        },
        hideClass: {
            popup: 'animate__animated animate__zoomOut'
        },
        didOpen: () => {
            const popup = document.querySelector('.swal2-popup.exit-popup');
            if (popup) popup.style.zIndex = '10000';
        }
    });

    if (result.isConfirmed) {
        // إغلاق التطبيق / التبويب
        window.close();
    }
}



function openToolsPage() {
    window.location.href = 'tools.html'; // استبدل 'tools.html' بالرابط إلى الصفحة الجديدة
}


 // دالة لتحويل المستخدم إلى صفحة lcd.html
        function openLCDPage() {
            window.location.href = 'lcd.html';
        }



async function refreshData() {
    // 🌐 نافذة "جاري التحديث" – تصميم عالمي + ظل خلفي
    Swal.fire({
        html: `
            <div class="update-shell">
                <span class="update-chip">تحديث البيانات</span>

                <div class="update-ring">
                    <div class="update-ring-inner">
                        <i class="fas fa-database"></i>
                    </div>
                </div>

                <h2 class="update-title">نحدّث ملف المخزن الآن</h2>
                <p class="update-subtitle">
                    نسحب آخر نسخة من السيرفر ونحدث الأسعار،
                    ونرتّب العناصر الجديدة حتى تبقى كل بياناتك محدثة بدقة.
                </p>
            </div>
        `,
        showConfirmButton: false,
        allowOutsideClick: false,
        backdrop: 'rgba(2, 6, 23, 0.82)',   // ✅ طبقة ظلال قوية على الخلفية
        customClass: {
            popup: 'update-dialog animate__animated animate__fadeInDown'
        }
    });

    // نخلي المستخدم يحس أن أكو "شغل" حتى لو الملف قرأ بسرعة
    const loadingPromise   = new Promise(resolve => setTimeout(resolve, 3000));
    const loadFilesPromise = loadExcelFiles();

    const [_, loadResult] = await Promise.all([loadingPromise, loadFilesPromise]);

    // ✅ التعديل المطلوب: إذا فشل التحميل/ماكو بيانات لا تكمل ولا تطلع "تم تحديث البيانات"
    if (!loadResult || loadResult.success === false || !loadResult.hasData) {
        // سكّر نافذة جاري التحديث
        Swal.close();

        // طلع رسالة فشل (مثل نافذة الخروج) — لازم تكون عندك دالة showExitLikeAlert
        showExitLikeAlert({
            icon: "fas fa-wifi",
            title: "فشل التحديث",
            message: (loadResult && loadResult.message)
                ? loadResult.message
                : "تعذر تحميل البيانات. تحقق من الاتصال وحاول مرة ثانية.",
            confirmText: "موافق"
        });

        return; // ✅ مهم: يمنع ظهور نافذة "تم تحديث البيانات"
    }

    await loadNewItems();

    // نغلق نافذة التحميل (الأولى فقط)
    Swal.close();

    // ✅ نافذة "تم التحديث" – أنيقة + الظلال تبقى لحد إعادة تحميل الصفحة
    Swal.fire({
        html: `
            <div class="update-success-shell">
                <div class="update-success-icon">
                    <i class="fas fa-check"></i>
                </div>
                <h2 class="update-success-title">تم تحديث البيانات</h2>
                <p class="update-success-text">
                    كل شيء جاهز الآن. تم قراءة الملفات وتحديث المخزون
                    ويمكنك تكمل شغلك على أحدث نسخة من البيانات.
                </p>
            </div>
        `,
        showConfirmButton: false,
        allowOutsideClick: false,
        backdrop: 'rgba(2, 6, 23, 0.82)',   // نفس طبقة الظلال
        customClass: {
            popup: 'update-success-dialog animate__animated animate__fadeInUp'
        },
        // ملاحظة: ما نستخدم timer هنا، نتحكم يدويًا بالوقت تحت
        didOpen: () => {
            setTimeout(() => {
                // نخزّن حالة التحديث
                sessionStorage.setItem('hasUpdated', true);
                console.log('Data updated and session state saved successfully.');

                // نعيد تحميل الصفحة مباشرة
                // ⚠️ ما نستخدم Swal.close() هنا حتى لا يصير فرق بين الظلال والنافذة
                location.reload();
            }, 1700); // المدة اللي تبقى بيها نافذة النجاح ظاهرة
        }
    });
}




        
        loadExcelFiles();

 let newsInterval = null;

async function fetchTechNews() {
  // RSS شغال (بديل عن AITnews لأن feed مالته صار مو RSS)
  const FEED = "https://taqniatimes.com/rss/category/latest-news";

  const ticker = document.getElementById("newsTicker");
  if (!ticker) return;

  // JSONP helper (يتجاوز CORS لأن يعتمد <script>)
  function jsonp(url, callbackParam = "callback", timeoutMs = 15000) {
    return new Promise((resolve, reject) => {
      const cb = "__rss_cb_" + Date.now() + "_" + Math.random().toString(16).slice(2);
      const script = document.createElement("script");
      const sep = url.includes("?") ? "&" : "?";

      const timer = setTimeout(() => {
        cleanup();
        reject(new Error("JSONP timeout"));
      }, timeoutMs);

      function cleanup() {
        clearTimeout(timer);
        try { delete window[cb]; } catch (_) { window[cb] = undefined; }
        if (script.parentNode) script.parentNode.removeChild(script);
      }

      window[cb] = (data) => {
        cleanup();
        resolve(data);
      };

      script.onerror = () => {
        cleanup();
        reject(new Error("JSONP script blocked/failed"));
      };

      script.src = `${url}${sep}${callbackParam}=${encodeURIComponent(cb)}&_=${Date.now()}`;
      document.head.appendChild(script);
    });
  }

  try {
    // rss2json يدعم JSONP عن طريق callback
    const apiUrl =
      `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(FEED)}&count=10`;

    const data = await jsonp(apiUrl, "callback");

    if (!data || (data.status && data.status !== "ok")) {
      throw new Error((data && data.message) || "rss2json status not ok");
    }

    const items = Array.isArray(data.items) ? data.items : [];
    const icon = "https://cdn-icons-png.flaticon.com/16/1041/1041916.png";

    const html = items.slice(0, 10).map((item) => {
      const title = item.title || "خبر";
      const link = item.link || "#";
      return `<span><img src="${icon}" alt="📢">
        <a href="${link}" target="_blank" rel="noopener noreferrer">${title}</a></span>`;
    }).join(" | ");

    ticker.innerHTML = html || "⚠️ ماكو أخبار حالياً";
  } catch (e) {
    console.error("TechNews error:", e);
    ticker.textContent = "⚠️ تعذر تحميل الأخبار حالياً";
  }
}


function restartNewsTicker() {
    const ticker = document.querySelector(".news-ticker");
    const resultsContainer = document.getElementById("results");

    if (ticker && resultsContainer.style.display !== "flex") { // فقط إذا النتائج مو معروضة
        ticker.style.animation = "none";
        void ticker.offsetWidth;
        ticker.style.animation = "scrollText 60s linear infinite";
    }
}

function refreshNewsTicker() {
    const resultsContainer = document.getElementById("results");

    if (resultsContainer.style.display !== "flex") { // فقط إذا النتائج مو معروضة
        fetchTechNews(); // جلب الأخبار
        restartNewsTicker(); // إعادة تشغيل الحركة
    }
}

// دوال التحكم بالتحديث
function startNewsUpdates() {
    if (!newsInterval) {
        newsInterval = setInterval(fetchTechNews, 60000); // تحديث كل دقيقة
    }
}

function stopNewsUpdates() {
    if (newsInterval) {
        clearInterval(newsInterval);
        newsInterval = null;
    }
}

// التشغيل الأولي والتحكم
fetchTechNews(); // تحميل أولي
startNewsUpdates();

// ربط التحكم مع عرض النتائج
document.getElementById("results").addEventListener("transitionend", () => {
    if (document.getElementById("results").style.display === "flex") {
        stopNewsUpdates();
    } else {
        startNewsUpdates();
    }
});

// التعامل مع الأحداث الأخرى
document.addEventListener("click", function(event) {
    if (event.target.closest(".swal2-popup") || event.target.classList.contains("swal2-close") || 
        event.target.classList.contains("swal2-confirm") || event.target.classList.contains("swal2-cancel")) {
        setTimeout(refreshNewsTicker, 500); // تحديث الأخبار بعد إغلاق النافذة
    }
});

window.addEventListener("pageshow", function() {
    refreshNewsTicker(); // إعادة تشغيل الأخبار بعد العودة
});

window.addEventListener("load", function() {
    refreshNewsTicker(); // إعادة تشغيل الأخبار عند التحميل
});


let cart = JSON.parse(localStorage.getItem("assal_cart") || "[]");

function escapeHtml(s){
  return String(s ?? "")
    .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
    .replaceAll('"',"&quot;").replaceAll("'","&#039;");
}
function moneyIQD(n){
  n = Math.max(0, Math.round(Number(n)||0));
  return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + " د.ع";
}
function saveCart(){
  localStorage.setItem("assal_cart", JSON.stringify(cart));
  updateCartHeader();
  renderCart();
}

function updateCartHeader(){
  const count = cart.reduce((s,it)=> s + it.qty, 0);
  const badge = document.getElementById("cartCount");
  const sub = document.getElementById("cartSubtitle");
  if(badge) badge.textContent = String(count);
  if(sub) sub.textContent = `${count} عنصر`;
}

function addToCart({name, category, price, img}){
  name = String(name||"").trim();
  category = String(category||"").trim();
  price = Number(price)||0;

  if(!name || price <= 0) return;

  const id = (category + "||" + name).toLowerCase();
  const found = cart.find(x=>x.id === id);

  if(found) found.qty += 1;
  else cart.push({ id, name, category, price, img: img||"", qty: 1 });

  saveCart();
}

function incQty(id){ const it = cart.find(x=>x.id===id); if(it){ it.qty = Math.min(99, it.qty+1); saveCart(); } }
function decQty(id){ const it = cart.find(x=>x.id===id); if(it){ it.qty = Math.max(1, it.qty-1); saveCart(); } }
function removeItem(id){ cart = cart.filter(x=>x.id!==id); saveCart(); }

function calcTotals(){
  const subtotal = cart.reduce((s,it)=> s + it.price*it.qty, 0);
  const disc = Math.max(0, Number(document.getElementById("cartDiscount")?.value || 0));
  const total = Math.max(0, subtotal - disc);
  return { subtotal, disc, total };
}

function renderCart(){
  const box = document.getElementById("cartItems");
  if(!box) return;

  if(cart.length === 0){
    box.innerHTML = `
      <div class="cart-item" style="grid-template-columns:1fr; text-align:center;">
        <div class="cart-name" style="text-align:center;">السلة فارغة حالياً 🙃</div>
        <div class="cart-sub" style="justify-content:center;">ضيف عناصر من النتائج حتى نطلع فاتورة.</div>
      </div>
    `;
  } else {
    box.innerHTML = cart.map(it=>{
      const line = it.price * it.qty;
      return `
        <div class="cart-item">
          <img src="${it.img || 'images/default.png'}" onerror="this.src='images/default.png'" alt="img">
          <div class="cart-info">
            <div class="cart-name">${escapeHtml(it.name)}</div>
            <div class="cart-sub">
              <span class="cart-chip">${escapeHtml(it.category)}</span>
              <span class="cart-chip">سعر: ${moneyIQD(it.price)}</span>
            </div>
          </div>
          <div class="cart-side">
            <div class="cart-line-total">${moneyIQD(line)}</div>
            <div class="qty">
              <button type="button" data-act="dec" data-id="${escapeHtml(it.id)}">-</button>
              <div class="qv">${it.qty}</div>
              <button type="button" data-act="inc" data-id="${escapeHtml(it.id)}">+</button>
            </div>
            <button type="button" class="cart-rm" data-act="rm" data-id="${escapeHtml(it.id)}" title="حذف">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>
      `;
    }).join("");
  }

  const { subtotal, total } = calcTotals();
  document.getElementById("cartSubtotal").textContent = moneyIQD(subtotal);
  document.getElementById("cartTotal").textContent = moneyIQD(total);
  updateCartHeader();
}

/* فتح/غلق */
function openCart(){
  document.getElementById("cartModal").style.display = "block";
  document.getElementById("cartModal").setAttribute("aria-hidden","false");
  const ov = document.getElementById("overlay");
  if(ov) ov.style.display = "block";
  renderCart();
}
function closeCart(){
  document.getElementById("cartModal").style.display = "none";
  document.getElementById("cartModal").setAttribute("aria-hidden","true");
  const ov = document.getElementById("overlay");
  if(ov) ov.style.display = "none";
}

/* Events */
document.addEventListener("DOMContentLoaded", ()=>{
  updateCartHeader();
  renderCart();

  document.getElementById("openCartBtn")?.addEventListener("click", openCart);
  document.getElementById("closeCartBtn")?.addEventListener("click", closeCart);
  document.getElementById("overlay")?.addEventListener("click", closeCart);

  document.getElementById("cartDiscount")?.addEventListener("input", renderCart);

  document.getElementById("clearCartBtn")?.addEventListener("click", ()=>{
    cart = [];
    saveCart();
  });

  // أزرار + - حذف داخل السلة
  document.getElementById("cartItems")?.addEventListener("click", (e)=>{
    const btn = e.target.closest("[data-act]");
    if(!btn) return;
    const act = btn.dataset.act;
    const id = btn.dataset.id;

    if(act === "inc") incQty(id);
    if(act === "dec") decQty(id);
    if(act === "rm")  removeItem(id);
  });

  // زر الإضافة الصغير داخل النتائج (بدون onclick داخل HTML)
  document.getElementById("results")?.addEventListener("click", (e)=>{
    const b = e.target.closest(".add-mini");
    if(!b) return;
    addToCart({
      name: decodeURIComponent(b.dataset.name || ""),
      category: decodeURIComponent(b.dataset.category || ""),
      price: Number(b.dataset.price || 0),
      img: b.dataset.img || ""
    });
  });
});

function moneyIQD(n){
  n = Math.max(0, Math.round(Number(n)||0));
  return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + " IQD";
}

function escapeHtml(s){
  return String(s ?? "")
    .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
    .replaceAll('"',"&quot;").replaceAll("'","&#039;");
}

function buildInvoiceHTML({invNo, dateStr, subtotal, discount, total, note=""}){
  const el = document.getElementById("invoiceTemplate");
  if(!el) throw new Error("invoiceTemplate missing");

  const rows = cart.map((it, idx)=>{
    const line = (Number(it.price)||0) * (Number(it.qty)||0);
    return `
      <tr>
        <td class="td-idx">${idx+1}</td>
        <td class="td-cat">${escapeHtml(it.category || "")}</td>
        <td class="td-name">
          <div class="nm">${escapeHtml(it.name)}</div>
        </td>
        <td class="td-num td-qty">${it.qty}</td>
        <td class="td-num td-price">${moneyIQD(it.price)}</td>
        <td class="td-num td-total td-strong">${moneyIQD(line)}</td>
      </tr>
    `;
  }).join("");

  el.innerHTML = `
    <style>
      #invoiceTemplate{ background:#fff; }
      *{ box-sizing:border-box; }

      .inv-doc{
        width: 100%;
        max-width: 920px;
        margin: 0 auto;
        padding: 26px 28px 24px;
        font-family: "Cairo", ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Noto Sans Arabic", "Noto Kufi Arabic", sans-serif;
        border-radius:24px;
        overflow:hidden;
        border:1px solid #e5e7eb;
        box-shadow: 0 18px 42px rgba(2,6,23,.10);

        direction: rtl;
        unicode-bidi: plaintext;
        font-kerning: normal;
        font-feature-settings: "kern" 1, "liga" 1;
      }

      /* ===== HEADER ===== */
      .hdr-top{
        background: linear-gradient(135deg,#0b1220 0%, #111827 45%, #0b1220 100%);
        padding:18px 18px 16px;
        position:relative;
        border-radius:22px;              /* ✅ حواف لطيفة */
      }
      .hdr-top:before{
        content:"";
        position:absolute;
        inset:-120px -120px auto auto;
        width:260px;
        height:260px;
        background: radial-gradient(circle at center, rgba(255,255,255,.18), rgba(255,255,255,0) 60%);
        transform: rotate(12deg);
        pointer-events:none;
      }
      .hdr-top:after{
        content:"";
        position:absolute;
        inset:auto auto -140px -140px;
        width:300px;height:300px;
        background: radial-gradient(circle at center, rgba(255,255,255,.10), rgba(255,255,255,0) 65%);
        pointer-events:none;
      }

      .hdr-row{
        display:flex;
        justify-content:space-between;
        align-items:center;
        gap:14px;
        position:relative;
        z-index:1;
      }

      .brand{
        display:flex;
        align-items:center;
        gap:12px;
        min-width: 0;
        flex: 1 1 auto;                 /* ✅ حتى ياخذ مساحة ويمنع نزول */
      }

      .logo{
        width:52px;height:52px;
        border-radius:18px;
        background:#fff;
        display:flex;align-items:center;justify-content:center;
        overflow:hidden;
        box-shadow: 0 10px 22px rgba(0,0,0,.22);
        flex:0 0 auto;
      }
      .logo img{ width:100%;height:100%;object-fit:contain; }

      .brandTxt{ min-width:0; }
      .bname{
        font-weight:900;
        font-size:18px;
        letter-spacing:.2px;
        color:#fff;
        line-height:1.15;

        white-space:nowrap;             /* ✅ سطر واحد */
        overflow:hidden;
        text-overflow:ellipsis;
      }
      .btag{
        margin-top:6px;
        color:rgba(255,255,255,.72);
        font-size:12.5px;
        line-height:1.35;

        white-space:nowrap;             /* ✅ سطر واحد */
        overflow:hidden;
        text-overflow:ellipsis;
      }

      .inv-badge{
        color:#fff;
        min-width: 220px;
        text-align:left;
        flex: 0 0 auto;
      }
      .inv-badge .cap{
        font-size:12px;
        letter-spacing:.18em;
        text-transform:uppercase;
        font-weight:900;
        color:rgba(255,255,255,.75);
      }
      .inv-badge .no{
        margin-top:6px;
        font-size:18px;
        font-weight:900;
        letter-spacing:.02em;

        white-space:nowrap;             /* ✅ سطر واحد */
        overflow:hidden;
        text-overflow:ellipsis;
        max-width: 100%;
      }
      .inv-badge .pill{
        margin-top:10px;
        display:inline-flex;
        align-items:center;
        gap:8px;
        padding:6px 10px;
        border-radius:999px;
        border:1px solid rgba(255,255,255,.18);
        background: rgba(255,255,255,.08);
        color:rgba(255,255,255,.92);
        font-weight:800;
        font-size:11.5px;
        letter-spacing:.06em;
        text-transform:uppercase;
        white-space:nowrap;
      }
      .dot{ width:8px;height:8px;border-radius:999px; background:#34d399; }

      .hdr-bottom{
        background: linear-gradient(180deg,#ffffff 0%, #f8fafc 100%);
        padding:12px 16px;
        display:flex;
        justify-content:center;         /* ✅ وسط الفاتورة */
        align-items:center;
        gap:10px;
        flex-wrap:wrap;
      }

      .meta{
        display:flex;
        gap:10px;
        flex-wrap:wrap;
        align-items:center;
        justify-content:center;         /* ✅ وسط */
        width:100%;
      }

      .kv{
        background:#fff;
        border:1px solid #e5e7eb;
        border-radius:16px;
        padding:8px 10px;
        min-width: 160px;
        box-shadow: 0 10px 22px rgba(2,6,23,.05);
        text-align:center;              /* ✅ نص بالنص */
      }
      .kv .k{
        color:#64748b;
        font-size:11px;
        letter-spacing:.10em;
        text-transform:uppercase;
        font-weight:900;
      }
      .kv .v{
        margin-top:6px;
        font-size:13px;
        font-weight:900;
        color:#0b1220;
        white-space:nowrap;
        overflow:hidden;
        text-overflow:ellipsis;
      }

      .accent{
        height: 7px;
        border-radius: 999px;
        background: linear-gradient(90deg,#0b1220 0%,#334155 45%,#0b1220 100%);
        margin: 12px 0 14px;
        opacity:.92;
      }

      /* ===== PANELS ===== */
      .panels{
        display:grid;
        grid-template-columns: 1.2fr .8fr;
        gap:12px;
        margin-bottom:12px;
      }
      .card{
        border:1px solid #e5e7eb;
        border-radius:22px;
        padding:12px 14px;
        background:#fff;
        box-shadow: 0 12px 28px rgba(2,6,23,.04);
      }
      .card .h{
        font-weight:900;
        font-size:12.5px;
        letter-spacing:0;
        text-transform:none;
        color:#0b1220;
        display:flex;
        align-items:center;
        gap:8px;
        margin-bottom:8px;
      }
      .card .p{
        color:#475569;
        font-size:12.6px;
        line-height:1.65;
        margin: 4px 0;
        word-break: break-word;
      }
      .cardDot{ width:8px;height:8px;border-radius:999px;background:#0b1220;opacity:.9; }

      /* ===== TABLE ===== */
      .tbl-wrap{
        width:100%;
        overflow-x:auto;
        -webkit-overflow-scrolling: touch;
        border-radius:22px;
      }

      .tbl{
        width:100%;
        min-width:0;
        table-layout:fixed;
        border-collapse:separate;
        border-spacing:0;
        border:1px solid #e5e7eb;
        border-radius:22px;
        overflow:hidden;
        box-shadow: 0 16px 36px rgba(2,6,23,.06);
        background:#fff;
      }
      .tbl thead th{
        background: linear-gradient(180deg,#0b1220 0%,#111827 100%);
        color:#fff;
        padding:10px 8px;
        font-size:12px;
        letter-spacing:0;
        text-transform:none;
        font-weight:900;
        border-bottom:1px solid rgba(255,255,255,.10);
        white-space:nowrap;
      }
      .tbl tbody td{
        padding:6px 8px;
        font-size:12.7px;
        border-bottom:1px solid #eef2f7;
        background:#fff;
        vertical-align:middle;
        line-height:1.15;
      }
      .tbl tbody tr:nth-child(even) td{ background:#f9fafb; }
      .tbl tbody tr:last-child td{ border-bottom:none; }

      .td-idx{ width:52px; text-align:center; font-weight:900; color:#0b1220; }
      .td-cat{ width:120px; color:#334155; font-weight:800; }
      .td-name .nm{
        font-weight:900;
        color:#0b1220;
        white-space:nowrap;
        overflow:hidden;
        text-overflow:ellipsis;
        max-width: 9999px;
      }
      .td-qty{ width:74px; }
      .td-price{ width:96px; }
      .td-total{ width:132px; }

      .td-num{
        text-align:center;
        font-variant-numeric: tabular-nums;
        white-space:nowrap;
        font-weight:800;
        color:#0b1220;
      }
      .td-strong{ font-weight:900; }

      /* ===== BOTTOM ===== */
      .bottom{
        display:flex;
        justify-content:space-between;
        align-items:flex-start;
        gap:12px;
        margin-top:12px;
      }
      .terms{
        flex:1 1 auto;
        border:1px dashed #cbd5e1;
        border-radius:22px;
        padding:12px 14px;
        background: linear-gradient(180deg,#ffffff 0%,#f8fafc 100%);
      }
      .terms .h{
        font-weight:900;
        font-size:12.5px;
        letter-spacing:0;
        text-transform:none;
        color:#0b1220;
        display:flex;
        align-items:center;
        gap:8px;
        margin-bottom:8px;
      }
      .terms ul{
        margin:0;
        padding:0 18px 0 0;
        color:#475569;
        font-size:12.4px;
        line-height:1.75;
      }

      .sum{
        flex:0 0 320px;
        border-radius:22px;
        padding:10px 14px;
        background: linear-gradient(180deg,#0b1220 0%,#111827 100%);
        color:#fff;
        box-shadow: 0 18px 40px rgba(2,6,23,.14);
      }
      .sum .row{
        display:flex;
        justify-content:space-between;
        align-items:center;
        padding:6px 0;
        border-bottom:1px solid rgba(255,255,255,.12);
        font-variant-numeric: tabular-nums;
        line-height:1.15;
      }
      .sum .row:last-child{ border-bottom:none; }
      .sum .row span{ color: rgba(255,255,255,.82); font-weight:800; }
      .sum .row strong{ font-weight:900; white-space:nowrap; }
      .sum .total{
        margin-top:4px;
        padding-top:8px;
        border-top:1px solid rgba(255,255,255,.16);
      }
      .sum .total strong{ font-size:16px; }

      .foot{
        margin-top:14px;
        display:flex;
        justify-content:space-between;
        align-items:center;
        gap:12px;
        color:#64748b;
        font-size:12px;
        flex-wrap:wrap;
      }
      .chip{
        padding:6px 10px;
        border-radius:999px;
        border:1px solid #e5e7eb;
        background:#fff;
        color:#0b1220;
        font-weight:900;
        letter-spacing:.10em;
        text-transform:uppercase;
        font-size:10.8px;
      }

      /* ===== RESPONSIVE (Mobile) ===== */
      @media (max-width: 640px){
        .inv-doc{
          padding: 14px 12px 12px;
          border-radius:18px;
        }

        .hdr-top{
          padding:14px 14px 12px;
          border-radius:26px;
        }

        .hdr-row{
          flex-direction:row;
          align-items:center;
          gap:10px;
          flex-wrap:nowrap;
        }

        .brand{ flex: 1 1 auto; }
        .inv-badge{
          flex: 0 0 auto;
          min-width: 150px;
          text-align:left;
        }

        .inv-badge .cap{ font-size:10.5px; }
        .inv-badge .no{ font-size:14px; margin-top:4px; }
        .inv-badge .pill{ margin-top:6px; padding:5px 8px; font-size:10.5px; }

        .bname{ font-size:15px; }
        .btag{ font-size:11.5px; }

        .kv{
          min-width: 140px;
          padding:7px 9px;
        }
        .kv .v{ font-size:12.5px; }

        .panels{ grid-template-columns: 1fr; }

        .bottom{ flex-direction:column; }
        .terms{ width:100%; }

        /* ✅ هذا هو التعديل الأساسي لمنع الفراغ */
        .sum{
          width:100%;
          flex: 0 0 auto;   /* يمنع 320px تصير ارتفاع */
          height:auto;
          align-self: stretch;
          padding:10px 14px;
        }
      }
    </style>

    <div class="inv-doc" dir="rtl" lang="ar">

      <div class="hdr-top">
        <div class="hdr-row">
          <div class="brand">
            <div class="logo">
              <img src="images/logo.png" onerror="this.style.display='none'">
            </div>
            <div class="brandTxt">
              <div class="bname">Assal Office</div>
              <div class="btag">فاتورة مبيعات رسمية • قطع موبايل • إصدار نظام السلة</div>
            </div>
          </div>

          <div class="inv-badge">
            <div class="cap">Sales Invoice</div>
            <div class="no">${escapeHtml(invNo)}</div>
            <div class="pill"><span class="dot"></span> ISSUED</div>
          </div>
        </div>
      </div>

      <div class="hdr-bottom">
        <div class="meta">
          <div class="kv">
            <div class="k">Date</div>
            <div class="v">${escapeHtml(dateStr)}</div>
          </div>
          <div class="kv">
            <div class="k">Currency</div>
            <div class="v">IQD</div>
          </div>
          <div class="kv">
            <div class="k">Reference</div>
            <div class="v">${escapeHtml(invNo)}</div>
          </div>
        </div>
      </div>

      <div class="accent"></div>

      <div class="panels">
        <div class="card">
          <div class="h"><span class="cardDot"></span> معلومات</div>
          <div class="p">هذه الفاتورة مُنشأة من نظام السلة داخل الموقع وتُعتمد كإثبات شراء.</div>
          <div class="p">يرجى الاحتفاظ بها للضمان/المراجعة، ويمكن تقديمها عند الاستبدال أو الصيانة.</div>
        </div>
        <div class="card">
          <div class="h"><span class="cardDot"></span> ملاحظة</div>
          <div class="p">${escapeHtml(note || "—")}</div>
        </div>
      </div>

      <div class="tbl-wrap">
        <table class="tbl">
          <thead>
            <tr>
              <th style="width:52px;">تسلسل</th>
              <th style="width:120px; text-align:right;">الصنف</th>
              <th style="text-align:right;">اسم المادة</th>
              <th style="width:74px;">العدد</th>
              <th style="width:96px;">السعر</th>
              <th style="width:132px;">الإجمالي</th>
            </tr>
          </thead>
          <tbody>
            ${rows}
          </tbody>
        </table>
      </div>

      <div class="bottom">
        <div class="terms">
          <div class="h"><span class="cardDot"></span> الشروط</div>
          <ul>
            <li>الأسعار حسب ما ظاهر في السلة وقت إصدار الفاتورة.</li>
            <li>الضمان/الاستبدال يعتمد على نوع القطعة وحالتها.</li>
            <li>الاحتفاظ بالفاتورة يسرّع خدمة المراجعة والمتابعة.</li>
          </ul>
        </div>

        <div class="sum">
          <div class="row"><span>المجموع</span><strong>${moneyIQD(subtotal)}</strong></div>
          <div class="row"><span>الخصم</span><strong>${moneyIQD(discount)}</strong></div>
          <div class="total">
            <div class="row"><span>الإجمالي</span><strong>${moneyIQD(total)}</strong></div>
          </div>
        </div>
      </div>

      <div class="foot">
        <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;">
          <span class="chip">Thank you</span>
          <div>شكراً لتعاملكم ويانه 🤍</div>
        </div>
        <div>© ${new Date().getFullYear()} Assal Office</div>
      </div>
    </div>
  `;
}









function numOnlyIQD(n){
  n = Math.max(0, Math.round(Number(n)||0));
  return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}


async function exportInvoiceImagePNG(filename){
  const el = document.getElementById("invoiceTemplate");
  if(!el) throw new Error("invoiceTemplate missing");

  const parent = el.parentNode;
  const next = el.nextSibling;
  const prevStyle = el.getAttribute("style") || "";

  const stage = document.createElement("div");
  stage.style.cssText = `
    position: fixed; inset: 0;
    background: #fff;
    z-index: 2147483647;
    overflow: auto;
    padding: 16px;
  `;
  document.body.appendChild(stage);
  stage.appendChild(el);

  el.style.display = "block";
  el.style.position = "relative";
  el.style.left = "0";
  el.style.top = "0";
  el.style.opacity = "1";
  el.style.pointerEvents = "none";

  await new Promise(r => requestAnimationFrame(() => requestAnimationFrame(r)));
  if (document.fonts?.ready) { try { await document.fonts.ready; } catch(_){} }

  const imgs = [...el.querySelectorAll("img")];
  await Promise.all(imgs.map(img => img.complete ? Promise.resolve() : new Promise(res=>{
    img.onload = img.onerror = () => res();
  })));

 const dpr = Math.min(window.devicePixelRatio || 1, 3);
const scale = (window.innerWidth <= 600) ? (2.0 * dpr) : (2.5 * dpr);

  const canvas = await html2canvas(el, {
    scale,
    backgroundColor: "#ffffff",
    useCORS: true,
    allowTaint: true,
    imageTimeout: 15000
  });

  // رجّع العنصر لمكانه
  stage.remove();
  if (next) parent.insertBefore(el, next); else parent.appendChild(el);
  el.setAttribute("style", prevStyle);

  // ✅ هذا أهم تغيير: نخليها DataURL حتى تنعرض داخل WebView
  const dataUrl = canvas.toDataURL("image/png");

  // اعرض Preview داخل التطبيق
  showImagePreviewDataUrl(dataUrl, filename);

  // إذا مشاركة الملفات متاحة (مو دائماً بالـWebView) نخليها اختيارية من زر Share داخل الـPreview
}


function showImagePreviewDataUrl(dataUrl, filename){
  document.getElementById("imgPrevOverlay")?.remove();

  const ov = document.createElement("div");
  ov.id = "imgPrevOverlay";
  ov.style.cssText = `
    position: fixed; inset: 0; z-index: 2147483647;
    background: rgba(0,0,0,.70);
    display:flex; align-items:center; justify-content:center;
    padding: 12px;
  `;

  ov.innerHTML = `
    <div style="
      width:min(560px, 96vw);
      height: min(92vh, 980px);
      background:#0b1220;
      border:1px solid rgba(255,255,255,.12);
      border-radius:18px;
      padding:12px;
      color:#fff;
      display:flex;
      flex-direction:column;
      gap:10px;
    ">
      <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
        <div style="font-weight:900; font-size:14px;">Invoice Preview</div>

        <div style="display:flex; align-items:center; gap:10px;">
          <button id="imgPrevFull" type="button" title="Full Screen"
            style="
              padding:8px 12px;
              border-radius:999px;
              border:1px solid rgba(255,255,255,.18);
              background: rgba(255,255,255,.08);
              color:#fff;
              font-weight:900;
              cursor:pointer;
            ">
            Full Screen
          </button>

          <button id="imgPrevClose" type="button" aria-label="Close"
            style="
              width:34px; height:34px;
              border-radius:999px;
              border:1px solid rgba(255,255,255,.18);
              background: #b91c1c;
              color:#fff;
              display:flex; align-items:center; justify-content:center;
              font-size:20px;
              cursor:pointer;
              line-height:1;
              box-shadow: 0 10px 25px rgba(0,0,0,.35);
            ">
            ×
          </button>
        </div>
      </div>

      <div style="
        flex:1;
        overflow:auto;
        background:#ffffff;
        border-radius:14px;
        padding:10px;
        -webkit-overflow-scrolling: touch;
        touch-action: manipulation;
      ">
        <img src="${dataUrl}" alt="Invoice"
             style="width:100%; height:auto; display:block; max-width:900px; margin:0 auto; image-rendering:auto;" />
      </div>

      <div dir="rtl" style="
        text-align:right;
        border-radius:14px;
        padding:10px 12px;
        background: rgba(255,255,255,.06);
        border: 1px solid rgba(255,255,255,.14);
      ">
        <span style="
          display:inline-block;
          padding:6px 10px;
          border-radius:999px;
          background:#7f1d1d;
          color:#fff;
          font-size:13px;
          font-weight:900;
          line-height:1.5;
          border:1px solid rgba(255,255,255,.12);
          margin-bottom:8px;
        ">
          ملاحظة
        </span>

        <div style="
          margin-top:6px;
          color: rgba(255,255,255,.92);
          font-size:13px;
          font-weight:700;
          line-height:1.7;
        ">
          يرجى أخذ سكرين للصورة وإرسالها إلينا عن طريق الواتساب
        </div>
      </div>
    </div>
  `;

  document.body.appendChild(ov);

  ov.querySelector("#imgPrevClose").onclick = ()=>ov.remove();
  ov.onclick = (e)=>{ if(e.target === ov) ov.remove(); };

  // ✅ Full Screen داخل نفس التطبيق + رجوع أنيق
  ov.querySelector("#imgPrevFull").onclick = ()=>{
    openFullImageOverlay(dataUrl, filename);
  };
}


function openFullImageOverlay(dataUrl, filename){
  document.getElementById("imgFullOverlay")?.remove();

  const f = document.createElement("div");
  f.id = "imgFullOverlay";
  f.style.cssText = `
    position: fixed; inset: 0; z-index: 2147483647;
    background: #fff;
    overflow: auto;
    -webkit-overflow-scrolling: touch;
  `;

  f.innerHTML = `
    <button id="imgFullBack" type="button" aria-label="Back" style="
      position: fixed;
      top: 12px;
      left: 12px;
      z-index: 2147483647;
      display:flex; align-items:center; gap:8px;
      padding:10px 12px;
      border-radius:999px;
      border:1px solid rgba(0,0,0,.12);
      background: rgba(255,255,255,.92);
      color:#111;
      font-weight:900;
      cursor:pointer;
      box-shadow: 0 10px 25px rgba(0,0,0,.20);
      backdrop-filter: blur(10px);
    ">
      ← Back
    </button>

    <div style="padding:10px;">
      <img src="${dataUrl}" alt="${filename || "Invoice"}"
        style="width:100%;max-width:1200px;height:auto;display:block;margin:0 auto;image-rendering:auto;" />
    </div>
  `;

  document.body.appendChild(f);

  const close = ()=> f.remove();
  f.querySelector("#imgFullBack").onclick = close;
}














function showImagePreview(url, filename){
  document.getElementById("imgPrevOverlay")?.remove();

  const ov = document.createElement("div");
  ov.id = "imgPrevOverlay";
  ov.style.cssText = `
    position: fixed; inset: 0; z-index: 2147483647;
    background: rgba(0,0,0,.65);
    display:flex; align-items:center; justify-content:center;
    padding: 14px;
  `;

  ov.innerHTML = `
    <div style="width:min(520px, 96vw); background:#0b1220; border:1px solid rgba(255,255,255,.12);
                border-radius:16px; padding:12px; color:#fff;">
      <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:10px;">
        <div style="font-weight:900; font-size:14px;">Saved: ${filename}</div>
        <button id="imgPrevClose" style="background:transparent;border:0;color:#fff;font-size:20px;cursor:pointer;">×</button>
      </div>

      <img src="${url}" alt="Invoice" style="width:100%; height:auto; border-radius:12px; background:#fff;" />

      <div style="display:flex; gap:10px; margin-top:12px;">
        <a href="${url}" target="_blank"
           style="flex:1; text-align:center; padding:10px 12px; border-radius:12px;
                  background: linear-gradient(135deg,#2563eb,#60a5fa); color:#fff; text-decoration:none; font-weight:900;">
          Open
        </a>
        <button id="imgPrevShare"
           style="flex:1; padding:10px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.16);
                  background: rgba(255,255,255,.06); color:#fff; font-weight:900;">
          Share
        </button>
      </div>

      <div style="opacity:.8; font-size:12px; margin-top:10px;">
        If it doesn't open outside the app, check <b>Downloads</b>.
      </div>
    </div>
  `;

  document.body.appendChild(ov);

  ov.querySelector("#imgPrevClose").onclick = ()=>ov.remove();
  ov.onclick = (e)=>{ if(e.target === ov) ov.remove(); };

  ov.querySelector("#imgPrevShare").onclick = async ()=>{
    try{
      if(!navigator.share) throw new Error("Share not supported");
      const resp = await fetch(url);
      const blob = await resp.blob();
      const file = new File([blob], filename, {type:"image/png"});
      await navigator.share({ files:[file], title: filename });
    }catch(_){
      alert("Share not available here. Open it from Downloads instead.");
    }
  };
}


document.addEventListener("DOMContentLoaded", () => {
  const imgBtn = document.getElementById("printImgBtn");
  if(!imgBtn) return;

  imgBtn.addEventListener("click", async ()=>{
    try{
      if(!window.html2canvas) throw new Error("html2canvas is not loaded");
      await checkoutImage();
    }catch(e){
      alert(e?.message || e);
    }
  });
});





async function exportInvoicePDF_AutoTable(filename, {invNo, dateStr, subtotal, discount, total, note}) {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ orientation: "p", unit: "pt", format: "a4" });
  const pageWidth = doc.internal.pageSize.getWidth();

  // Header (EN)
  doc.setFont("helvetica", "bold");
  doc.setFontSize(20);
  doc.text("ASSAL OFFICE", pageWidth/2, 50, { align: "center" });

  doc.setFont("helvetica", "normal");
  doc.setFontSize(11);
  doc.text("Sales Invoice - Mobile Parts", pageWidth/2, 70, { align: "center" });

  // Meta (EN)
  doc.setFontSize(11);
  doc.text(`Invoice: ${invNo}`, 50, 98);
  doc.text(`Date: ${dateStr}`, 50, 114);
  doc.text(`Currency: IQD`, 50, 130);

  // Table
  doc.autoTable({
    head: [["#", "Item", "Category", "Unit Price (IQD)", "Qty", "Line Total (IQD)"]],
    body: cart.map((it, i) => {
      const line = (Number(it.price)||0) * (Number(it.qty)||0);
      return [
        i+1,
        String(it.name || ""),
        String(it.category || ""),
        numOnlyIQD(it.price),
        String(it.qty || ""),
        numOnlyIQD(line)
      ];
    }),
    startY: 160,
    theme: "grid",
    styles: { halign: "center", font: "helvetica", fontSize: 10 },
    headStyles: { fontStyle: "bold" },
    margin: { left: 50, right: 50 }
  });

  // Summary (EN)
  const y = (doc.lastAutoTable && doc.lastAutoTable.finalY) ? doc.lastAutoTable.finalY + 20 : 180;
  doc.setFont("helvetica", "bold");
  doc.text("Summary", 50, y);

  doc.setFont("helvetica", "normal");
  doc.text(`Subtotal: ${numOnlyIQD(subtotal)} IQD`, 50, y + 18);
  doc.text(`Discount: ${numOnlyIQD(discount)} IQD`, 50, y + 34);
  doc.setFont("helvetica", "bold");
  doc.text(`Total: ${numOnlyIQD(total)} IQD`, 50, y + 54);

  // Note (EN)
  doc.setFont("helvetica", "normal");
  doc.setFontSize(10);
  doc.text(`Note: ${note ? String(note) : "-"}`, 50, y + 78);

  doc.save(filename);
}


async function exportInvoicePDF(filename){
  const el = document.getElementById("invoiceTemplate");
  if(!el) throw new Error("invoiceTemplate missing");

  // خليه يشتغل بدون ما يبين
  const prev = el.getAttribute("style") || "";
  el.style.display = "block";
  el.style.position = "fixed";
  el.style.left = "-9999px";
  el.style.top = "0";
  el.style.background = "#fff";

  if (document.fonts && document.fonts.ready) {
    try { await document.fonts.ready; } catch(_) {}
  }

  const canvas = await html2canvas(el, {
    scale: 1.5,                 // أقل من 2 حتى ما يصير ملف ضخم
    backgroundColor: "#ffffff",
    useCORS: true
  });

  const pdf = new window.jspdf.jsPDF({
    orientation: "p",
    unit: "pt",
    format: "a4",
    compress: true
  });

  const pageWidth  = pdf.internal.pageSize.getWidth();
  const pageHeight = pdf.internal.pageSize.getHeight();

  // تحويل “نقاط PDF” إلى “بكسلات canvas” حتى نقص الصفحة صح
  const pxPerPt = canvas.width / pageWidth;
  const pagePxHeight = Math.floor(pageHeight * pxPerPt);

  const pageCanvas = document.createElement("canvas");
  const pageCtx = pageCanvas.getContext("2d");

  let y = 0;
  let pageIndex = 0;

  while (y < canvas.height) {
    const sliceHeight = Math.min(pagePxHeight, canvas.height - y);

    pageCanvas.width = canvas.width;
    pageCanvas.height = sliceHeight;

    // خلفية بيضا
    pageCtx.fillStyle = "#ffffff";
    pageCtx.fillRect(0, 0, pageCanvas.width, pageCanvas.height);

    // قص جزء من الصورة الأصلية
    pageCtx.drawImage(
      canvas,
      0, y, canvas.width, sliceHeight,
      0, 0, canvas.width, sliceHeight
    );

    // JPEG مضغوط (أكثر توافقاً مع موبايلات)
    const imgData = pageCanvas.toDataURL("image/jpeg", 0.92);

    if (pageIndex > 0) pdf.addPage();

    const imgWidth = pageWidth;
    const imgHeight = (sliceHeight * imgWidth) / pageCanvas.width;

    pdf.addImage(imgData, "JPEG", 0, 0, imgWidth, imgHeight);

    y += sliceHeight;
    pageIndex++;
  }

  pdf.save(filename);

  // رجّع الستايل
  el.setAttribute("style", prev);
}


function calcTotalsForInvoice(){
  const subtotal = cart.reduce((s,it)=> s + (Number(it.price)||0) * (Number(it.qty)||0), 0);
  const discount = Math.max(0, Number(document.getElementById("cartDiscount")?.value || 0));
  const total = Math.max(0, subtotal - discount);
  return { subtotal, discount, total };
}


async function checkoutImage(){
  if(!cart || cart.length === 0){
    if(window.Swal) Swal.fire({icon:"info", title:"Cart is empty", text:"Add items to export an invoice image."});
    return;
  }

  const now = new Date();
  const invNo = "INV-" +
    now.getFullYear() +
    String(now.getMonth()+1).padStart(2,"0") +
    String(now.getDate()).padStart(2,"0") + "-" +
    String(now.getHours()).padStart(2,"0") +
    String(now.getMinutes()).padStart(2,"0");

  const { subtotal, discount, total } = calcTotalsForInvoice();

  const noteEl = document.getElementById("cartNote");
  const note = noteEl ? noteEl.value : "";

  // ✅ مهم: نبني الفاتورة قبل التصوير (هذا سبب البياض)
  buildInvoiceHTML({
    invNo,
    dateStr: now.toLocaleString("en-GB"),
    subtotal,
    discount,
    total,
    note
  });

  await exportInvoiceImagePNG(invNo + ".png");
}


async function checkoutPDF(){
  if(!cart || cart.length === 0){
    // إذا تستخدم SweetAlert2:
    if(window.Swal) Swal.fire({icon:"info", title:"السلة فارغة", text:"ضيف عناصر حتى نطبع فاتورة."});
    return;
  }

  const now = new Date();
  const invNo = "INV-" +
    now.getFullYear() +
    String(now.getMonth()+1).padStart(2,"0") +
    String(now.getDate()).padStart(2,"0") + "-" +
    String(now.getHours()).padStart(2,"0") +
    String(now.getMinutes()).padStart(2,"0");

  const { subtotal, discount, total } = calcTotalsForInvoice();

  // إذا عندك حقل ملاحظة بالسلة استعمله، إذا لا خلي فاضي:
  const noteEl = document.getElementById("cartNote");
  const note = noteEl ? noteEl.value : "";

  buildInvoiceHTML({
    invNo,
   dateStr: now.toLocaleString("en-GB"),
    subtotal,
    discount,
    total,
    note
  });

  await exportInvoicePDF_AutoTable(invNo + ".pdf", {
  invNo,
  dateStr: now.toLocaleString("en-GB"),
  subtotal,
  discount,
  total,
  note
});

}


document.addEventListener("DOMContentLoaded", () => {
  const btn = document.getElementById("printPdfBtn");
  if (!btn) return console.error("❌ زر PDF غير موجود: printPdfBtn");

  btn.addEventListener("click", async () => {
    try {
      console.log("PDF click ✅");

     if (!window.jspdf || !window.jspdf.jsPDF) throw new Error("jsPDF not loaded");
const t = new window.jspdf.jsPDF();
if (typeof t.autoTable !== "function") throw new Error("autoTable not loaded (check the script in <head>)");


      await checkoutPDF();
    } catch (e) {
      console.error("PDF ERROR:", e);
      const msg = (e && e.message) ? e.message : String(e);
      if (window.Swal) Swal.fire({ icon: "error", title: "فشل إنشاء PDF", text: msg });
      else alert("فشل إنشاء PDF: " + msg);
    }
  });
});

/* ========= Promo Countdown (UI only) =========
   غيّر هذا الوقت مثل ما تريد (توقيت بغداد +03:00)
   الفكرة: نحسب النهاية = بداية + يومين
*/
const PROMO_FREE_START_ISO = '2025-12-24T00:00:00+03:00'; // <-- غيّر التاريخ/الوقت
const PROMO_FREE_DURATION_MS = 2 * 24 * 60 * 60 * 1000;   // يومين
const PROMO_FREE_END_TS = new Date(PROMO_FREE_START_ISO).getTime() + PROMO_FREE_DURATION_MS;

function pad2(n){ return String(Math.max(0, n)).padStart(2, '0'); }

function updatePromoCountdown(){
  const dEl = document.getElementById('promoDays');
  const hEl = document.getElementById('promoHours');
  const mEl = document.getElementById('promoMins');
  const sEl = document.getElementById('promoSecs');
  if (!dEl || !hEl || !mEl || !sEl) return;

  const prev = {
    d: dEl.textContent,
    h: hEl.textContent,
    m: mEl.textContent,
    s: sEl.textContent
  };

  let diff = PROMO_FREE_END_TS - Date.now();
  if (diff < 0) diff = 0;

  const days = Math.floor(diff / (24*60*60*1000));
  diff -= days * (24*60*60*1000);

  const hours = Math.floor(diff / (60*60*1000));
  diff -= hours * (60*60*1000);

  const mins = Math.floor(diff / (60*1000));
  diff -= mins * (60*1000);

  const secs = Math.floor(diff / 1000);

  const next = {
    d: pad2(days),
    h: pad2(hours),
    m: pad2(mins),
    s: pad2(secs)
  };

  dEl.textContent = next.d;
  hEl.textContent = next.h;
  mEl.textContent = next.m;
  sEl.textContent = next.s;

  // حركة “tick” بس للرقم اللي تغيّر
  const tick = (el) => {
    el.classList.remove('tick');
    void el.offsetWidth; // reflow
    el.classList.add('tick');
  };

  if (prev.d !== next.d) tick(dEl);
  if (prev.h !== next.h) tick(hEl);
  if (prev.m !== next.m) tick(mEl);
  if (prev.s !== next.s) tick(sEl);
}


let promoCountdownTimer = null;
function startPromoCountdown(){
  updatePromoCountdown();
  if (promoCountdownTimer) clearInterval(promoCountdownTimer);
  promoCountdownTimer = setInterval(updatePromoCountdown, 1000);
}

/* زر الدخول لصفحة التوافقات */
function goToSimilaritesFromPromo(){
  closePopup();
  setTimeout(() => {
    window.location.href = 'similarites.html';
  }, 650);
}

/* ما نلمس window.onload مالك — نضيف listener إضافي فقط */
window.addEventListener('load', startPromoCountdown);



(function lockCopy() {
  const block = (e) => { e.preventDefault(); return false; };

  document.addEventListener('copy', block);
  document.addEventListener('cut', block);
  document.addEventListener('paste', block);
  document.addEventListener('contextmenu', block);
  document.addEventListener('selectstart', block);
  document.addEventListener('dragstart', block);

  // منع Ctrl+C / Ctrl+X / Ctrl+V / Ctrl+A
  document.addEventListener('keydown', (e) => {
    const k = (e.key || '').toLowerCase();
    if (e.ctrlKey && ['c','x','v','a','s','u','p'].includes(k)) {
      e.preventDefault();
    }
  });
})();


let isContactModalOpen = false;

// يمنع أي كلك على الـ overlay يسوي شي (ويوقف باقي الليسنرز مال overlay)
function blockOverlayClicks(e){
  e.preventDefault();
  e.stopImmediatePropagation();
  return false;
}

function openContactModal(){
  try{
    if (isContactModalOpen) return;

    const modal = document.getElementById("contactModal");
    const overlay = document.getElementById("overlay");

    // عرض overlay + منع اللمس خارجه (يعني الكلك ما يسوي شي)
    if (overlay){
      overlay.style.display = "block";
      overlay.addEventListener("click", blockOverlayClicks, true); // capture
    }

    modal.style.display = "flex";
    modal.setAttribute("aria-hidden","false");
    modal.style.animation = "slideDownModal 0.5s ease-out forwards";

    // قفل سكرول الخلفية (اختياري بس يطلع أنيق)
    document.documentElement.style.overflow = "hidden";
    document.body.style.overflow = "hidden";

    isContactModalOpen = true;
  }catch(err){
    console.error("openContactModal:", err);
  }
}

function closeContactModal(){
  try{
    const modal = document.getElementById("contactModal");
    const overlay = document.getElementById("overlay");

    modal.style.animation = "slideUpModal 0.5s ease-in forwards";

    setTimeout(() => {
      modal.style.display = "none";
      modal.setAttribute("aria-hidden","true");
      isContactModalOpen = false;

      // رجّع السكرول
      document.documentElement.style.overflow = "";
      document.body.style.overflow = "";

      // شيل منع الكلك عن overlay
      if (overlay){
        overlay.removeEventListener("click", blockOverlayClicks, true);

        // لا تطفي overlay إذا اكو نافذة ثانية مفتوحة
        const cart  = document.getElementById("cartModal");
        const offers= document.getElementById("offersModal");
        const newIt = document.getElementById("newItemsModal");
        const promo = document.getElementById("promoPopup");

        const anyOpen =
          (cart  && cart.style.display === "block") ||
          (offers&& offers.style.display === "flex") ||
          (newIt && newIt.style.display === "flex") ||
          (promo && promo.style.display === "flex");

        if (!anyOpen) overlay.style.display = "none";
      }
    }, 500);
  }catch(err){
    console.error("closeContactModal:", err);
    isContactModalOpen = false;
    const overlay = document.getElementById("overlay");
    if (overlay) overlay.style.display = "none";
  }
}

        
    


/* ==========================================================
   LUX ADS SYSTEM (Ahmed)
   التحكم:
   - غير قيمة AD_CHOICE الى:
     "off"                 => ما يطلع اي اعلان
     "barca_supercup"      => تهنئة برشلونة
     "ramadan_greeting"    => تهنئة رمضان
     "ramadan_dua"         => احاديث/ادعية (كاروسيل)
     "eid_fitr"            => تهنئة عيد الفطر
     "discounts"           => تخفيضات قطع الغيار
     "paid_ads"            => إعلان مدفوع (للمحل/طلب عمل/عرض حاجة)

   ========================================================== */
const AD_CHOICE = "paid_ads"; // <<< غيّرها هنا فقط

// خيارات اضافية (اختياري)
const AD_DELAY_MS = 650;                 // تأخير بسيط بعد التحميل
const AD_SHOW_ONCE_PER_SESSION = true;   // لا يعيد نفس الاعلان خلال نفس الجلسة

const LuxAds = (() => {
  const overlay = () => document.getElementById("adOverlay");
  const modal   = () => document.getElementById("adModal");
  const bodyEl  = () => document.querySelector("#adModal .ad-body");
  const shell   = () => document.querySelector("#adModal .ad-shell");
  let duaTimer = null;

  const normalize = (v) => String(v || "").trim().toLowerCase();
  const shownKey  = (k) => `lux_ad_shown__${k}`;

  const duaas = [
    { t: "اللهم إنك عفوٌ تحب العفو فاعفُ عنّا.", m: "دعاء" },
    { t: "اللهم بلّغنا رمضان وبارك لنا فيه وتقبّل منا صالح الأعمال.", m: "دعاء" },
    { t: "ربنا تقبّل منا إنك أنت السميع العليم.", m: "دعاء" },
    { t: "«من فطّر صائمًا كان له مثل أجره».", m: "حديث مشهور (للتذكير)" },
    { t: "اللهم اجعلنا من عتقائك من النار في هذا الشهر.", m: "دعاء" },
    { t: "«خيرُكم من تعلّم القرآن وعلّمه».", m: "حديث مشهور (للتذكير)" },
    { t: "اللهم ارزقنا قيام الليل وخشوع القلب وصفاء النيّة.", m: "دعاء" },
  ];
  let duaIndex = 0;

  function setTheme(themeClass){
    const s = shell();
    if (!s) return;
    s.className = `ad-shell ad-sheen ${themeClass}`;
  }

  function safeClearTimers(){
    if (duaTimer) { clearInterval(duaTimer); duaTimer = null; }
  }

  function fadeIn(){
    const o = overlay(), m = modal();
    if (!o || !m) return;

    o.style.display = "block";
    m.style.display = "grid";
    requestAnimationFrame(() => {
      o.style.opacity = "1";
    });

    // GSAP entry (if available)
    try{
      if (window.gsap){
        gsap.fromTo(shell(), {y: 18, opacity: 0, scale: 0.98}, {y: 0, opacity: 1, scale: 1, duration: 0.55, ease: "power3.out"});
      }else{
        shell().style.transform = "translateY(0)";
      }
    }catch(e){}
    // focus for accessibility
    setTimeout(() => { try{ m.focus(); }catch(e){} }, 80);
  }

  function close(){
    safeClearTimers();
    const o = overlay(), m = modal();
    if (!o || !m) return;

    // GSAP exit
    try{
      if (window.gsap){
        gsap.to(shell(), {y: 10, opacity: 0, scale: 0.985, duration: 0.28, ease: "power2.in"});
      }
    }catch(e){}

    o.style.opacity = "0";
    setTimeout(() => {
      o.style.display = "none";
      m.style.display = "none";
      if (shell()) shell().style.opacity = "";
    }, 260);
  }

  function bindClose(){
    const o = overlay(), m = modal();
    if (!o || !m) return;

    const btn = m.querySelector(".ad-close");
    if (btn && !btn.dataset.bound){
      btn.dataset.bound = "1";
      btn.addEventListener("click", close);
    }
    if (!o.dataset.bound){
      o.dataset.bound = "1";
      o.addEventListener("click", close);
    }
    if (!m.dataset.bound){
      m.dataset.bound = "1";
      m.addEventListener("keydown", (e) => {
        if (e.key === "Escape") close();
      });
    }
  }

  function renderBarca(){
    setTheme("ad-theme-barca");
    bodyEl().innerHTML = `
      <div class="ad-badge"><i class="fa-solid fa-sparkles"></i><b>تهنئة خاصة</b></div>
      <div style="display:flex;gap:14px;align-items:center;flex-wrap:wrap;">
        <div class="trophy" aria-hidden="true"><i class="fa-solid fa-trophy"></i></div>
        <div style="flex:1;min-width:220px">
          <h3>تهنئة بفوز برشلونة 💙❤️</h3>
          <p>مبروك الفوز بكأس السوبر! ليلة تاريخية… وڤاموس يا أبطال ✨</p>
        </div>
      </div>
      <div class="ad-actions">
        <button class="ad-btn primary" id="adBarcaOk"><i class="fa-solid fa-fireworks"></i> ڤاموس</button>
        <button class="ad-btn secondary" id="adBarcaClose"><i class="fa-regular fa-circle-xmark"></i> إغلاق</button>
      </div>
    `;
    document.getElementById("adBarcaOk")?.addEventListener("click", close);
    document.getElementById("adBarcaClose")?.addEventListener("click", close);
  }

  function renderRamadan(){
    setTheme("ad-theme-ramadan");
    bodyEl().innerHTML = `
      <div class="moon">
        <div class="lantern" aria-hidden="true"><i class="fa-solid fa-mosque"></i></div>
        <div>
          <h3>رمضان كريم 🌙</h3>
          <p>الله يجعل هالشهر عليكم بركة وخير… ويكتبلكم قبول وصحة وراحة بال 🤍</p>
        </div>
      </div>
      <div class="ad-actions">
        <button class="ad-btn primary" id="adRamadanOk"><i class="fa-solid fa-hands-praying"></i> آمين</button>
        <button class="ad-btn secondary" id="adRamadanClose"><i class="fa-regular fa-circle-xmark"></i> إغلاق</button>
      </div>
    `;
    document.getElementById("adRamadanOk")?.addEventListener("click", close);
    document.getElementById("adRamadanClose")?.addEventListener("click", close);
  }

  function renderDua(){
    setTheme("ad-theme-dua");
    bodyEl().innerHTML = `
      <h3>تذكير رمضان ✨</h3>
      <p>أحاديث وأدعية قصيرة… للتذكير اليومي (سوي سكرول/بدّل بالنكست).</p>

      <div class="quote-card" id="duaCard">
        <div class="quote-row">
          <div class="quote-ico" aria-hidden="true"><i class="fa-solid fa-quote-left"></i></div>
          <div>
            <div class="quote-text" id="duaText"></div>
            <div class="quote-meta" id="duaMeta"></div>
          </div>
        </div>

        <div class="nav">
          <button id="duaPrev"><i class="fa-solid fa-arrow-right"></i> السابق</button>
          <button id="duaNext">التالي <i class="fa-solid fa-arrow-left"></i></button>
          <button id="duaCopy"><i class="fa-regular fa-copy"></i> نسخ</button>
        </div>
      </div>

      <div class="ad-actions">
        <button class="ad-btn primary" id="duaOk"><i class="fa-solid fa-heart"></i> الله يتقبل</button>
        <button class="ad-btn secondary" id="duaClose"><i class="fa-regular fa-circle-xmark"></i> إغلاق</button>
      </div>
    `;

    const setQuote = () => {
      const item = duaas[duaIndex % duaas.length];
      const t = document.getElementById("duaText");
      const m = document.getElementById("duaMeta");
      if (t) t.textContent = item.t;
      if (m) m.textContent = item.m;
      // soft micro animation
      try{
        if (window.gsap){
          gsap.fromTo("#duaCard", {scale: 0.995, opacity: 0.92}, {scale: 1, opacity: 1, duration: 0.25, ease: "power2.out"});
        }
      }catch(e){}
    };

    const next = () => { duaIndex = (duaIndex + 1) % duaas.length; setQuote(); };
    const prev = () => { duaIndex = (duaIndex - 1 + duaas.length) % duaas.length; setQuote(); };

    document.getElementById("duaNext")?.addEventListener("click", next);
    document.getElementById("duaPrev")?.addEventListener("click", prev);
    document.getElementById("duaOk")?.addEventListener("click", close);
    document.getElementById("duaClose")?.addEventListener("click", close);

    document.getElementById("duaCopy")?.addEventListener("click", async () => {
      try{
        const txt = duaas[duaIndex % duaas.length].t;
        await navigator.clipboard.writeText(txt);
        if (window.Swal) Swal.fire({ icon:"success", title:"تم النسخ", timer: 900, showConfirmButton:false });
      }catch(e){
        // fallback
        try{
          const txt = duaas[duaIndex % duaas.length].t;
          const ta = document.createElement("textarea");
          ta.value = txt; document.body.appendChild(ta); ta.select();
          document.execCommand("copy"); document.body.removeChild(ta);
        }catch(_e){}
      }
    });

    setQuote();
    safeClearTimers();
    duaTimer = setInterval(next, 4200);
  }

  function renderEid(){
    setTheme("ad-theme-eid");
    bodyEl().innerHTML = `
      <div class="fire" aria-hidden="true">
        <span><i class="fa-solid fa-fireworks"></i> فرحة</span>
        <span><i class="fa-solid fa-gift"></i> هدايا</span>
        <span><i class="fa-solid fa-star"></i> بهجة</span>
      </div>
      <h3>عيدكم مبارك 🌟</h3>
      <p>تقبل الله طاعاتكم… وجعل أيامكم كلها أفراح ولمّة حلوة 🤍</p>
      <div class="ad-actions">
        <button class="ad-btn primary" id="eidOk"><i class="fa-solid fa-sparkles"></i> آمين</button>
        <button class="ad-btn secondary" id="eidClose"><i class="fa-regular fa-circle-xmark"></i> إغلاق</button>
      </div>
    `;
    document.getElementById("eidOk")?.addEventListener("click", close);
    document.getElementById("eidClose")?.addEventListener("click", close);
  }

  function renderDiscounts(){
    setTheme("ad-theme-discount");
    bodyEl().innerHTML = `
      <h3>تخفيضات قوية 🔥</h3>
      <p>عروض منوعة على كل قطع الغيار… الحق قبل ما تخلص ✨</p>

      <div class="deal-grid" aria-label="أمثلة عروض">
        <div class="deal"><i class="fa-solid fa-tag"></i><div><b>شاشات</b><small>خصومات مختارة</small></div></div>
        <div class="deal"><i class="fa-solid fa-bolt"></i><div><b>بطاريات</b><small>أسعار نار</small></div></div>
        <div class="deal"><i class="fa-solid fa-microchip"></i><div><b>آيسيات</b><small>تخفيضات جملة</small></div></div>
        <div class="deal"><i class="fa-solid fa-screwdriver-wrench"></i><div><b>قطع صيانة</b><small>كلشي موجود</small></div></div>
        <div class="deal"><i class="fa-solid fa-percent"></i><div><b>خصم</b><small>على دفعات</small></div></div>
        <div class="deal"><i class="fa-solid fa-truck-fast"></i><div><b>تجهيز سريع</b><small>حسب التوفر</small></div></div>
      </div>

      <div class="ad-actions">
        <button class="ad-btn primary" id="goShop"><i class="fa-solid fa-cart-shopping"></i> افتح السلة</button>
        <button class="ad-btn secondary" id="discClose"><i class="fa-regular fa-circle-xmark"></i> إغلاق</button>
      </div>
    `;
    document.getElementById("discClose")?.addEventListener("click", close);
    document.getElementById("goShop")?.addEventListener("click", () => {
      close();
      setTimeout(() => {
        try{ if (typeof openCart === "function") openCart(); }catch(e){}
      }, 250);
    });
  }
  
function renderPaidAds(){
  setTheme("ad-theme-paid");
  bodyEl().innerHTML = `
    <div class="paid-stage">
      <div class="paid-kicker ad-sheen">
        <i class="fa-solid fa-crown"></i>
        إعلان مدفوع — يلفت النظر
      </div>

      <div class="paid-icons" aria-hidden="true">
        <div class="paid-ico i1"><i class="fa-solid fa-bullhorn"></i></div>
        <div class="paid-ico i2"><i class="fa-solid fa-rocket"></i></div>
        <div class="paid-ico i3"><i class="fa-solid fa-star"></i></div>
      </div>

      <h3>إعلانك يوصل لأكثر من 1000 فني صيانة</h3>
      <p>
        حسب آخر إحصائية… وفرنالك إعلان للمحل أو طلب عمل أو عرض حاجة،
        وبسعر رمزي ولمدة 7 أيام.
      </p>

      <div class="paid-metrics" aria-label="السعر والمدة والوصول">
        <span class="pill"><i class="fa-solid fa-tag"></i> 5,000 د.ع</span>
        <span class="pill"><i class="fa-solid fa-calendar-days"></i> 7 أيام</span>
        <span class="pill"><i class="fa-solid fa-users"></i> 1000+ فني</span>
      </div>

      <div class="paid-cards" aria-label="أنواع الإعلان">
        <div class="paid-card">
          <span class="ico"><i class="fa-solid fa-store"></i></span>
          <div><b>إعلان للمحل</b><small>خدمات • عروض • تعريف</small></div>
        </div>
        <div class="paid-card">
          <span class="ico"><i class="fa-solid fa-briefcase"></i></span>
          <div><b>طلب عمل</b><small>توظيف • تعاون • شراكة</small></div>
        </div>
        <div class="paid-card">
          <span class="ico"><i class="fa-solid fa-box-open"></i></span>
          <div><b>عرض حاجة / بيع</b><small>قطعة • جهاز • أدوات</small></div>
        </div>
      </div>

      <div class="ad-actions">
        <button class="ad-btn primary" id="paidStart"><i class="fa-solid fa-paper-plane"></i> اطلب إعلان</button>
        <button class="ad-btn secondary" id="paidClose"><i class="fa-regular fa-circle-xmark"></i> إغلاق</button>
      </div>

      <div class="paid-note">
        * نرتّب وياك النص والصورة حتى يطلع إعلان “مُقنع” ومرتب ويتشاف بسرعة.
      </div>
    </div>
  `;

  document.getElementById("paidClose")?.addEventListener("click", close);
  document.getElementById("paidStart")?.addEventListener("click", () => {
    close();
    setTimeout(() => {
      try{ if (typeof openContactModal === "function") openContactModal(); }catch(e){}
    }, 250);
  });
}






  
  

  function showByKey(keyRaw){
    bindClose();
    safeClearTimers();

    const key = normalize(keyRaw);
    if (!key || key === "off") return;

    // once per session
    if (AD_SHOW_ONCE_PER_SESSION){
      if (sessionStorage.getItem(shownKey(key)) === "true") return;
      sessionStorage.setItem(shownKey(key), "true");
    }

    // render
    if      (key === "barca_supercup") renderBarca();
    else if (key === "ramadan_greeting") renderRamadan();
    else if (key === "ramadan_dua") renderDua();
    else if (key === "eid_fitr") renderEid();
    else if (key === "discounts") renderDiscounts();
    else if (key === "paid_ads") renderPaidAds();

    else return;

    fadeIn();
  }

  function maybeShow(){
    // لا تعرض اثناء نافذة التفعيل او الصيانة/اللوكدون… نتحقق اذا موجودة
    const activationOpen = !!document.querySelector(".swal2-container.swal2-shown");
    if (activationOpen) return;

    const key = normalize(AD_CHOICE);
    if (!key || key === "off") return;

    setTimeout(() => showByKey(key), AD_DELAY_MS);
  }

  return { maybeShow, showByKey, close };
})();


</script>
   
      
